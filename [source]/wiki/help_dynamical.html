<!DOCTYPE html>
<html lang="ru">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <link id="favicon" rel="icon" type="image/x-icon" href="../res/favicon.ico" />
    <link type="text/css" rel="stylesheet" href="../res/css/easy.library.css" />
    <link type="text/css" rel="stylesheet" href="../res/css/offline.window.css" />
    <link type="text/css" rel="stylesheet" href="../res/css/qsp_code.css" />
    <title>QSP: ИнформАрхив</title>
</head>
    
<body>
    <div class="em_Main">
        <div class="em_AROUND">
            <h1>Справка по QSP</h1>
            <!-- body start -->
<div style="display:flex;justify-content:space-between;"><div><a href="https://aleksversus.github.io/howdo_faq/wiki/help_service_locations.html" class="emHREFTT">&lt; Назад, к странице 54</a></div><div><a href="https://aleksversus.github.io/howdo_faq/wiki/howto_start.html" class="emHREFTT">Вперёд, к странице 56 &gt;</a></div></div>
<p>
<a href="https://aleksversus.github.io/howdo_faq/wiki/help_service_locations.html#help_service_locations" style="text-decoration:none;" class="emFOLD">Назад: Служебные локации</a>

</p>
<a id="help_dynamical"></a><h2>Динамический код</h2>
<p>
<a id="dinamicheskij_kod"></a>

</p>
<a id="nгkм"></a><h3>Лирическое вступление, поясняющее, для чего может пригодиться динамический код</h3>
<p>
В силу своей линейности язык QSP лишён определённых возможностей, присущих другим языкам программирования. Например, если вам нужно вывести на печать массив, вы делаете это с помощью цикла:

</p>
<div class="Monokai-Code">
<span class="Monokai-Comment">!&nbsp;массив&nbsp;mass&nbsp;создан&nbsp;заранее</span><br>
<span class="Monokai-Koperator">loop</span>&nbsp;<span class="Monokai-Operator">local</span>&nbsp;i<span class="Monokai-Operator">,</span>size<span class="Monokai-Operator">=</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">,</span><span class="Monokai-Func">arrsize</span><span class="Monokai-Operator">(</span><span class="Monokai-String">'mass'</span><span class="Monokai-Operator">)</span>&nbsp;<span class="Monokai-Koperator">while</span>&nbsp;i<span class="Monokai-Operator">&lt;</span>size&nbsp;<span class="Monokai-Koperator">step</span>&nbsp;i<span class="Monokai-Operator">+</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">1</span><span class="Monokai-Operator">:</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">*pl</span>&nbsp;mass<span class="Monokai-Operator">[</span>i<span class="Monokai-Operator">]</span><br>
<span class="Monokai-Koperator">end</span><br>


</div>
<p>
Но, что если вам нужно вывести на печать десять массивов? Писать на каждый массив по циклу?

</p>
<p>
Гораздо проще написать одну универсальную локацию-функцию (см. раздел <a href="https://aleksversus.github.io/howdo_faq/wiki/help_organizing.html#help_organizing" style="text-decoration:none;" class="emFOLD">"Пользовательские функции и процедуры"</a>), передавать в неё название массива и выводить одним и тем же циклом на печать любой массив.

</p>
<p>
И вот для этого нам потребуется использовать динамический код.

</p>
<p>
(на самом деле у этой задачи есть решение и без применения оператора <span class="em_BLCK"><span class="emOPRT">DYNAMIC</span></span>, но сейчас нас интересует именно динамический код, поэтому продолжим в рамках нужного для примера решения).

</p>
<p>
Динамический код — это код, который мы не знаем заранее. Мы пишем лишь его составные части, а уже при выполнении программы этот код составляется из этих частей в нужные комбинации.

</p>
<p>
Прежде всего стоит спросить себя, из чего состоит любой код? И, кажется, что ответ очевиден: код состоит из команд. Это верно, но чем по сути являются команды? А вот тут ответ очевиден не для всех: команды — это строки текста.

</p>
<p>
Мы с вами прекрасно умеем работать со строками. Если не умеем, то быстренько читаем раздел <a href="https://aleksversus.github.io/howdo_faq/wiki/help_strings.html#help_strings" style="text-decoration:none;" class="emFOLD">"Строки"</a> и учимся.

</p>
<p>
Строки можно склеивать, в них можно встраивать подвыражения, из них можно вырезать фрагменты. Вот и с кодом, по сути, можно делать то же самое. Так давайте запишем наш цикл в виде строки:

</p>
<div class="Monokai-Code">
<span class="Monokai-String">"loop&nbsp;local&nbsp;i,size=0,arrsize('mass')&nbsp;while&nbsp;i&lt;size&nbsp;step&nbsp;i+=1:<br>
&nbsp;&nbsp;&nbsp;&nbsp;*pl&nbsp;mass[i]<br>
end"</span><br>


</div>
<p>
Что мы тут видим? А видим мы, что в этой строке прописано название массива <span class="em_BLCK">mass</span>, аж целых два раза. Название массива — это значение, которое можно помещать в перемнную, а можно извлекать из переменной.

</p>
<p>
Например, мы поместили название массива в переменную <span class="em_BLCK">$array_name</span>. Как нам вставить значение этой переменной в наш код, записанный в виде строки? Используем подвыражения:

</p>
<div class="Monokai-Code">
$array_name<span class="Monokai-Operator">=</span><span class="Monokai-String">'mass'</span><br>
<span class="Monokai-String">"loop&nbsp;local&nbsp;i,size=0,arrsize('&lt;&lt;$array_name&gt;&gt;')&nbsp;while&nbsp;i&lt;size&nbsp;step&nbsp;i+=1:<br>
&nbsp;&nbsp;&nbsp;&nbsp;*pl&nbsp;&lt;&lt;$array_name&gt;&gt;[i]<br>
end"</span><br>


</div>
<p>
Если мы запустим получившуюся локацию, мы увидим на экране наш цикл с массивом <span class="em_BLCK">mass</span>. Если мы пропишем в переменную <span class="em_BLCK">$array_name</span> название другого массива, и снова запустим локацию, мы увидим на экране тот же цикл, но с другим массивом. Это значит, что наша строка текста формируется <span class="em_BLCK">динамически</span>! То есть и код цикла формируется динамически. Нам осталось только научиться запускать на выполнение такой код, записанный в виде строки текста. И вот для этого, как раз, в QSP есть специальный оператор: <span class="em_BLCK"><span class="emOPRT">DYNAMIC</span></span>. Мы просто передаём этому оператору наш записанный в виде текста цикл, и оператор <span class="em_BLCK"><span class="emOPRT">DYNAMIC</span></span> легко его выполняет, как обычный код QSP:

</p>
<div class="Monokai-Code">
$array_name<span class="Monokai-Operator">=</span><span class="Monokai-String">'mass'</span><br>
<span class="Monokai-Operator">dynamic</span>&nbsp;<span class="Monokai-String">"loop&nbsp;local&nbsp;i,size=0,arrsize('&lt;&lt;$array_name&gt;&gt;')&nbsp;while&nbsp;i&lt;size&nbsp;step&nbsp;i+=1:<br>
&nbsp;&nbsp;&nbsp;&nbsp;*pl&nbsp;&lt;&lt;$array_name&gt;&gt;[i]<br>
end"</span><br>


</div>
<p>
Таким образом, заменяя значение в переменной <span class="em_BLCK">$array_name</span>, мы легко выводим на печать любой массив. А чтобы нам было ещё проще, мы создаём специальную локацию-функцию, и ей, в качестве аргументов, будем передавать названия массивов, которые хотим распечатать. Назовём эту локацию <span class="em_BLCK">print_array</span>:

</p>
<div class="Monokai-Code">
<span class="Monokai-Comment">!#&nbsp;print_array</span><br>
<span class="Monokai-Operator">dynamic</span>&nbsp;<span class="Monokai-String">"loop&nbsp;local&nbsp;i,size=0,arrsize('&lt;&lt;$args[0]&gt;&gt;')&nbsp;while&nbsp;i&lt;size&nbsp;step&nbsp;i+=1:<br>
&nbsp;&nbsp;&nbsp;&nbsp;*pl&nbsp;&lt;&lt;$args[0]&gt;&gt;[i]<br>
end"</span><br>


</div>
<p>
И теперь как мы выведем на печать любой, какой хотим, массив? Проще простого:

</p>
<div class="Monokai-Code">
<span class="Monokai-UnFunc">@print_array</span><span class="Monokai-Operator">(</span><span class="Monokai-String">'mass'</span><span class="Monokai-Operator">)</span><br>
<span class="Monokai-UnFunc">@print_array</span><span class="Monokai-Operator">(</span><span class="Monokai-String">'$unit_name'</span><span class="Monokai-Operator">)</span><br>
<span class="Monokai-UnFunc">@print_array</span><span class="Monokai-Operator">(</span><span class="Monokai-String">'unit_count'</span><span class="Monokai-Operator">)</span><br>


</div>
<p>
Вот так возможность работы с динамическим кодом позволяет нам сделать наш код QSP более гибким и легко читаемым.

</p>
<a id="INth"></a><h3>DYNAMIC</h3>
<p>
<strong>DYNAMIC</strong> — выполняет код, переданный в виде строки текста. Общая запись:

</p>
<div class="Monokai-Code">
<span class="Monokai-Operator">DYNAMIC</span><span class="Monokai-Operator">(</span><span class="Monokai-Command">[$код]</span><span class="Monokai-Operator">,</span><span class="Monokai-Command">[аргумент&nbsp;0]</span><span class="Monokai-Operator">,</span><span class="Monokai-Command">[аргумент&nbsp;1]</span><span class="Monokai-Operator">,</span>&nbsp;<span class="Monokai-Command">...&nbsp;</span><span class="Monokai-Operator">,</span><span class="Monokai-Command">[аргумент&nbsp;18]</span><span class="Monokai-Operator">)</span><br>


</div>
<p>
, где <span class="em_BLCK"><span class="emTEXT">[$код]</span></span> — это обычный код QSP, записанный в виде текста. Выполнение такого кода аналогично выполнению кода оператора <span class="em_BLCK"><span class="emOPRT">GOSUB</span></span>. Аргументы <span class="em_BLCK"><span class="emTEXT">[аргумент 0]</span></span>, <span class="em_BLCK"><span class="emTEXT">[аргумент 1]</span></span> и т.д. могут использоваться внутри <span class="em_BLCK"><span class="emTEXT">[$код]</span></span>, их значения автоматически помещаются в ячейки массива <span class="em_BLCK"><span class="emVAR">args</span><span class="emOPRT">[</span><span class="emNUM">0</span><span class="emOPRT">]</span></span>, <span class="em_BLCK"><span class="emVAR">args</span><span class="emOPRT">[</span><span class="emNUM">1</span><span class="emOPRT">]</span></span>, и т.д. соответственно. Внутри выполняемого кода <span class="em_BLCK"><span class="emOPRT">DYNAMIC</span></span> используется свой собственный массив <span class="em_BLCK"><span class="emVAR">ARGS</span></span>, его значения не пересекаются со значениями <span class="em_BLCK"><span class="emVAR">ARGS</span></span> на локации, из которой <span class="em_BLCK"><span class="emOPRT">DYNAMIC</span></span> был вызван. После выполнения кода, переданного оператору <span class="em_BLCK"><span class="emOPRT">DYNAMIC</span></span>, продолжается выполнение кода со следующей команды после <span class="em_BLCK"><span class="emOPRT">DYNAMIC</span></span>.

</p>
<p>
Примеры:

</p>
<div class="Monokai-Code">
<span class="Monokai-Comment">!&nbsp;простые&nbsp;вызовы&nbsp;кода,&nbsp;записанного&nbsp;в&nbsp;виде&nbsp;текста</span><br>
<span class="Monokai-Operator">dynamic</span>&nbsp;<span class="Monokai-String">'$a="string&lt;&lt;$b&gt;&gt;"'</span><br>
<span class="Monokai-Operator">dynamic</span>&nbsp;<span class="Monokai-String">'$a'</span><br>
<span class="Monokai-Operator">dynamic</span>&nbsp;<span class="Monokai-String">'if&nbsp;$a="string":'</span><span class="Monokai-String">'text!'</span><span class="Monokai-String">''</span><br>
<span class="Monokai-Comment">!&nbsp;вызов&nbsp;кода&nbsp;с&nbsp;передачей&nbsp;в&nbsp;него&nbsp;аргументов</span><br>
<span class="Monokai-Operator">dynamic</span>&nbsp;<span class="Monokai-String">"<br>
&nbsp;&nbsp;&nbsp;&nbsp;*pl&nbsp;$args[0]<br>
&nbsp;&nbsp;&nbsp;&nbsp;addobj&nbsp;$args[1]<br>
"</span><span class="Monokai-Operator">,</span><span class="Monokai-String">'Вы&nbsp;взяли&nbsp;вилку.'</span><span class="Monokai-Operator">,</span><span class="Monokai-String">'Вилка'</span><br>


</div>
<p>
Нижеследующая информация справедлива и для функции <span class="em_BLCK"><span class="emFUNC">DYNEVAL</span></span> (см. ниже).

</p>
<p>
Важно! Если код задан с помощью одинарных (<span class="em_BLCK"><span class="emTEXT">''</span></span>) или двойных (<span class="em_BLCK"><span class="emTEXT">""</span></span>) кавычек, подвыражения вычисляются сразу:

</p>
<div class="Monokai-Code">
<span class="Monokai-SysVar">$args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">=</span><span class="Monokai-String">'qwerty'</span><br>
$code&nbsp;<span class="Monokai-Operator">=</span>&nbsp;<span class="Monokai-String">'<br>
&nbsp;&nbsp;&nbsp;&nbsp;*pl&nbsp;"&lt;&lt;$args[0]&gt;&gt;"<br>
&nbsp;&nbsp;&nbsp;&nbsp;*pl&nbsp;$args[0]<br>
'</span><br>
<br>
<span class="Monokai-Operator">dynamic</span>&nbsp;$code<span class="Monokai-Operator">,</span><span class="Monokai-String">'asdfg'</span><br>


</div>
<p>
В этом случае при задании переменной <span class="em_BLCK">$code</span> будет вычислено подвыражение, поэтому когда <span class="em_BLCK"><span class="emOPRT">DYNAMIC</span></span> выполнит код, первой строкой выведется 'qwerty', второй строкой выведется 'asdfg'.

</p>
<p>
Фигурные скобки - третий вид кавычек используемый специально для написания динамического кода. Здесь поддерживается вложенность скобок, а подвыражения не вычисляются:

</p>
<div class="Monokai-Code">
<span class="Monokai-SysVar">$args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">=</span><span class="Monokai-String">'qwerty'</span><br>
$code&nbsp;<span class="Monokai-Operator">=</span>&nbsp;<span class="Monokai-Operator">{</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">*pl</span>&nbsp;<span class="Monokai-String">"&lt;&lt;$args[0]&gt;&gt;"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">*pl</span>&nbsp;<span class="Monokai-SysVar">$args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><br>
<span class="Monokai-Operator">}</span><br>
<br>
<span class="Monokai-Operator">dynamic</span>&nbsp;$code<span class="Monokai-Operator">,</span><span class="Monokai-String">'asdfg'</span><br>


</div>
<p>
В этом случае будут выведены две строки 'asdfg'. Так как подвыражение не вычисляется на момент присвоения кода переменной <span class="em_BLCK">$code</span>, но зато будет вычислено уже при непосредственном выполнении кода оператором <span class="em_BLCK"><span class="emOPRT">DYNAMIC</span></span>.

</p>
<a id="Юеsx"></a><h3>DYNEVAL</h3>
<p>
<strong>DYNEVAL</strong> —  выполняет код, переданный в виде строки текста, и возвращает результат, если он есть. Общая запись:

</p>
<div class="Monokai-Code">
<span class="Monokai-Func">$DYNEVAL</span><span class="Monokai-Operator">(</span><span class="Monokai-Command">[$код]</span><span class="Monokai-Operator">,</span><span class="Monokai-Command">[аргумент&nbsp;0]</span><span class="Monokai-Operator">,</span><span class="Monokai-Command">[аргумент&nbsp;1]</span><span class="Monokai-Operator">,</span>&nbsp;<span class="Monokai-Command">...&nbsp;</span><span class="Monokai-Operator">,</span><span class="Monokai-Command">[аргумент&nbsp;18]</span><span class="Monokai-Operator">)</span><br>
<span class="Monokai-Func">DYNEVAL</span><span class="Monokai-Operator">(</span><span class="Monokai-Command">[$код]</span><span class="Monokai-Operator">,</span><span class="Monokai-Command">[аргумент&nbsp;0]</span><span class="Monokai-Operator">,</span><span class="Monokai-Command">[аргумент&nbsp;1]</span><span class="Monokai-Operator">,</span>&nbsp;<span class="Monokai-Command">...&nbsp;</span><span class="Monokai-Operator">,</span><span class="Monokai-Command">[аргумент&nbsp;18]</span><span class="Monokai-Operator">)</span><br>


</div>
<p>
, где <span class="em_BLCK"><span class="emTEXT">[$код]</span></span> — это обычный код QSP, записанный в виде текста. Выполнение такого кода аналогично выполнению кода функции <span class="em_BLCK"><span class="emFUNC">FUNC</span></span>. Аргументы <span class="em_BLCK"><span class="emTEXT">[аргумент 0]</span></span>, <span class="em_BLCK"><span class="emTEXT">[аргумент 1]</span></span> и т.д. могут использоваться внутри <span class="em_BLCK"><span class="emTEXT">[$код]</span></span>, их значения автоматически помещаются в массив <span class="em_BLCK"><span class="emVAR">ARGS</span></span>, в ячейки <span class="em_BLCK"><span class="emVAR">args</span><span class="emOPRT">[</span><span class="emNUM">0</span><span class="emOPRT">]</span></span>, <span class="em_BLCK"><span class="emVAR">args</span><span class="emOPRT">[</span><span class="emNUM">1</span><span class="emOPRT">]</span></span>, и т.д. соответственно. Внутри выполняемого кода <span class="em_BLCK"><span class="emFUNC">DYNEVAL</span></span> используется свой собственный массив <span class="em_BLCK"><span class="emVAR">ARGS</span></span>, его значения не пересекаются со значениями <span class="em_BLCK"><span class="emVAR">ARGS</span></span> на локации, из которой <span class="em_BLCK"><span class="emFUNC">DYNEVAL</span></span> была вызвана. После выполнения кода, переданного функции <span class="em_BLCK"><span class="emFUNC">DYNEVAL</span></span>, продолжается вычисление выражения, в котором расположена функция <span class="em_BLCK"><span class="emFUNC">DYNEVAL</span></span>.

</p>
<p>
Чтобы <span class="em_BLCK"><span class="emFUNC">DYNEVAL</span></span> возвращала результат, необходимо внутри <span class="em_BLCK"><span class="emTEXT">[$код]</span></span> присвоить этот результат переменной <span class="em_BLCK"><span class="emVAR">RESULT</span></span>.

</p>
<p>
Примеры:

</p>
<div class="Monokai-Code">
<span class="Monokai-Func">dyneval</span><span class="Monokai-Operator">(</span><span class="Monokai-String">'result&nbsp;=&nbsp;3+4'</span><span class="Monokai-Operator">)</span><br>
<span class="Monokai-Operator">*pl</span>&nbsp;<span class="Monokai-Func">$dyneval</span><span class="Monokai-Operator">(</span><span class="Monokai-String">'$result&nbsp;=&nbsp;$mid("abcd",2,1)+"qwerty"'</span><span class="Monokai-Operator">)</span><br>
проход&nbsp;<span class="Monokai-Operator">=</span>&nbsp;<span class="Monokai-Func">dyneval</span><span class="Monokai-Operator">(</span><span class="Monokai-String">"result&nbsp;=&nbsp;($args[0]&nbsp;&lt;&gt;&nbsp;'текст')"</span><span class="Monokai-Operator">,</span>&nbsp;<span class="Monokai-String">'строка'</span><span class="Monokai-Operator">)</span><br>


</div>
<p>
Чтобы <span class="em_BLCK"><span class="emFUNC">DYNEVAL</span></span> вернула строковое значение, результат должен быть записан в <span class="em_BLCK"><span class="emVAR">$RESULT</span></span>. Чтобы <span class="em_BLCK"><span class="emFUNC">DYNEVAL</span></span> вернула числовое значение, результат должен быть записан в <span class="em_BLCK"><span class="emVAR">RESULT</span></span>. <span class="em_BLCK"><span class="emVAR">$RESULT</span></span> и <span class="em_BLCK"><span class="emVAR">RESULT</span></span> — это одна и та же переменная, но с разными типами данных. Следует помнить, что новая запись значения затирает предыдущее значение, какого бы типа данных не было это значение.

</p>
<p>
Если при выполнении <span class="em_BLCK"><span class="emFUNC">DYNEVAL</span></span> она не возвращает значения (<span class="em_BLCK"><span class="emVAR">RESULT</span></span> не инициализируется), и является единственным элементом выражения, передаваемого неявному оператору, плеер ничего не выведет на экран. Т.е. <span class="em_BLCK"><span class="emFUNC">DYNEVAL</span></span> будет работать, как <span class="em_BLCK"><span class="emOPRT">DYNAMIC</span></span>. Пример:

</p>
<div class="Monokai-Code">
<span class="Monokai-Comment">!&nbsp;неявный&nbsp;оператор&nbsp;выведет&nbsp;на&nbsp;экран&nbsp;123:</span><br>
<span class="Monokai-Numeric">123</span><br>
<span class="Monokai-Comment">!&nbsp;код&nbsp;в&nbsp;dyneval&nbsp;выполнится,&nbsp;но&nbsp;на&nbsp;экране</span><br>
<span class="Monokai-Comment">!&nbsp;мы&nbsp;ничего&nbsp;не&nbsp;увидим:</span><br>
<span class="Monokai-Func">dyneval</span><span class="Monokai-Operator">(</span><span class="Monokai-String">"code&nbsp;=&nbsp;123&nbsp;+&nbsp;890"</span><span class="Monokai-Operator">)</span><br>
<span class="Monokai-Comment">!&nbsp;неявный&nbsp;оператор&nbsp;выведет&nbsp;на&nbsp;экран&nbsp;1013</span><br>
code<br>


</div>
<a id="ёНЙг"></a><h3>Области применения <span class="em_BLCK"><span class="emOPRT">DYNAMIC</span></span> и <span class="em_BLCK"><span class="emFUNC">DYNEVAL</span></span></h3>
<p>
<span class="em_BLCK"><span class="emOPRT">DYNAMIC</span></span> и <span class="em_BLCK"><span class="emFUNC">DYNEVAL</span></span> следует использовать в нескольких случаях:

</p>
<ul>
<li>
Когда нет иного способа получить необходимый функционал. Как пример, очень распространённый случай генерации действий с помощью цикла:
<div class="Monokai-Code">
<span class="Monokai-Koperator">loop</span>&nbsp;i<span class="Monokai-Operator">=</span><span class="Monokai-Numeric">1</span>&nbsp;<span class="Monokai-Koperator">while</span>&nbsp;i<span class="Monokai-Operator">&lt;</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">10</span>&nbsp;<span class="Monokai-Koperator">step</span>&nbsp;i<span class="Monokai-Operator">+</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">1</span><span class="Monokai-Operator">:</span><br>
<span class="Monokai-Koperator">act</span>&nbsp;<span class="Monokai-String">"Действие&nbsp;&lt;&lt;i&gt;&gt;"</span><span class="Monokai-Operator">:</span>&nbsp;<span class="Monokai-Operator">*pl</span>&nbsp;<span class="Monokai-String">"Действие&nbsp;&lt;&lt;i&gt;&gt;"</span><br>
<span class="Monokai-Koperator">end</span><br>


</div>
<p>
В данном случае будут созданы действия с названиями "Действие 1" ... "Действие 10". Неопытный автор ожидает, что каждое из этих действий при щелчке по нему будет выводить собственный номер. Однако, это ожидание не верно. Переменная <span class="em_BLCK">i</span> в данном случае получит значение <span class="em_BLCK"><span class="emNUM">10</span></span>, и в момент выполнения действия именно это значение подставится в строку, выводимую на экран. То есть подвыражение, относящееся к коду действия, не будет раскрыто плеером, пока игрок не кликнет по действию. Чтобы действительно сгенерировать действия, которые будут выводить свой правильный номер, раскрытие подвыражения должно происходить в момент создания действия. Как раз для этого и подойдёт оператор <span class="em_BLCK"><span class="emOPRT">DYNAMIC</span></span>:

</p>
<div class="Monokai-Code">
<span class="Monokai-Koperator">loop</span>&nbsp;i<span class="Monokai-Operator">=</span><span class="Monokai-Numeric">1</span>&nbsp;<span class="Monokai-Koperator">while</span>&nbsp;i<span class="Monokai-Operator">&lt;</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">10</span>&nbsp;<span class="Monokai-Koperator">step</span>&nbsp;i<span class="Monokai-Operator">+</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">1</span><span class="Monokai-Operator">:</span><br>
<span class="Monokai-Operator">dynamic</span>&nbsp;<span class="Monokai-String">'act&nbsp;"Действие&nbsp;&lt;&lt;i&gt;&gt;":&nbsp;*pl&nbsp;"Действие&nbsp;&lt;&lt;i&gt;&gt;"'</span><br>
<span class="Monokai-Koperator">end</span><br>


</div>
<p>
В этом случае сначала раскроются подвыражения, а затем готовый код будет передан оператору <span class="em_BLCK"><span class="emOPRT">DYNAMIC</span></span>. Таким образом сформируются дейстия с уже готовым уникальным кодом действия.

</p>
</li>
<li>
Так же <span class="em_BLCK"><span class="emOPRT">DYNAMIC</span></span> и <span class="em_BLCK"><span class="emFUNC">DYNEVAL</span></span> очень удобны, когда нужно выполнить некоторый многострочный код в том месте, где невозможно разместить такой многострочный код. Например, в гиперссылках:
<div class="Monokai-Code">
$CODE<span class="Monokai-Operator">=</span><span class="Monokai-Operator">{</span><br>
<span class="Monokai-Koperator">if</span>&nbsp;<span class="Monokai-Func">no</span>&nbsp;деньги<span class="Monokai-Operator">&lt;</span><span class="Monokai-Numeric">100</span><span class="Monokai-Operator">:</span><br>
<span class="Monokai-Operator">addobj</span>&nbsp;<span class="Monokai-String">'Кружка&nbsp;имбирного&nbsp;эля'</span>&nbsp;<br>
кружка_эля<span class="Monokai-Operator">+</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">1</span>&nbsp;<br>
деньги<span class="Monokai-Operator">-</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">100</span><br>
<span class="Monokai-Operator">*pl</span>&nbsp;<span class="Monokai-String">"Я&nbsp;приобрёл&nbsp;куржку&nbsp;имбирного&nbsp;эля."</span><br>
<span class="Monokai-Koperator">else</span><br>
<span class="Monokai-Operator">*pl</span>&nbsp;<span class="Monokai-String">"Мне&nbsp;не&nbsp;хватает&nbsp;денег&nbsp;на&nbsp;эль."</span><br>
<span class="Monokai-Koperator">end</span><br>
<span class="Monokai-Operator">}</span><br>
<span class="Monokai-Operator">*pl</span>&nbsp;<span class="Monokai-String">"&lt;a&nbsp;href='exec:dynamic&nbsp;$CODE'&gt;Купить&nbsp;кружку&nbsp;имбирного&nbsp;эля&lt;/a&gt;"</span><br>


</div>
<p>
В этом случае переменная <span class="em_BLCK">$CODE</span> обязательно должна быть глобальной, иначе ссылка её не "увидит". Однако, при необходимости использовать такой код в условиях или циклах, вполне можно обойтись и локальной переменной, чтобы код не висел в памяти:

</p>
<div class="Monokai-Code">
<span class="Monokai-Comment">!&nbsp;этот&nbsp;код&nbsp;не&nbsp;имеет&nbsp;практической&nbsp;пользы.&nbsp;Просто&nbsp;для&nbsp;примера.</span><br>
<span class="Monokai-Operator">local</span>&nbsp;$code&nbsp;<span class="Monokai-Operator">=</span>&nbsp;<span class="Monokai-Operator">{</span><br>
<span class="Monokai-Koperator">if</span>&nbsp;<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">+</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">1</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">+</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">2</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">+</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">3</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">:</span><br>
<span class="Monokai-SysVar">result</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">1</span><br>
<span class="Monokai-Koperator">elseif</span>&nbsp;<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">+</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">1</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">+</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">2</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">+</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">3</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">4</span><span class="Monokai-Operator">:</span><br>
<span class="Monokai-SysVar">result</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">1</span><br>
<span class="Monokai-Koperator">else</span><span class="Monokai-Operator">:</span><br>
<span class="Monokai-SysVar">result</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">0</span><br>
<span class="Monokai-Koperator">end</span><br>
<span class="Monokai-Operator">}</span><br>
<span class="Monokai-Koperator">loop</span>&nbsp;<span class="Monokai-Operator">local</span>&nbsp;i<span class="Monokai-Operator">=</span><span class="Monokai-Numeric">0</span>&nbsp;<span class="Monokai-Operator">&amp;</span>&nbsp;<span class="Monokai-Operator">local</span>&nbsp;size<span class="Monokai-Operator">=</span><span class="Monokai-Func">arrsize</span><span class="Monokai-Operator">(</span><span class="Monokai-String">'$map'</span><span class="Monokai-Operator">)</span>&nbsp;<span class="Monokai-Koperator">while</span>&nbsp;<span class="Monokai-Func">dyneval</span><span class="Monokai-Operator">(</span>$code<span class="Monokai-Operator">,</span>a<span class="Monokai-Operator">,</span>b<span class="Monokai-Operator">,</span>c<span class="Monokai-Operator">,</span>d<span class="Monokai-Operator">)</span>&nbsp;<span class="Monokai-Koperator">step</span>&nbsp;i<span class="Monokai-Operator">+</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">1</span><span class="Monokai-Operator">:</span><br>
a&nbsp;<span class="Monokai-Operator">=</span>&nbsp;<span class="Monokai-Func">rand</span><span class="Monokai-Operator">(</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">1</span><span class="Monokai-Operator">)</span><br>
b&nbsp;<span class="Monokai-Operator">=</span>&nbsp;<span class="Monokai-Func">rand</span><span class="Monokai-Operator">(</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">1</span><span class="Monokai-Operator">)</span><br>
c&nbsp;<span class="Monokai-Operator">=</span>&nbsp;<span class="Monokai-Func">rand</span><span class="Monokai-Operator">(</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">1</span><span class="Monokai-Operator">)</span><br>
d&nbsp;<span class="Monokai-Operator">=</span>&nbsp;<span class="Monokai-Func">rand</span><span class="Monokai-Operator">(</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">1</span><span class="Monokai-Operator">)</span><br>
<span class="Monokai-Koperator">end</span><br>


</div>
<p>
В своём роде это способ создавать анонимные функции в QSP.

</p>
</li>
<li>
Так же <span class="em_BLCK"><span class="emOPRT">DYNAMIC</span></span> очень удобен для разного рода <a href="https://aleksversus.github.io/howdo_faq/wiki/help_debugger.html#help_debugger" style="text-decoration:none;" class="emFOLD">отладчиков</a>, поскольку позволяет выполнять код QSP, введённый в строку ввода безо всяких танцев с бубном.
</li>
<li>
<span class="em_BLCK"><span class="emOPRT">DYNAMIC</span></span> позволяет восстанавливать действия, полученные с помощью функции <span class="em_BLCK"><span class="emFUNC">$CURACTS</span></span>:
<div class="Monokai-Code">
$acts&nbsp;<span class="Monokai-Operator">=</span>&nbsp;<span class="Monokai-Func">$curacts</span><br>
<span class="Monokai-Operator">cla</span><br>
<span class="Monokai-Operator">dynamic</span>&nbsp;$acts<br>


</div>
</li>
</ul>
<p>
Нет смысла использовать динамический код, если вы можете получить тот же результат без его использования. Прежде чем всюду пихать <span class="em_BLCK"><span class="emOPRT">DYNAMIC</span></span> хорошенько подумайте, а не целесообразнее было бы написать этот код на отдельной локации так, чтобы не приходилось использовать <span class="em_BLCK"><span class="emOPRT">DYNAMIC</span></span>. Динамический код сложнее читать и на него сложнее ссылаться. Он в принципе ухудшает читаемость кода.

</p>
<p>
Вполне возможно вложение динамического кода в динамический код, то есть `DYNAMIC<strong>/</strong>'DYNEVAL<span class="em_BLCK"> внутри </span>DYNAMIC<strong>/</strong>'DYNEVAL`, однако это мало того, что ухудшает читаемость, так ещё и очень часто приводит к багам, которые трудно отловить. Банально, неверная закрытая кавычка внутри кода внутри кода может вызвать ошибку, выбиваемую вообще не понятно в какой строке локации. Тем не менее число вложений не ограничено.

</p>
<p>
<a href="https://aleksversus.github.io/howdo_faq/wiki/help_menu.html#help_menu" style="text-decoration:none;" class="emFOLD">Вперёд: Всплывающее меню</a>

</p>
<div style="display:flex;justify-content:space-between;"><div><a href="https://aleksversus.github.io/howdo_faq/wiki/help_service_locations.html" class="emHREFTT">&lt; Назад, к странице 54</a></div><div><a href="https://aleksversus.github.io/howdo_faq/wiki/howto_start.html" class="emHREFTT">Вперёд, к странице 56 &gt;</a></div></div>
<!-- body end -->
            <div class="em_Epigraph">
                <div class="em_subText">
                    <p>Aleks Versus'HowDo-F.A.Q.'2021-<span id="date_stamp_faq">2022</span></p>
                    <p>Aleks Versus'Game Adventure Making'Really Unimaginable Stories'2013-<span id="date_stamp_gamrus">2022</span></p>
                </div>
            </div>
            <div class="em_btn">
                <div>
                    <a href="https://aleksversus.github.io/howdo_faq/" class="emHREFTT">Главная</a>
                </div>
                <div>
                    <a href="#" class="emHREFTT" id="section_content_open">Содержание</a>
                </div>
            </div>
        </div>
        <div class="stub">
            &nbsp;
        </div>
    </div>
    <div id="soderzhanije_outer">
        <div class="soderzhanije">
<ul>
<li>
 `<a href="start.html" style="text-decoration:none;" class="emFOLD">В начало</a>`
</li>
<li>
 `<a href="https://aleksversus.github.io/howdo_faq/wiki/help_qsp.html#help_qsp" style="text-decoration:none;" class="emFOLD">Что такое QSP?</a>`
</li>
<li>
 `<a href="https://aleksversus.github.io/howdo_faq/wiki/help_locations.html#help_locations" style="text-decoration:none;" class="emFOLD">Локации</a>`
</li>
<li>
 <span class="em_BLCK">Вывод текста</span>
<ul>
<li>
 <a href="help/main.html" style="text-decoration:none;" class="emFOLD">Основное окно описания</a>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/help_stat.html#help_stat" style="text-decoration:none;" class="emFOLD">Дополнительное окно описания</a>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/None.html#help_msgbox" style="text-decoration:none;" class="emFOLD">Диалоговое окно</a>
</li>
</ul>
</li>
<li>
 `<a href="https://aleksversus.github.io/howdo_faq/wiki/help_acts.html#help_acts" style="text-decoration:none;" class="emFOLD">Действия</a>`
</li>
<li>
 `<a href="https://aleksversus.github.io/howdo_faq/wiki/help_goto.html#help_goto" style="text-decoration:none;" class="emFOLD">Переходы</a>`
</li>
<li>
 `<a href="https://aleksversus.github.io/howdo_faq/wiki/help_objs.html#help_objs" style="text-decoration:none;" class="emFOLD">Предметы (инвентарь)</a>`
</li>
<li>
 <span class="em_BLCK">Программирование</span>
<ul>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/help_principle.html#help_principle" style="text-decoration:none;" class="emFOLD">Порядок работы интерпретатора</a>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/help_variables.html#help_variables" style="text-decoration:none;" class="emFOLD">Переменные</a>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/help_expressions.html#help_expressions" style="text-decoration:none;" class="emFOLD">Выражения</a>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/help_coding.html#help_coding" style="text-decoration:none;" class="emFOLD">Программный код</a>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/None.html#help_cycle" style="text-decoration:none;" class="emFOLD">Циклы</a>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/help_arrays.html#help_arrays" style="text-decoration:none;" class="emFOLD">Массивы</a>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/help_strings.html#help_strings" style="text-decoration:none;" class="emFOLD">Строки</a>
<ul>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/help_regexp.html#help_regexp" style="text-decoration:none;" class="emFOLD">Регулярные выражения</a>
</li>
</ul>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/help_conditional.html#help_conditional" style="text-decoration:none;" class="emFOLD">Условия</a>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/help_organizing.html#help_organizing" style="text-decoration:none;" class="emFOLD">Пользовательские функции и процедуры</a>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/help_jump.html#help_jump" style="text-decoration:none;" class="emFOLD">Переходы внутри локации, циклы</a>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/help_service_locations.html#help_service_locations" style="text-decoration:none;" class="emFOLD">Служебные локации</a>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/help_dynamical.html#help_dynamical" style="text-decoration:none;" class="emFOLD">Динамический код</a>
</li>
</ul>
</li>
<li>
 <span class="em_BLCK">Оформление</span>
<ul>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/help_menu.html#help_menu" style="text-decoration:none;" class="emFOLD">Меню</a>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/help_sound.html#help_sound" style="text-decoration:none;" class="emFOLD">Звук</a>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/help_graphics.html#help_graphics" style="text-decoration:none;" class="emFOLD">Графика</a>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/None.html#help_interface" style="text-decoration:none;" class="emFOLD">Настройки интерфейса</a>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/help_html.html#help_html" style="text-decoration:none;" class="emFOLD">HTML</a>
</li>
</ul>
</li>
<li>
 <span class="em_BLCK">Расширенные возможности</span>
<ul>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/help_inputs.html#help_inputs" style="text-decoration:none;" class="emFOLD">Ввод текста игроком</a>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/help_modules.html#help_modules" style="text-decoration:none;" class="emFOLD">Работа с файлами игр, модули</a>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/None.html#help_savegame" style="text-decoration:none;" class="emFOLD">Работа с файлами сохранений</a>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/help_realtime.html#help_realtime" style="text-decoration:none;" class="emFOLD">Реальное время</a>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/None.html#help_tuples" style="text-decoration:none;" class="emFOLD">Кортежи</a>
</li>
</ul>
</li>
<li>
 <span class="em_BLCK">Нюансы написания игр под разные плееры</span>
<ul>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/help_classic_qsp.html#help_classic_qsp" style="text-decoration:none;" class="emFOLD">Классический плеер</a>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/None.html#help_qspider" style="text-decoration:none;" class="emFOLD">qSpider</a>
<ul>
<li>
<a href="https://aleksversus.github.io/howdo_faq/wiki/None.html#help_qspider_gamecfg" style="text-decoration:none;" class="emFOLD">Конфигурационный файл</a>
</li>
<li>
<a href="https://aleksversus.github.io/howdo_faq/wiki/None.html#help_qspider_aeroqsp" style="text-decoration:none;" class="emFOLD">Особенности запуска AeroQSP-игр</a>
</li>
</ul>
</li>
<li>
 x <a href="https://aleksversus.github.io/howdo_faq/wiki/help_navigator.html#help_navigator" style="text-decoration:none;" class="emFOLD">Quest Navigator</a>
</li>
<li>
 x <a href="https://aleksversus.github.io/howdo_faq/wiki/help_aeroqsp.html#help_aeroqsp" style="text-decoration:none;" class="emFOLD">AeroQSP</a>
</li>
</ul>
</li>
<li>
 <span class="em_BLCK">Утилиты и средства разработки</span>
<ul>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/None.html#help_qgen" style="text-decoration:none;" class="emFOLD">Quest Generator</a>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/help_debugger.html#help_debugger" style="text-decoration:none;" class="emFOLD">Отладчик</a>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/help_txt2gam.html#help_txt2gam" style="text-decoration:none;" class="emFOLD">Работа с утилитой TXT2GAM</a>
</li>
<li>
 <a href="https://aleksversus.github.io/howdo_faq/wiki/None.html#help_analyzer" style="text-decoration:none;" class="emFOLD">Анализатор кода QSP</a>
</li>
</ul>
</li>
<li>
 `<a href="https://aleksversus.github.io/howdo_faq/wiki/help_limits.html#help_limits" style="text-decoration:none;" class="emFOLD">Ограничения QSP</a>`
</li>
<li>
 `<a href="https://aleksversus.github.io/howdo_faq/wiki/howto_start.html#howto_start" style="text-decoration:none;" class="emFOLD">Как сделать?</a>`
</li>
<li>
 `<a href="https://aleksversus.github.io/howdo_faq/wiki/help_glossary.html#help_glossary" style="text-decoration:none;" class="emFOLD">Cловарь терминов</a>`
</li>
<li>
 `<a href="https://aleksversus.github.io/howdo_faq/wiki/help_keywords.html#help_keywords" style="text-decoration:none;" class="emFOLD">Ключевые слова. Указатель</a>`
</li>
</ul>
        </div>
    </div>
    <script type="text/javascript" src="../res/js/text_replace.js"></script>
    <script type="text/javascript" src="../res/js/soderzhanie.js" ></script>
</body>
</html>
