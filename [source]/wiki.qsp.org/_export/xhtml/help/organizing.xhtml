<!DOCTYPE html>
<html lang="ru" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>help:organizing</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="help,organizing"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Документация QSP"/>
<link rel="start" href="/"/>
<link rel="alternate" type="application/rss+xml" title="Недавние изменения" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Текущее пространство имён" href="/feed.php?mode=list&amp;ns=help"/>
<link rel="alternate" type="text/html" title="Простой HTML" href="/_export/xhtml/help/organizing"/>
<link rel="canonical" href="http://wiki.qsp.su/help/organizing"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=exportdokuwiki&amp;tseed=f78b359cebbc2738e83150069e877c7f"/>
<link rel="stylesheet" type="text/css" href="/lib/plugins/syntaxhighlighter3/sxh3/styles/shCore.css"/>
<link rel="stylesheet" type="text/css" href="/lib/plugins/syntaxhighlighter3/sxh3/styles/shThemeDefault.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='help';var JSINFO = {"id":"help:organizing","namespace":"help"};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?tseed=f78b359cebbc2738e83150069e877c7f&amp;template=exportdokuwiki"></script>
<script type="text/javascript" src="/lib/plugins/syntaxhighlighter3/sxh3/scripts/shCore.js"></script>
<script type="text/javascript" src="/lib/plugins/syntaxhighlighter3/sxh3/scripts/shAutoloader.js"></script>
<script type="text/javascript" src="/lib/plugins/syntaxhighlighter3/sxh3/scripts/shBrushXml.js"></script>
</head>
<body>
<div class="dokuwiki export">

<p>
<a href="/help/conditional" class="wikilink1" title="help:conditional">Назад: Условия</a>
</p>

<h2 class="sectionedit1" id="polzovatelskie_funkcii_i_procedury">Пользовательские функции и процедуры</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <strong>GOSUB</strong> <em>[$локация]</em><strong>,</strong><em>[параметр 1]</em><strong>,</strong><em>[параметр 2]</em><strong>, …</strong></div>
</li>
<li class="level1"><div class="li"> <strong>GS</strong> <em>[$локация]</em><strong>,</strong><em>[параметр 1]</em><strong>,</strong><em>[параметр 2]</em><strong>, …</strong> - обработка локации с названием <em>[$локация]</em>. </div>
<ul>
<li class="level2"><div class="li"> Основное описание и список действий локации <em class="u"><em>добавляются</em></em> к описанию и действиям старой локации.</div>
</li>
<li class="level2"><div class="li"> Происходит выполнение операторов в поле &quot;Выполнить при посещении&quot;</div>
</li>
<li class="level2"><div class="li"> Переданные параметры хранятся в массиве ARGS. Максимальное количество параметров - <strong>9</strong><sup><a href="#fn__1" id="fnt__1" class="fn_top">1)</a></sup>.</div>
</li>
<li class="level2"><div class="li"> Затем продолжение выполнения программы со следующей команды после GS/GOSUB.</div>
</li>
<li class="level2"><div class="li"> <strong>Внимание:</strong> Код, выполняемый по оператору ACT, считается отдельным блоком кода:<pre class="brush: qsp">
GS &#039;переход&#039;, &#039;локация&#039;

#переход
*PL $ARGS[0]  &amp;! На экран выведется &#039;локация&#039;
ACT &#039;Перейти&#039;:
  GT $ARGS[0] &amp;! Работать не будет, т.к. массив ARGS пуст
END
</pre></div>
</li>
<li class="level2"><div class="li"> <em>Примеры:</em><pre class="brush: qsp">
!обработка локации &quot;ход&quot;. Массив ARGS пуст.
GS &#039;ход&#039;

!обработка локации с названием из переменной $loc
!Передаётся один параметр - ARGS[0] равен 1.
GS $loc,1

!обработка локации &quot;ход&quot; с передачей 3-х параметров. 
! $ARGS[0] = $var (значению), ARGS[1] = 2, 
! $ARGS[2] = &quot;данные&quot;. Обратите внимание на символы &#039;$&#039;.
GS &#039;ход&#039;,$var,2,&#039;данные&#039;
</pre></div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <strong>FUNC(</strong><em>[$локация]</em><strong>,</strong><em>[параметр 1]</em><strong>,</strong><em>[параметр 2]</em><strong>, …)</strong> - обработка локации с названием <em>[$локация]</em> аналогично оператору GS (GOSUB), но с возвращением значения.</div>
<ul>
<li class="level2"><div class="li"> Основное описание и список действий локации <em class="u"><em>добавляются</em></em> к описанию и действиям старой локации.</div>
</li>
<li class="level2"><div class="li"> Происходит выполнение операторов в поле &quot;Выполнить при посещении&quot;</div>
</li>
<li class="level2"><div class="li"> Переданные параметры хранятся в массиве ARGS. Максимальное количество параметров - <strong>9</strong><sup><a href="#fn__2" id="fnt__2" class="fn_top">2)</a></sup>.</div>
</li>
<li class="level2"><div class="li"> Результат функции равен значению <em>$RESULT</em> при возврате строкового значения или <em>RESULT</em> при возврате числового значения. </div>
</li>
<li class="level2"><div class="li"> Если при обработке локации были установлены и <em>RESULT</em>, и <em>$RESULT</em>, то предпочтение отдаётся строковому значению. </div>
</li>
<li class="level2"><div class="li"> После обработки локации предыдущие значения ARGS и RESULT восстанавливаются. </div>
</li>
<li class="level2"><div class="li"> <strong>Внимание:</strong> при использовании в коде локации-функции операторов GS/DYNAMIC переменные RESULT и $RESULT могут перезаписываться кодом, выполняемым этими операторами.</div>
<ul>
<li class="level3"><div class="li"> Исправлено в более новых версиях интерпретатора. </div>
</li>
</ul>
</li>
<li class="level2"><div class="li"> <em>Примеры:</em><pre class="brush: qsp">
!Обработка локации &quot;функция&quot; как функции. 
!Массив ARGS пуст. 
!Результат передается через $RESULT или RESULT
!в зависимости от кода обрабатываемой локации.
яблоки = FUNC(&#039;функция&#039;)

!обработка локации с названием в $name как функции. ARGS[0] равен 1.
PL FUNC($name, 1) * 78

!обработка локации с названием в $name как функции. 
!$ARGS[0] содержит строку &quot;строка&quot;, ARGS[1] равен 2.
MSG &quot;text&quot; + FUNC($name, &quot;строка&quot;, 2)
</pre></div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <strong>EXIT</strong> - завершение выполнения текущего кода (преждевременный выход из подпрограммы / обработчика какого-либо события…).</div>
<ul>
<li class="level2"><div class="li"> <em>Примеры:</em><pre class="brush: qsp">
if args[0] = 0: exit
</pre></div>
</li>
</ul>
</li>
</ul>
<hr />

<p>
<a href="/help/jump" class="wikilink1" title="help:jump">Вперёд: Переходы внутри локации, циклы</a>
</p>

</div>
<!-- EDIT1 SECTION "Пользовательские функции и процедуры" [49-] --><div class="footnotes">
<div class="fn"><sup><a href="#fnt__1" id="fn__1" class="fn_bot">1)</a></sup> 
, <sup><a href="#fnt__2" id="fn__2" class="fn_bot">2)</a></sup> 
10 включая имя локации</div>
</div>
</div>
</body>
</html>
