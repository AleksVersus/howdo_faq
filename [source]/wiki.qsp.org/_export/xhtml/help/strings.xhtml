<!DOCTYPE html>
<html lang="ru" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>help:strings</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="help,strings"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Документация QSP"/>
<link rel="start" href="/"/>
<link rel="alternate" type="application/rss+xml" title="Недавние изменения" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Текущее пространство имён" href="/feed.php?mode=list&amp;ns=help"/>
<link rel="alternate" type="text/html" title="Простой HTML" href="/_export/xhtml/help/strings"/>
<link rel="canonical" href="http://wiki.qsp.su/help/strings"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=exportdokuwiki&amp;tseed=f78b359cebbc2738e83150069e877c7f"/>
<link rel="stylesheet" type="text/css" href="/lib/plugins/syntaxhighlighter3/sxh3/styles/shCore.css"/>
<link rel="stylesheet" type="text/css" href="/lib/plugins/syntaxhighlighter3/sxh3/styles/shThemeDefault.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='help';var JSINFO = {"id":"help:strings","namespace":"help"};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?tseed=f78b359cebbc2738e83150069e877c7f&amp;template=exportdokuwiki"></script>
<script type="text/javascript" src="/lib/plugins/syntaxhighlighter3/sxh3/scripts/shCore.js"></script>
<script type="text/javascript" src="/lib/plugins/syntaxhighlighter3/sxh3/scripts/shAutoloader.js"></script>
<script type="text/javascript" src="/lib/plugins/syntaxhighlighter3/sxh3/scripts/shBrushXml.js"></script>
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Содержание</h3>
<div>

<ul class="toc">
<li class="level2"><div class="li"><a href="#stroki">Строки</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="#konstanty">Константы</a></div></li>
<li class="level3"><div class="li"><a href="#sravnenie_strok">Сравнение строк</a></div></li>
<li class="level3"><div class="li"><a href="#podvyrazhenija">Подвыражения</a></div></li>
<li class="level3"><div class="li"><a href="#funkcii">Функции</a></div></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<p>
<a href="/help/arrays" class="wikilink1" title="help:arrays">Назад: Массивы</a>
</p>

<h2 class="sectionedit1" id="stroki">Строки</h2>
<div class="level2">

<p>
В QSP есть два типа данных: числовой и строковый.<br/>

Строковый тип данных отличается тем, что в начале названия строковой переменной или массива должен быть символ &#039;<strong>$</strong>&#039;.<br/>

Рекомендуется к названиям всех функций, возвращающих строковые значения, тоже приписывать символ &#039;<strong>$</strong>&#039; для улучшения читаемости кода.
</p>

</div>
<!-- EDIT1 SECTION "Строки" [45-620] -->
<h3 class="sectionedit2" id="konstanty">Константы</h3>
<div class="level3">

<p>
Если с числовыми константами в QSP всё просто (просто записывается числом, например, 4593), то со строковыми есть несколько нюансов:
</p>
<ul>
<li class="level1"><div class="li"> Текстовая константа берётся с двух сторон в кавычки</div>
<ul>
<li class="level2"><div class="li"> Кавычки могут быть двух видов: апострофы <strong>&#039; &#039;</strong> и прямые кавычки <strong>&quot; &quot;</strong></div>
</li>
<li class="level2"><div class="li"> Если нужно в константу включить кавычки того же вида, нужно написать кавычки два раза подряд:<pre class="brush: qsp">
*PL &#039;Byte Soft&#039;&#039;s &quot;QSP&quot;&#039;
*PL &quot;Byte Soft&#039;s &quot;&quot;QSP&quot;&quot;&quot;
!Byte Soft&#039;s &quot;QSP&quot;
</pre></div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Для текстовых констант сохраняются переносы строк и отступы:<pre class="brush: qsp">
&#039;Данный текст
будет расположен на
нескольких строках&#039;

$a=&#039;И этот
текст
также&#039;

a=2 &amp; act &#039;Многострочное
название&#039;:gt &#039;next&#039;
</pre></div>
<ul>
<li class="level2"><div class="li"> При выводе ошибок многострочная (префоматированная) текстовая константа считается за одну строку.</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Текстовые константы и значения переменных можно объединять двумя способами:</div>
<ul>
<li class="level2"><div class="li"> С помощью оператора конкатенации <strong>&amp;</strong>. Выражение нужно брать в скобки, т.к. оператор <strong>&amp;</strong> также разделяет команды: <pre class="brush: qsp"> 
$res = (&#039;x=&#039; &amp; x &amp; &#039; y=&#039; &amp; y) &amp;! Результат &#039;x=5 y=6&#039;
$res = &#039;x=&#039; &amp; x &amp;!&#039;Результат &#039;x=&#039;, а &#039;5&#039; выведется
в основное окно описания.&#039;
</pre></div>
</li>
<li class="level2"><div class="li"> С помощью оператора сложения <strong>+</strong>: <pre class="brush: qsp">
$res = &#039;x=&#039; + x + &#039; y=&#039; + y &amp;! Результат &#039;x=5 y=6&#039;
</pre></div>
<ul>
<li class="level3"><div class="li"> Следует соблюдать осторожность, если одно из слагаемых числового типа: <pre class="brush: qsp">
x = 1
$res = &#039;1&#039; + x
!Результат &#039;2&#039; вместо &#039;11&#039;
</pre></div>
</li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
<!-- EDIT2 SECTION "Константы" [621-2817] -->
<h3 class="sectionedit3" id="sravnenie_strok">Сравнение строк</h3>
<div class="level3">

<p>
Строки сравниваются посимвольно, начиная с крайнего левого символа.<pre class="brush: qsp">
&#039;ac&#039; = &#039;ac&#039;
&#039;bc&#039; &gt; &#039;ac&#039;  &amp;! &#039;b&#039; &gt; &#039;a&#039;
&#039;ac&#039; &gt; &#039;ab&#039;  &amp;! &#039;c&#039; &gt; &#039;b&#039;
&#039;b&#039;  &gt; &#039;ab&#039;  &amp;! &#039;b&#039; &gt; &#039;a&#039;
&#039;ab&#039; &gt; &#039;a&#039;   &amp;! &#039;b&#039; &gt; &#039;&#039;
</pre>
</p>

</div>
<!-- EDIT3 SECTION "Сравнение строк" [2818-3114] -->
<h3 class="sectionedit4" id="podvyrazhenija">Подвыражения</h3>
<div class="level3">

<p>
В строковые константы, в базовые описания локаций и названия базовых действий существует возможность вставлять значения выражений. Такие &quot;подвыражения&quot; должны находиться между двойных угловых скобок: &quot;<strong>&lt;&lt;</strong>&quot; и &quot;<strong>&gt;&gt;</strong>&quot;, до и после которых может идти любой текст, включая подобные &quot;подвыражения&quot;.
</p>

<p>
<pre class="brush: qsp">
pl &#039;i=&#039;+str(i)
!эквивалентно
pl &#039;i=&lt;&lt;i&gt;&gt;&#039;

число_гоблинов=5
&#039;Тебя окружили &lt;&lt;число_гоблинов&gt;&gt; гоблинов!&#039;

pl &#039;Вас зовут &lt;&lt;$PlayerName&gt;&gt;, вы находитесь в &lt;&lt;$curloc&gt;&gt;.&#039;

!Вложенные подвыражения:
pl val(&#039;&lt;&lt;val(&quot;&lt;&lt;i&gt;&gt;&quot;)&gt;&gt;&lt;&lt;j&gt;&gt;&#039;)
pl val(&#039;&lt;&lt;str(val(&quot;&lt;&lt;i&gt;&gt;&quot;))&gt;&gt;&#039;)
!&#039;При использовании вложенных подвыражений
необходимо использовать вложенные строковые константы&#039;
</pre>
</p>

<p>
Если нужно вывести последовательность &quot;<strong>&lt;&lt;</strong>&quot; на экран, можно использовать два способа:
</p>
<ul>
<li class="level1"><div class="li"> Разбить &#039;<strong>&lt;&lt;</strong>&#039; на &#039;<strong>&lt;</strong>&#039;+&#039;<strong>&lt;</strong>&#039;: <pre class="brush: qsp">
$text = &#039;&lt;&#039;+&#039;&lt;var&gt;&gt;&#039;
&#039;string &lt;&#039;+&#039;&lt;var&gt;&gt;&#039;
</pre></div>
</li>
<li class="level1"><div class="li"> <strong>DISABLESUBEX</strong> - системная переменная, &quot;выключающая&quot; подвыражения при неравенстве 0:<pre class="brush: qsp">
DISABLESUBEX=1
$text = &#039;&lt;&lt;var&gt;&gt;&#039;
&#039;string &lt;&lt;var&gt;&gt;&#039;
DISABLESUBEX=0
</pre></div>
</li>
</ul>

</div>
<!-- EDIT4 SECTION "Подвыражения" [3115-4747] -->
<h3 class="sectionedit5" id="funkcii">Функции</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> <strong>LEN(</strong><em>[$стр]</em><strong>)</strong> - возвращает длину строки <em>[$стр]</em>.</div>
</li>
<li class="level1"><div class="li"> <strong>MID(</strong><em>[$стр]</em><strong>,</strong><em>[#начало]</em><strong>,</strong><em>[#длина]</em><strong>)</strong> - вырезает из строки <em>[$стр]</em> строку, которая начинается с символа номер <em>[#начало]</em> и имеет длину <em>[#длина]</em>. Индексация символов в строке ведётся с 1.</div>
<ul>
<li class="level2"><div class="li"> Параметр <em>[#длина]</em> может отсутствовать, при этом вырезается вся строка, начиная с символа <em>[#начало]</em>. </div>
</li>
<li class="level2"><div class="li"> <em>Примеры:</em><pre class="brush: qsp">
$MID(&#039;abcd&#039;, 1, 2) &amp;! &#039;ab&#039;
$MID(&#039;abcd&#039;, 2, 3) &amp;! &#039;bcd&#039;
$MID(&#039;abcd&#039;, 2)    &amp;! &#039;bcd&#039;
</pre></div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <strong>UCASE(</strong><em>[$стр]</em><strong>)</strong> - возвращает строку больших букв, полученную изменением регистра букв исходной строки <em>[$стр]</em>. <pre class="brush: qsp">$UCASE(&#039;TexT#&#039;) &amp;! &#039;TEXT#&#039;</pre></div>
</li>
<li class="level1"><div class="li"> <strong>LCASE(</strong><em>[$стр]</em><strong>)</strong> - возвращает строку маленьких букв, полученную изменением регистра букв исходной строки <em>[$стр]</em>. <pre class="brush: qsp">$LCASE(&#039;TExT#&#039;) &amp;! &#039;text#&#039;</pre></div>
</li>
<li class="level1"><div class="li"> <strong>TRIM(</strong><em>[$стр]</em><strong>)</strong> - удаляет прилегающие пробелы и символы табуляции из <em>[$стр]</em> и возвращает полученную строку. <pre class="brush: qsp">$TRIM(&#039; TRIM TEST &#039;) &amp;! &#039;TRIM TEST&#039;</pre></div>
</li>
<li class="level1"><div class="li"> <strong>REPLACE(</strong><em>[$стр]</em><strong>,</strong><em>[$поиск]</em><strong>,</strong><em>[$замена]</em><strong>)</strong> - заменяет в строке <em>[$стр]</em> все вхождения строки <em>[$поиск]</em> строкой <em>[$замена]</em>.</div>
<ul>
<li class="level2"><div class="li"> Параметр <em>[$замена]</em> может отсутствовать и принимается равным пустой строке.</div>
</li>
<li class="level2"><div class="li"> <em>Примеры:</em><pre class="brush: qsp">
$REPLACE(&#039;test&#039;, &#039;12&#039;, &#039;4&#039;) &amp;! &#039;test&#039;
$REPLACE(&#039;test&#039;, &#039;e&#039;, &#039;s&#039;)  &amp;! &#039;tsst&#039;
$REPLACE(&#039;test&#039;, &#039;t&#039;, &#039;34&#039;) &amp;! &#039;34es34&#039;
$REPLACE(&#039;test&#039;, &#039;t&#039;)       &amp;! &#039;es&#039;
</pre></div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <strong>INSTR(</strong><em>[#начало]</em><strong>,</strong><em>[$строка]</em><strong>,</strong><em>[$поиск]</em><strong>)</strong> - возвращает номер позиции символа, с которого начинается вхождение строки <em>[$поиск]</em> в строку <em>[$строка]</em> (или 0, если такой строки нет). Поиск начинается с символа номер <em>[#начало]</em>.</div>
<ul>
<li class="level2"><div class="li"> Параметр <em>[#начало]</em> может отсутствовать, при этом он принимается равным <strong>1</strong>.</div>
</li>
<li class="level2"><div class="li"> <strong>Важно:</strong> в более новых версиях (<em>Quest Navigator</em>) необязательный параметр <em>[#начало]</em> переставлен последним<sup><a href="#fn__1" id="fnt__1" class="fn_top">1)</a></sup>.</div>
</li>
<li class="level2"><div class="li"> <em>Примеры:</em><pre class="brush: qsp">
INSTR(1,&#039;ABCDefgh&#039;,&#039;BC&#039;) &amp;! 2
INSTR(1,&#039;ABCDefgh&#039;,&#039;Be&#039;) &amp;! 0
INSTR(&#039;abcdef&#039;,&#039;abc&#039;)    &amp;! 1
</pre></div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <strong>ISNUM(</strong><em>[$строка]</em><strong>)</strong> - функция проверяет, является ли строка [$строка] числом. Функция возвращает 0 (ложь) или -1 (истина). <pre class="brush: qsp">
ISNUM(&#039; 9999 &#039;) &amp;! -1
ISNUM(&#039; -888&#039;)  &amp;! -1
ISNUM(&#039;777a6&#039;)  &amp;! 0
ISNUM(&#039;&#039;)       &amp;! -1, т.к. пустая строка считается нулём
</pre></div>
</li>
<li class="level1"><div class="li"> <strong>VAL(</strong><em>[$стр]</em><strong>)</strong> - переводит строку цифр <em>[$стр]</em> в соответствующее число. При ошибке возвращается 0.<pre class="brush: qsp">яблоки = VAL($яблоки)</pre></div>
</li>
<li class="level1"><div class="li"> <strong>STR(</strong><em>[#число]</em><strong>)</strong> - переводит число (числовое выражение) в соответствующую строку. <pre class="brush: qsp">PL STR(56)</pre></div>
</li>
</ul>

</div>

<h4 id="funkcii_ispolzujuschie_reguljarnye_vyrazhenija">Функции использующие регулярные выражения</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> <strong>STRCOMP(</strong><em>[$строка]</em><strong>,</strong><em>[$шаблон]</em><strong>)</strong> - проводит сравнение строки <em>[$строка]</em> на соответствие регулярному выражению <em>[$шаблон]</em>. Возвращает -1, если строка соответствует шаблону, иначе 0. Сравни с функцией &quot;STRFIND&quot;.</div>
</li>
<li class="level1"><div class="li"> <strong>STRFIND(</strong><em>[$строка]</em><strong>,</strong><em>[$шаблон]</em><strong>,</strong><em>[#номер]</em><strong>)</strong> - возвращает подстроку в строке <em>[$строка]</em>, соответствующую группе с номером <em>[#номер]</em> регулярного выражения <em>[$шаблон]</em>.</div>
<ul>
<li class="level2"><div class="li"> Если подстрока с указанным номером отсутствует, то возвращается пустая строка.</div>
</li>
<li class="level2"><div class="li"> Нумерация групп подстрок начинается с 1.</div>
</li>
<li class="level2"><div class="li"> Если параметр [#номер] отсутствует или равен 0, то возвращаются подстрока, соответсвующая всему регулярному выражению.</div>
</li>
<li class="level2"><div class="li"> <em>Примеры:</em><pre class="brush: qsp">
STRFIND(&#039; идти к пещере&#039;, &#039;^(\S+)\s(\S+)\s(\S+)$&#039;, 0) &amp;! &#039;&#039;
STRFIND(&#039;идти к пещере&#039;, &#039;^(\S+)\s(\S+)\s(\S+)$&#039;, 1)  &amp;! &#039;идти&#039;
STRFIND(&#039;идти к пещере&#039;, &#039;^(\S+)\s(\S+)\s(\S+)$&#039;, 2)  &amp;! &#039;к&#039;
STRFIND(&#039;идти к пещере&#039;, &#039;^(\S+)\s(\S+)\s(\S+)$&#039;, 3)  &amp;! &#039;пещере&#039;
STRFIND(&#039;идти к дому&#039;, &#039;к\s(\S+)&#039;, 0) &amp;! &#039;к дому&#039; 
STRFIND(&#039;идти к дому&#039;, &#039;к\s(\S+)&#039;)    &amp;! &#039;к дому&#039;
STRFIND(&#039;идти к дому&#039;, &#039;к\s(\S+)&#039;, 1) &amp;! &#039;дому&#039;
STRFIND(&#039;идти к своему дому&#039;, &#039;к\s(\S+)&#039;, 1) &amp;! &#039;своему&#039;
</pre></div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <strong>STRPOS(</strong><em>[$строка]</em><strong>,</strong><em>[$шаблон]</em><strong>,</strong><em>[#номер]</em><strong>)</strong> - возвращает позицию символа, с которого начинается вхождение подстроки в строку <em>[$строка]</em>, соответствующей группе с номером <em>[#номер]</em> регулярного выражения <em>[$шаблон]</em>.</div>
<ul>
<li class="level2"><div class="li"> Если подстрока с указанным номером отсутствует, то возвращается 0.</div>
</li>
<li class="level2"><div class="li"> Нумерация групп подстрок начинается с 1.</div>
</li>
<li class="level2"><div class="li"> Если параметр <em>[#номер]</em> отсутствует или равен 0, то возвращается позиция символа, с которого начинается вхождение подстроки, соответствующей всему регулярному выражению.</div>
</li>
<li class="level2"><div class="li"> <em>Примеры:</em><pre class="brush: qsp">
STRPOS(&#039; идти к пещере&#039;, &#039;^(\S+)\s(\S+)\s(\S+)$&#039;, 0) &amp;! 0
STRPOS(&#039;идти к пещере&#039;, &#039;^(\S+)\s(\S+)\s(\S+)$&#039;, 1)  &amp;! 1
STRPOS(&#039;идти к пещере&#039;, &#039;^(\S+)\s(\S+)\s(\S+)$&#039;, 2)  &amp;! 6
STRPOS(&#039;идти к пещере&#039;, &#039;^(\S+)\s(\S+)\s(\S+)$&#039;, 3)  &amp;! 8
STRPOS(&#039;идти к пещере&#039;, &#039;^(\S+)\s(\S+)(\s(\S+))?$&#039;, 4) &amp;! 8
STRPOS(&#039;идти к дому&#039;, &#039;к\s(\S+)&#039;, 0) &amp;! 6
STRPOS(&#039;идти к дому&#039;, &#039;к\s(\S+)&#039;)    &amp;! 6
STRPOS(&#039;идти к дому&#039;, &#039;к\s(\S+)&#039;, 1) &amp;! 8
STRPOS(&#039;идти к своему дому&#039;, &#039;к\s(\S+)&#039;, 1) &amp;! 8
</pre></div>
</li>
</ul>
</li>
</ul>
<hr />

<p>
<a href="/help/regexp" class="wikilink1" title="help:regexp">Вперёд: Регулярные выражения</a>
</p>

</div>
<!-- EDIT5 SECTION "Функции" [4748-] --><div class="footnotes">
<div class="fn"><sup><a href="#fnt__1" id="fn__1" class="fn_bot">1)</a></sup> 
<strong>INSTR(</strong><em>[$строка]</em><strong>,</strong><em>[$поиск]</em><strong>,</strong><em>[#начало]</em><strong>)</strong></div>
</div>
</div>
</body>
</html>
