<!DOCTYPE html>
<html lang="ru">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <link id="favicon" rel="icon" type="image/x-icon" href="../res/favicon.ico" />
    <link type="text/css" rel="stylesheet" href="../res/css/easy.library.css" />
    <link type="text/css" rel="stylesheet" href="../res/css/offline.window.css" />
    <link type="text/css" rel="stylesheet" href="../res/css/qsp_code.css" />
    <title>QSP: Статьи</title>
</head>
    
<body>
    <div class="em_Main">
        <div class="em_AROUND">
            <h1>Статьи по разработке игр на QSP</h1>
            <!-- body start -->
<div style="display:flex;justify-content:space-between;"><div><a href="https://aleksversus.github.io/howdo_faq/articles/classic.config_0005.html" class="emHREFTT">&lt; Назад, к странице 6</a></div><div><a href="https://aleksversus.github.io/howdo_faq/articles/stylization_manifest_0007.html" class="emHREFTT">Вперёд, к странице 8 &gt;</a></div></div>
<h6 id="gosub_func_args">Операторы, функции, аргументы. GOSUB, FUNC, ARGS</h6><p>
Очень часто новички, пришедшие в QSP, задают вопрос: что такое ARGS, и как их использовать? И хотя информации по данному вопросу очень много, вся она довольно разрознена, отвечает на вопрос слишком общо, или слишком конкретно, вплоть до одного единственного примера.
</p>
<p>
Эта статья является попыткой ответить на данный вопрос максимально просто, точно и подробно, насколько это в принципе будет возможно.
</p>
<img src="https://i.ibb.co/0q9D7Jb/QSP.png" alt="AleksVersus-GAM-RUS" class="em_IMG" /><p>
Все примеры рекомендую испытать самостоятельно, побаловаться, изменяя значения, и посмотреть, что из этого выйдет. Теория без практики — мертва.
</p>
<blockquote>
<p>
Обратите внимание. В статье приведены фрагменты кода QSP, некоторые из которых написаны в формате TXT2GAM. Такие фрагменты легко отличить, так как в них отдельными строками прописывается начало локации (<span class="em_BLCK"># start</span>) и её конец (<span class="em_BLCK">--- start ---</span>). Если вы работаете в редакторе Quest Generator, данные строчки прописывать в коде локаций не нужно, только содержимое между ними.</p>
</blockquote>
<h6 id="probuem-vodu-nemnogo-opredelenij">Пробуем воду. Немного определений</h6><h6 id="operatory">Операторы</h6><p>
При написании QSP-кода мы всегда используем различные операторы. Например, мы используем оператор <span class="em_BLCK">*pl</span> для вывода текста в окно основного описания, или оператор <span class="em_BLCK">addobj</span> для добавления предмета, или например оператор <span class="em_BLCK">goto</span> для перехода между локациями. Иными словами операторы нужны нам, чтобы что-то <span class="em_BLCK">делать</span> с игрой или с плеером, выполнять какие-то процедуры.
</p>
<p>
Если мы внимательно посмотрим на все эти операторы, то мы увидим, что для некоторых операторов, чтобы они что-то сделали, нужно обязательно указать какое-то значение. Например, чтобы оператор <span class="em_BLCK">addobj</span> добавил предмет в окно предметов, мы должны указать название предмета для этого оператора:
</p>
<div class="Monokai-Code">
<span class="Monokai-Operator">addobj</span>&nbsp;<span class="Monokai-String">"Апельсин"</span><br/>
</div>
<img src="https://i.ibb.co/XCyNJqv/image.png" alt="AleksVersus-GAM-RUS" class="em_IMG" /><p>
Такое указание значения в программировании называется <span class="em_BLCK">передачей значения</span> оператору. Оператор принимает от нас указанное значение и что-то с ним делает. Например, создаёт предмет с указанным названием. Само значение, которое мы передаём оператору, нередко называют <span class="em_BLCK">аргументом</span> или <span class="em_BLCK">параметром</span>.
</p>
<p>
Поэтому если вы встречаете где-то такое выражение "передаю параметры оператору", или "указываю аргументы для оператора", это значит, что оператору передаются какие-то значения, которые он принимает и обрабатывает.
</p>
<p>
В случае с оператором <span class="em_BLCK">addobj</span> мы должны обязательно указать хотя бы один аргумент, но в QSP есть операторы, для которых можно совсем не указывать аргументы. Например, оператору <span class="em_BLCK">clear</span>, который очищает окно дополнительного описания, не нужны аргументы, он и так знает, что ему делать. Или оператор <span class="em_BLCK">killall</span>, ему тоже не нужен аргумент. Ещё, совсем без аргумента, может использоваться оператор <span class="em_BLCK">*pl</span>, тогда он просто выводит на экран пустую строку и совершает переход на новую строку в окне основного описания.
</p>
<p>
Некоторым операторам можно передавать больше одного аргумента. Если взглянуть на тот же оператор <span class="em_BLCK">addobj</span>, мы можем передавать ему и два и три аргумента:
</p>
<div class="Monokai-Code">
<span class="Monokai-Operator">addobj</span>&nbsp;<span class="Monokai-String">"Апельсин"</span><span class="Monokai-Operator">,</span><span class="Monokai-String">"pic/orange.png"</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">4</span><br/>
</div>
<p>
В данном случае мы передаём оператору три аргумента: название предмета, картинку предмета, и позицию в окне предметов, в которую мы данный предмет хотим поместить. Аргументы перечисляются через запятую.
</p>
<p>
В зависимости от числа принимаемых аргументов, операторы могут вести себя по-разному:
</p>
<div class="Monokai-Code">
<span class="Monokai-Operator">killvar</span>&nbsp;<span class="Monokai-String">'$mass'</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">4</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;два&nbsp;аргумента.&nbsp;Удаляем&nbsp;ячейку&nbsp;номер&nbsp;4&nbsp;из&nbsp;массива&nbsp;$mass</span><br/>
<span class="Monokai-Operator">killvar</span>&nbsp;<span class="Monokai-String">'$array'</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;один&nbsp;аргумент.&nbsp;Удаляем&nbsp;весь&nbsp;массив&nbsp;$array</span><br/>
<span class="Monokai-Operator">killvar</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;без&nbsp;аргументов.&nbsp;Удаляет&nbsp;все&nbsp;массивы&nbsp;и&nbsp;переменные&nbsp;в&nbsp;игре</span><br/>
</div>
<p>
Нужно помнить, сколько аргументов ожидает получить каждый оператор. Операторы типа <span class="em_BLCK">clear</span> и <span class="em_BLCK">killall</span> вообще не ждут аргументов, поэтому передавать им какие-либо значения бесполезно. Оперторы типа <span class="em_BLCK">addobj</span>, <span class="em_BLCK">goto</span> и <span class="em_BLCK">act</span> ждут хотя бы один аргумент, но могут принимать больше. Если передать оператору больше аргументов, чем он может принять, или меньше, чем он ожидает, это приведёт к ошибке №120: "Неверное число аргументов оператора/функции", — поэтому будьте внимательны при написании кода и чаще сверяйтесь со справкой.
</p>
<img src="https://i.ibb.co/R6WQKpb/4.png" alt="AleksVersus-GAM-RUS" class="em_IMG" /><h6 id="funktsii">Функции</h6><p>
Помимо операторов в QSP есть ещё такие вещи, как <span class="em_BLCK">функции</span>. Функции тоже могут что-нибудь делать с игрой или плеером, но в основном они нужны, чтобы получать какие-либо значения.
</p>
<p>
Например, с помощью функции <span class="em_BLCK">rnd</span> мы можем получить случайное число от 1 до 1000:
</p>
<div class="Monokai-Code">
num<span class="Monokai-Operator">=</span><span class="Monokai-Func">rnd</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;в&nbsp;переменную&nbsp;num&nbsp;запишется&nbsp;случайное&nbsp;число&nbsp;от&nbsp;1&nbsp;до&nbsp;1000</span><br/>
</div>
<p>
В этом и заключается основное отличие функции от оператора, функция умеет <span class="em_BLCK">возвращать значение</span>. Значение, возвращаемое функцией, ещё называют <span class="em_BLCK">результатом</span>, поэтому можно сказать, что <span class="em_BLCK">функция возвращает результат</span>.
</p>
<img src="https://i.ibb.co/tbwMRvc/image.png" alt="AleksVersus-GAM-RUS" class="em_IMG" /><p>
Точно так же, как оператор, функция может принимать аргументы, однако аргументы, которые мы хотим передать функции, нужно заключать в круглые скобки, в отличие от операторов, которым такие скобки не нужны.
</p>
<div class="Monokai-Code">
num<span class="Monokai-Operator">=</span><span class="Monokai-Func">rand</span><span class="Monokai-Operator">(</span><span class="Monokai-Numeric">1</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">1000</span><span class="Monokai-Operator">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;аргументы&nbsp;функции&nbsp;rand&nbsp;заключены&nbsp;в&nbsp;скобки</span><br/>
<span class="Monokai-Operator">killvar</span>&nbsp;<span class="Monokai-String">'$mass'</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">9</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;аргументы&nbsp;оператора&nbsp;killvar&nbsp;не&nbsp;нужно&nbsp;заключать&nbsp;в&nbsp;скобки</span><br/>
</div>
<p>
Таким образом функция <span class="em_BLCK">принимает аргументы</span> и <span class="em_BLCK">возвращает результат</span>. Или <span class="em_BLCK">получает параметры</span> и <span class="em_BLCK">возвращает значение</span>. Говорите, как вам удобнее, главное, чтобы вы понимали, что все эти слова значат.
</p>
<p>
В QSP есть много разных функций, и так же, как и операторам, им можно передавать разное число аргументов. Есть функции, которым вообще не нужно передавать никаких аргументов, например <span class="em_BLCK">$selact</span>, <span class="em_BLCK">$curact</span>, <span class="em_BLCK">$curloc</span> и т.д. А есть функции, которые требуют строго определённого числа аргументов, например <span class="em_BLCK">isnum</span>, которая ожидает всегда только один аргумент, не больше, не меньше. Ну и конечно же есть функции, которым можно передавать разное число аргументов, и чьё поведение будет меняться в зависимости от числа аргументов:
</p>
<div class="Monokai-Code">
<span class="Monokai-Func">max</span><span class="Monokai-Operator">(</span><span class="Monokai-String">'mass'</span><span class="Monokai-Operator">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;передан&nbsp;один&nbsp;строковый&nbsp;аргумент.&nbsp;Функция&nbsp;вернёт&nbsp;максимальное&nbsp;число&nbsp;из&nbsp;массива&nbsp;mass</span><br/>
<span class="Monokai-Func">max</span><span class="Monokai-Operator">(</span><span class="Monokai-String">'mass'</span><span class="Monokai-Operator">,</span><span class="Monokai-String">'gass'</span><span class="Monokai-Operator">,</span><span class="Monokai-String">'dass'</span><span class="Monokai-Operator">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;передано&nbsp;три&nbsp;строковых&nbsp;аргумента.&nbsp;Функция&nbsp;вернёт&nbsp;тот&nbsp;из&nbsp;них,&nbsp;который&nbsp;идёт&nbsp;позже&nbsp;в&nbsp;алфавитном&nbsp;порядке</span><br/>
<span class="Monokai-Func">max</span><span class="Monokai-Operator">(</span><span class="Monokai-Numeric">12</span><span class="Monokai-Operator">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;данная&nbsp;строчка&nbsp;кода&nbsp;вызовет&nbsp;ошибку&nbsp;114</span><br/>
<span class="Monokai-Func">max</span><span class="Monokai-Operator">(</span><span class="Monokai-Numeric">12</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">34</span><span class="Monokai-Operator">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;функция&nbsp;вернёт&nbsp;наибольшее&nbsp;из&nbsp;двух&nbsp;чисел&nbsp;(34)</span><br/>
</div>
<img src="https://i.ibb.co/CHdzh7k/function-get-gift.png" alt="AleksVersus-GAM-RUS" class="em_IMG" /><h6 id="plavaem-u-berega-pol_zovatel_skie-funktsii-i-protsedury">Плаваем у берега. Пользовательские функции и процедуры</h6><p>
Как быть, когда нам не хватает функционала уже имеющихся в QSP функций и операторов? Что если нам нужно, например, постоянно выводить на экран значения некоторых переменных, причём не просто выводить, а выводить эти значения внутри определённой строки. Например, у нас есть вот такой набор переменных:
</p>
<div class="Monokai-Code">
$name<span class="Monokai-Operator">=</span><span class="Monokai-String">'Леголас'</span><br/>
age<span class="Monokai-Operator">=</span><span class="Monokai-Numeric">137</span><br/>
$arms<span class="Monokai-Operator">=</span><span class="Monokai-String">'Лук&nbsp;и&nbsp;стрелы'</span><br/>
</div>
<p>
И мы хотим периодически видеть на экране что-то вроде:
</p>
<div class="Monokai-Code">
Вас&nbsp;зовут&nbsp;Леголас.
<br/>Вам&nbsp;137&nbsp;лет.
<br/>Вы&nbsp;используете&nbsp;Лук&nbsp;и&nbsp;стрелы.
</div>
<p>
Для этой ситуации в QSP предусмотрено создание собственных аналогов функций и операторов. Для этого мы должны создать отдельную локацию и написать на ней нужный код. В нашем случае локация будет называться "pl_stat":
</p>
<div class="Monokai-Code">
<span class="Monokai-Operator"></span><span class="Monokai-Comment">!&nbsp;#&nbsp;pl_stat</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"Вас&nbsp;зовут&nbsp;&lt;&lt;$name&gt;&gt;."</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"Вам&nbsp;&lt;&lt;age&gt;&gt;&nbsp;лет."</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"Вы&nbsp;используете&nbsp;&lt;&lt;$arms&gt;&gt;."</span><br/>
</div>
<p>
И теперь, когда у нас есть такая локация, нам достаточно вызвать её с помощью оператора <span class="em_BLCK">gosub</span> в любом месте нашей игры, и мы увидим на экране нужный текст со вставленной информацией из наших переменных.
</p>
<div class="Monokai-Code">
<span class="Monokai-Operator">gosub</span>&nbsp;<span class="Monokai-String">'pl_stat'</span><br/>
</div>
<p>
Очевидно, что работа данной локации стала похожа на работу некоей расширенной версии оператора <span class="em_BLCK">*pl</span>.
</p>
<p>
Что же дальше? А дальше нам хотелось бы написать какой-нибудь аналог функции, например, чтобы посчитать квадрат числа N. И мы можем это сделать. Создадим локацию "square" и на ней напишем следующий код:
</p>
<div class="Monokai-Code">
<span class="Monokai-Operator"></span><span class="Monokai-Comment">!&nbsp;#&nbsp;square</span><br/>
R<span class="Monokai-Operator">=</span>N<span class="Monokai-Operator">*</span>N<br/>
</div>
<p>
Вот такой простой код. Если мы вызовем данную локацию с помощью <span class="em_BLCK">func</span>, то в переменную R у нас запишется результат возведения в квадрат числа N.
</p>
<div class="Monokai-Code">
N<span class="Monokai-Operator">=</span><span class="Monokai-Numeric">12</span><br/>
<span class="Monokai-Func">func</span><span class="Monokai-Operator">(</span><span class="Monokai-String">'square'</span><span class="Monokai-Operator">)</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;R&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;на&nbsp;экране&nbsp;появится&nbsp;число&nbsp;144</span><br/>
</div>
<p>
Однако с таким же успехом мы можем вызывать данную локацию через <span class="em_BLCK">gosub</span>, ведь результат вычислений всё равно пишется в переменную R прямо на локации "square". Зачем нам здесь использовать <span class="em_BLCK">func</span>? Действительно незачем. Сейчас наша локация просто вычисляет значение и записывает его в переменную, однако мы можем заставить её <span class="em_BLCK">возвращать значение</span>! То есть она будет работать почти как полноценная функция QSP.
</p>
<p>
Чтобы заставить нашу локацию возвращать значение, мы должны результат вычислений записать в специальную системную переменную <span class="em_BLCK">result</span>.
</p>
<div class="Monokai-Code">
<span class="Monokai-Operator"></span><span class="Monokai-Comment">!&nbsp;#&nbsp;square</span><br/>
<span class="Monokai-SysVar">result</span><span class="Monokai-Operator">=</span>N<span class="Monokai-Operator">*</span>N<br/>
</div>
<p>
Теперь наша локация будет возвращать нам значение аналогично любой встроенной в QSP функции. А значит мы можем присвоить значение переменной уже в той локации, из которой вызвали локацию "square":
</p>
<div class="Monokai-Code">
N<span class="Monokai-Operator">=</span><span class="Monokai-Numeric">12</span><br/>
R<span class="Monokai-Operator">=</span><span class="Monokai-Func">func</span><span class="Monokai-Operator">(</span><span class="Monokai-String">'square'</span><span class="Monokai-Operator">)</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;R&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;на&nbsp;экране&nbsp;появится&nbsp;число&nbsp;144</span><br/>
</div>
<p>
Или вообще не использовать промежуточную переменную:
</p>
<div class="Monokai-Code">
N<span class="Monokai-Operator">=</span><span class="Monokai-Numeric">12</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-Func">func</span><span class="Monokai-Operator">(</span><span class="Monokai-String">'square'</span><span class="Monokai-Operator">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;на&nbsp;экране&nbsp;появится&nbsp;число&nbsp;144</span><br/>
</div>
<p>
Уникальность переменной <span class="em_BLCK">result</span> заключается в том, что она действительно уникальная на каждой локации, из которой мы её вызываем. То есть, если мы на локации "start" (для примера) записали в переменную <span class="em_BLCK">result</span> какое-либо значение, то, если мы вызовем из локации "start" локацию "square", где мы тоже используем <span class="em_BLCK">result</span>, на локации "start" значение в переменной <span class="em_BLCK">result</span> не изменится. Это легко проверить:
</p>
<div class="Monokai-Code">
<span class="Monokai-StartLoc">#&nbsp;start</span><br/>
<span class="Monokai-SysVar">result</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">123</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;записываем&nbsp;число&nbsp;в&nbsp;переменную&nbsp;result</span><br/>
N<span class="Monokai-Operator">=</span><span class="Monokai-Numeric">24</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-Func">func</span><span class="Monokai-Operator">(</span><span class="Monokai-String">'square'</span><span class="Monokai-Operator">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;выведет&nbsp;на&nbsp;экран&nbsp;576</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-SysVar">result</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;выведет&nbsp;на&nbsp;экран&nbsp;123</span><span class="Monokai-EndLoc"><br/>
---&nbsp;start&nbsp;---</span><span class="Monokai-StartLoc"><br/>
<br/>
#&nbsp;square</span><br/>
<span class="Monokai-SysVar">result</span>&nbsp;<span class="Monokai-Operator">=</span>&nbsp;N&nbsp;<span class="Monokai-Operator">*</span>&nbsp;N&nbsp;<br/>
<span class="Monokai-Operator">-</span><span class="Monokai-Operator">-</span><span class="Monokai-Operator">-</span>&nbsp;square&nbsp;<span class="Monokai-Operator">-</span><span class="Monokai-Operator">-</span><span class="Monokai-Operator">-</span><br/>
</div>
<p>
И всё-таки наш код не такой удобный, как бы нам хотелось, ведь функциям QSP мы просто передаём аргументы, и не заполняем заранее разные переменные перед тем, как вызвать ту или иную функцию. Что же делать?
</p>
<p>
А всё очень просто. Разработчик QSP предусмотрел такую необходимость, и мы можем передавать нашей локации до девяти аргументов (в плеере версии 5.7.0). Просто берём и внутри круглых скобок ставим запятую после названия нашей локации "square" и указываем значение, которое хотим передать локации:
</p>
<div class="Monokai-Code">
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-Func">func</span><span class="Monokai-Operator">(</span><span class="Monokai-String">'square'</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">25</span><span class="Monokai-Operator">)</span><br/>
</div>
<p>
Вот и всё. На локацию "square" передан <span class="em_BLCK">параметр</span>, или иными словами локация "square" <span class="em_BLCK">получила в качестве аргумента</span> значение <span class="em_BLCK">25</span>. Но как же это значение использовать на локации "square", ведь теперь мы не вносили его ни в одну переменную. А вся хитрость в том, что данное значение плеер сам автоматически вносит в специальный системный массив <span class="em_BLCK">args</span>. В данном случае число <span class="em_BLCK">25</span> нужно искать в нулевой ячейке этого массива на локации "square".
</p>
<div class="Monokai-Code">
<span class="Monokai-Operator"></span><span class="Monokai-Comment">!&nbsp;#&nbsp;square</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;выведет&nbsp;на&nbsp;экран&nbsp;число,&nbsp;которое&nbsp;мы&nbsp;отправляем&nbsp;на&nbsp;эту&nbsp;локацию</span><br/>
<span class="Monokai-SysVar">result</span><span class="Monokai-Operator">=</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">*</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;вместо&nbsp;N&nbsp;мы&nbsp;теперь&nbsp;используем&nbsp;число&nbsp;из&nbsp;нулевой&nbsp;ячейки&nbsp;массива&nbsp;args</span><br/>
</div>
<p>
Попробуйте запустить код из предыдущего примера, но теперь без переменной N:
</p>
<div class="Monokai-Code">
<span class="Monokai-StartLoc">#&nbsp;start</span><br/>
<span class="Monokai-SysVar">result</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">123</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;записываем&nbsp;число&nbsp;в&nbsp;переменную&nbsp;result</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-Func">func</span><span class="Monokai-Operator">(</span><span class="Monokai-String">'square'</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">24</span><span class="Monokai-Operator">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;выведет&nbsp;на&nbsp;экран&nbsp;576</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-SysVar">result</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;выведет&nbsp;на&nbsp;экран&nbsp;123</span><span class="Monokai-EndLoc"><br/>
---&nbsp;start&nbsp;---</span><span class="Monokai-StartLoc"><br/>
<br/>
#&nbsp;square</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;поскольку&nbsp;выше&nbsp;мы&nbsp;передаём&nbsp;на&nbsp;square&nbsp;число&nbsp;24,&nbsp;то&nbsp;эта&nbsp;команда&nbsp;выведет&nbsp;на&nbsp;экран&nbsp;число&nbsp;24</span><br/>
<span class="Monokai-SysVar">result</span><span class="Monokai-Operator">=</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">*</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-EndLoc"><br/>
---&nbsp;square&nbsp;---</span><br/>
</div>
<p>
Итак, мы знаем, что можем передавать на нашу локацию-функцию до девяти аргументов. Мы нашли, где искать аргумент, если он один. А где же искать все остальные? Всё очень просто. Каждый последующий аргумент будет автоматически помещаться в следующую ячейку массива args. Таким образом, если мы передадим на локацию все девять аргументов, мы сможем их найти в массиве args, в ячейках с нулевой по восьмую.
</p>
<p>
Давайте напишем функцию, которая будет складывать девять чисел, передаваемых ей в качестве аргументов. Для этого создаём локацию "summ":
</p>
<div class="Monokai-Code">
<span class="Monokai-Operator"></span><span class="Monokai-Comment">!&nbsp;#&nbsp;summ</span><br/>
<span class="Monokai-SysVar">result</span><span class="Monokai-Operator">=</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">+</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">1</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">+</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">2</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">+</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">3</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">+</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">4</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">+</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">5</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">+</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">6</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">+</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">7</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">+</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">8</span><span class="Monokai-Operator">]</span><br/>
</div>
<p>
А вот примеры вызова этой локации "summ". Мы передаём на эту локацию девять слагаемых, а она возвращает нам сумму всех девяти слагаемых:
</p>
<div class="Monokai-Code">
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-Func">func</span><span class="Monokai-Operator">(</span><span class="Monokai-String">'summ'</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">1</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">2</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">3</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">4</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">5</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">6</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">7</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">8</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">9</span><span class="Monokai-Operator">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;на&nbsp;экране&nbsp;появится&nbsp;число&nbsp;45</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-Func">func</span><span class="Monokai-Operator">(</span><span class="Monokai-String">'summ'</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">23</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">45</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">67</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">89</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">11</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">23</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">5</span><span class="Monokai-Operator">,</span><span class="Monokai-Operator">-</span><span class="Monokai-Numeric">1</span><span class="Monokai-Operator">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;на&nbsp;экране&nbsp;появится&nbsp;число&nbsp;262</span><br/>
</div>
<p>
Если мы укажем не все аргументы, значения несуществующих ячеек массива <span class="em_BLCK">args</span> на локации "summ" окажутся равны нулю:
</p>
<div class="Monokai-Code">
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-Func">func</span><span class="Monokai-Operator">(</span><span class="Monokai-String">'summ'</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">1</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">2</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">3</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">4</span><span class="Monokai-Operator">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;на&nbsp;экране&nbsp;появится&nbsp;число&nbsp;10</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-Func">func</span><span class="Monokai-Operator">(</span><span class="Monokai-String">'summ'</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">23</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">45</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">67</span><span class="Monokai-Operator">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;на&nbsp;экране&nbsp;появится&nbsp;число&nbsp;135</span><br/>
</div>
<p>
С массивом <span class="em_BLCK">args</span> можно работать, как с обычным массивом QSP. Т.е. вы легко можете добавлять в него новые ячейки, или удалять с помощью <span class="em_BLCK">killvar</span>. Однако у этого массива есть одна особенность, которая роднит его с переменной <span class="em_BLCK">result</span>. Для каждой отдельной локации массив <span class="em_BLCK">args</span> уникален. То есть вы можете помещать в него любые значения, увеличивать или уменьшать его размер, это никак не повлияет на массив <span class="em_BLCK">args</span> в других локациях.
</p>
<p>
Более того. После того, как код локации, на которой вы работали с массивом <span class="em_BLCK">args</span>, будет выполнен, этот уникальный массив будет полностью уничтожен, а значит он уже не будет занимать место в оперативной памяти. Но, надо понимать, что в других работающих локациях свои собственные массивы <span class="em_BLCK">args</span> продолжат существовать.
</p>
<div class="Monokai-Code">
<span class="Monokai-Operator"></span><span class="Monokai-Comment">!&nbsp;данный&nbsp;код&nbsp;выведет&nbsp;на&nbsp;экран&nbsp;последовательно&nbsp;числа&nbsp;11,&nbsp;1507,&nbsp;19</span><span class="Monokai-StartLoc"><br/>
#&nbsp;start</span><br/>
<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">19</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;это&nbsp;нулевая&nbsp;ячейка&nbsp;массива&nbsp;args&nbsp;на&nbsp;локации&nbsp;start,&nbsp;ей&nbsp;присваиваем&nbsp;19</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-Func">func</span><span class="Monokai-Operator">(</span><span class="Monokai-String">'foo'</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">11</span><span class="Monokai-Operator">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;выведет&nbsp;на&nbsp;экран&nbsp;1507</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;выведет&nbsp;на&nbsp;экран&nbsp;19</span><span class="Monokai-EndLoc"><br/>
---&nbsp;start&nbsp;---</span><span class="Monokai-StartLoc"><br/>
<br/>
#&nbsp;foo</span><span class="Monokai-Operator"><br/>
</span><span class="Monokai-Comment">!&nbsp;на&nbsp;локации&nbsp;foo&nbsp;собственный&nbsp;уникальный&nbsp;массив&nbsp;args,</span><span class="Monokai-Operator"><br/>
</span><span class="Monokai-Comment">!&nbsp;в&nbsp;который&nbsp;автоматически&nbsp;записываются&nbsp;значения,&nbsp;переданные&nbsp;на&nbsp;локацию&nbsp;в&nbsp;виде&nbsp;аргументов</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;выше&nbsp;сюда&nbsp;было&nbsp;передано&nbsp;число&nbsp;11,&nbsp;вот&nbsp;его&nbsp;мы&nbsp;и&nbsp;увидим&nbsp;на&nbsp;экране</span><br/>
<span class="Monokai-SysVar">result</span>&nbsp;<span class="Monokai-Operator">=</span>&nbsp;<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span>&nbsp;<span class="Monokai-Operator">*</span>&nbsp;<span class="Monokai-Numeric">137</span><span class="Monokai-EndLoc"><br/>
---&nbsp;foo&nbsp;---</span><br/>
</div>
<p>
Давайте вернёмся к локации "pl_stat", она, как вы помните, выводила на экран значения определённых переменных. Теперь мы можем переписать и её, чтобы она работала не с конкретными переменными, а с аргументами, которые мы на эту локацию передаём.
</p>
<div class="Monokai-Code">
<span class="Monokai-Operator"></span><span class="Monokai-Comment">!&nbsp;#&nbsp;pl_stat</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"Вас&nbsp;зовут&nbsp;&lt;&lt;$args[0]&gt;&gt;."</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"Вам&nbsp;&lt;&lt;args[1]&gt;&gt;&nbsp;лет."</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"Вы&nbsp;используете&nbsp;&lt;&lt;$args[2]&gt;&gt;."</span><br/>
</div>
<p>
Как видите, мы подставляем в строки данные из <span class="em_BLCK">$args[0]</span>, <span class="em_BLCK">args[1]</span> и <span class="em_BLCK">$args[2]</span>, где соответсвенно мы должны найти имя, возраст и оружие персонажа. Значит и передавать на "pl_stat" аргументы мы должны в той же последовательности:
</p>
<div class="Monokai-Code">
$name<span class="Monokai-Operator">=</span><span class="Monokai-String">'Леголас'</span><br/>
age<span class="Monokai-Operator">=</span><span class="Monokai-Numeric">137</span><br/>
$arms<span class="Monokai-Operator">=</span><span class="Monokai-String">'Лук&nbsp;и&nbsp;стрелы'</span><span class="Monokai-Operator"><br/>
</span><span class="Monokai-Comment">!&nbsp;вызов&nbsp;локации&nbsp;`pl_stat`</span><br/>
<span class="Monokai-Operator">gosub</span>&nbsp;<span class="Monokai-String">"pl_stat"</span><span class="Monokai-Operator">,</span>$name<span class="Monokai-Operator">,</span>age<span class="Monokai-Operator">,</span>$arms<br/>
</div>
<p>
Это даст на экране всё тот же текст:
</p>
<div class="Monokai-Code">
Вас&nbsp;зовут&nbsp;Леголас.
<br/>Вам&nbsp;137&nbsp;лет.
<br/>Вы&nbsp;используете&nbsp;Лук&nbsp;и&nbsp;стрелы.
</div>
<p>
Само собой, если нет необходимости, заранее объявлять переменные не обязательно:
</p>
<div class="Monokai-Code">
<span class="Monokai-Operator">gosub</span>&nbsp;<span class="Monokai-String">"pl_stat"</span><span class="Monokai-Operator">,</span><span class="Monokai-String">'Леголас'</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">137</span><span class="Monokai-Operator">,</span><span class="Monokai-String">'Лук&nbsp;и&nbsp;стрелы'</span><br/>
</div>
<p>
И теперь, один раз написанная локация позволяет нам выводить текст с нужными вставками сколько угодно раз:
</p>
<div class="Monokai-Code">
<span class="Monokai-Operator">gosub</span>&nbsp;<span class="Monokai-String">'pl_stat'</span><span class="Monokai-Operator">,</span><span class="Monokai-String">'Гимли'</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">91</span><span class="Monokai-Operator">,</span><span class="Monokai-String">'Молот'</span><br/>
<span class="Monokai-Operator">gosub</span>&nbsp;<span class="Monokai-String">'pl_stat'</span><span class="Monokai-Operator">,</span><span class="Monokai-String">'Арагорн'</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">29</span><span class="Monokai-Operator">,</span><span class="Monokai-String">'Палаш'</span><br/>
<span class="Monokai-Operator">gosub</span>&nbsp;<span class="Monokai-String">'pl_stat'</span><span class="Monokai-Operator">,</span><span class="Monokai-String">'Фродо&nbsp;Бэггинс'</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">19</span><span class="Monokai-Operator">,</span><span class="Monokai-String">'Кольцо&nbsp;Всевластия'</span><br/>
</div>
<p>
Вот результат таких вызовов:
</p>
<div class="Monokai-Code">
Вас&nbsp;зовут&nbsp;Гимли.
<br/>Вам&nbsp;91&nbsp;лет.
<br/>Вы&nbsp;используете&nbsp;Молот.
<br/>Вас&nbsp;зовут&nbsp;Арагорн.
<br/>Вам&nbsp;29&nbsp;лет.
<br/>Вы&nbsp;используете&nbsp;палаш.
<br/>Вас&nbsp;зовут&nbsp;Фродо&nbsp;Бэггинс.
<br/>Вам&nbsp;19&nbsp;лет.
<br/>Вы&nbsp;используете&nbsp;Кольцо&nbsp;Всевластия.
</div>
<p>
<span class="em_BLCK">Объявить переменную</span> — для QSP значит записать в программе её имя. Когда мы присваиваем переменной какое-либо значение, мы тем самым автоматически объявляем переменную. Ещё это называется <span class="em_BLCK">инициализировать</span> переменную.
</p>
<h6 id="glubokoe-pogruzhenie-tonkosti-i-niuansy-pri-napisanii-sobstvennyh-funktsij-i-protsedur">Глубокое погружение. Тонкости и нюансы при написании собственных функций и процедур</h6><p>
Когда мы писали локации типа "square" и "summ", для удобства мы называли их функциями. И ещё мы говорили, что передаём им различные аргументы. Так мы говорили именно для упрощения понимания того, зачем нам нужны <span class="em_BLCK">args</span> и <span class="em_BLCK">result</span> на локациях.
</p>
<p>
На самом деле ни одна локация в QSP фактически не является функцией, несмотря на то, что мы действительно передаём на неё аргументы, и можем вернуть из неё некий результат.
</p>
<p>
Функцией является только функция <span class="em_BLCK">func</span>, и как не сложно догадаться, эта функция всегда ждёт минимум один аргумент — название локации, которую она должна выполнить. Именно функция <span class="em_BLCK">func</span> выполняет код указанной локации, и именно она транслирует на эту локацию в массив <span class="em_BLCK">args</span> все прочие аргументы, "передаваемые на локацию".
</p>
<p>
То же самое касается и оператора <span class="em_BLCK">gosub</span>. Этот оператор вызвает указанную в качестве первого для него аргумента локацию, и транслирует все остальные аргументы в массив <span class="em_BLCK">args</span> на этой локации.
</p>
<p>
Всё это следует понимать, потому что не только оператор <span class="em_BLCK">gosub</span> и функция <span class="em_BLCK">func</span> могут принимать дополнительные аргументы и транслировать их в код вашей локации в виде значений в массиве <span class="em_BLCK">args</span>. На это способны так же операторы <span class="em_BLCK">goto</span> и <span class="em_BLCK">xgoto</span>. Да, представьте себе. При переходе на новую локацию с помощью <span class="em_BLCK">goto</span> вы можете сразу передать на эту локацию разные данные с предыдущей локации. Например, так вы можете отслеживать, с какой именно локации на текущую был осуществлён переход.
</p>
<p>
В качестве примера привожу код локации "start", на которой реализовано действие перехода с передачей аргумента, и код локации "комната", где в зависимости от того, какое значение мы отправили на эту локацию, выводится разный текст:
</p>
<div class="Monokai-Code">
<span class="Monokai-StartLoc">#&nbsp;start</span><br/>
<span class="Monokai-String">"Начало&nbsp;супер-пупер-мега&nbsp;игры"</span><br/>
<span class="Monokai-Koperator">act</span>&nbsp;<span class="Monokai-String">"Начать"</span><span class="Monokai-Operator">:</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">goto</span>&nbsp;<span class="Monokai-String">"комната"</span><span class="Monokai-Operator">,</span><span class="Monokai-String">"start"</span><br/>
<span class="Monokai-Koperator">end</span><span class="Monokai-EndLoc"><br/>
---&nbsp;start&nbsp;---</span><span class="Monokai-StartLoc"><br/>
<br/>
#&nbsp;комната</span><br/>
<span class="Monokai-Koperator">if</span>&nbsp;<span class="Monokai-SysVar">$args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">=</span><span class="Monokai-String">'start'</span><span class="Monokai-Operator">:</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-String">"История&nbsp;начинается.&nbsp;Вы&nbsp;только&nbsp;что&nbsp;пришли&nbsp;с&nbsp;локации&nbsp;'start',&nbsp;и&nbsp;это&nbsp;означает,&nbsp;что&nbsp;вас&nbsp;ждёт&nbsp;душещипательная&nbsp;катсцена."</span><br/>
<span class="Monokai-Koperator">else</span><span class="Monokai-Operator">:</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-String">"Вы&nbsp;пришли&nbsp;с&nbsp;любой&nbsp;другой&nbsp;локации.&nbsp;Это&nbsp;просто&nbsp;комната."</span><br/>
<span class="Monokai-Koperator">end</span><span class="Monokai-EndLoc"><br/>
---&nbsp;комната&nbsp;---</span><br/>
</div>
<p>
Но и это ещё не всё. Можно передавать аргументы не только в код локаций, но и в код, который выполняется с помощью <span class="em_BLCK">dynamic</span> или <span class="em_BLCK">dyneval</span>.
</p>
<p>
Для примера я напишу код, который будет выводить содержимое всех переданных аргументов, с помощью цикла:
</p>
<div class="Monokai-Code">
<span class="Monokai-Operator"></span><span class="Monokai-Comment">!&nbsp;помещаем&nbsp;код&nbsp;в&nbsp;переменную&nbsp;для&nbsp;удобства</span><br/>
$code&nbsp;<span class="Monokai-Operator">=</span>&nbsp;<span class="Monokai-Operator">{</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;i<span class="Monokai-Operator">=</span><span class="Monokai-Numeric">0</span><span class="Monokai-Markup"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:for</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Koperator">if</span>&nbsp;i<span class="Monokai-Operator">&lt;</span><span class="Monokai-Func">arrsize</span><span class="Monokai-Operator">(</span><span class="Monokai-String">'args'</span><span class="Monokai-Operator">)</span><span class="Monokai-Operator">:</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Koperator">if</span>&nbsp;<span class="Monokai-SysVar">$args</span><span class="Monokai-Operator">[</span>i<span class="Monokai-Operator">]</span><span class="Monokai-Operator">&lt;</span><span class="Monokai-Operator">&gt;</span><span class="Monokai-String">''</span><span class="Monokai-Operator">:</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-SysVar">$args</span><span class="Monokai-Operator">[</span>i<span class="Monokai-Operator">]</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Koperator">else</span><span class="Monokai-Operator">:</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span>i<span class="Monokai-Operator">]</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Koperator">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i<span class="Monokai-Operator">+=</span><span class="Monokai-Numeric">1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">jump</span>&nbsp;<span class="Monokai-String">'for'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Koperator">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">killvar</span>&nbsp;<span class="Monokai-String">'i'</span><br/>
<span class="Monokai-Operator">}</span><span class="Monokai-Operator"><br/>
</span><span class="Monokai-Comment">!&nbsp;выполняем&nbsp;код,&nbsp;передавая&nbsp;ему&nbsp;произвольное&nbsp;число&nbsp;аргументов</span><br/>
<span class="Monokai-Operator">dynamic</span>&nbsp;$code<span class="Monokai-Operator">,</span>&nbsp;<span class="Monokai-String">'Апельсин'</span><span class="Monokai-Operator">,</span>&nbsp;<span class="Monokai-Numeric">12</span><span class="Monokai-Operator">,</span>&nbsp;<span class="Monokai-String">'оранжевый'</span><span class="Monokai-Operator">,</span>&nbsp;<span class="Monokai-Numeric">144</span><br/>
</div>
<p>
На примере кода, помещённого в переменную, видно, что мы работаем с <span class="em_BLCK">args</span>, как с обычными массивом. Т.е. мы можем получить его размер, и обойти все ячейки поочерёдно с помощью цикла. Но значения в массив <span class="em_BLCK">args</span> помещаются автоматически в момент передачи аргументов оператору <span class="em_BLCK">dynamic</span>. Для этого оператора первым и обязательным аргументом является код QSP, записанный в виде строки текста. Все остальные аргументы не обязательны и транслируются в массив <span class="em_BLCK">args</span>, который мы можем использовать уже непосредственно внутри написанного нами кода.
</p>
<p>
Поскольку <span class="em_BLCK">dynamic</span> — это оператор, он не может возвращать нам никаких значений. Чтобы иметь возможность получать значение из написанного таким образом кода, мы должны использовать функцию <span class="em_BLCK">dyneval</span>. И тут действуют те же принципы, что и при написании кода для локаций. Чтобы функция вернула нам значение, мы должны это значение присвоить системной переменной <span class="em_BLCK">result</span>.
</p>
<p>
С помощью <span class="em_BLCK">dyneval</span> напишем функцию, которая возводит число в степень. Прежде всего мы должны представить себе, как будет выглядеть вызов такой функции. Саму функцию мы поместим в переменную <span class="em_BLCK">$pow</span>, и будем пердавать в неё два аргумента: само число и степень, в которую мы хотим это число возвести. То есть вызов нашей функции будет выглядеть так:
</p>
<div class="Monokai-Code">
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-Func">dyneval</span><span class="Monokai-Operator">(</span>$pow<span class="Monokai-Operator">,</span><span class="Monokai-Numeric">3</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">4</span><span class="Monokai-Operator">)</span>&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;возводим&nbsp;число&nbsp;3&nbsp;в&nbsp;четвёртую&nbsp;степень</span><br/>
</div>
<p>
Таким образом в коде функции мы будем использовать два аргумента, значения которых можно получить из массива <span class="em_BLCK">args</span>:
</p>
<div class="Monokai-Code">
$pow&nbsp;<span class="Monokai-Operator">=</span>&nbsp;<span class="Monokai-Operator">{</span><span class="Monokai-Operator"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;args[0]&nbsp;—&nbsp;число,&nbsp;которое&nbsp;хотим&nbsp;возвести&nbsp;в&nbsp;степень</span><span class="Monokai-Operator"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;args[1]&nbsp;—&nbsp;степень,&nbsp;в&nbsp;которую&nbsp;хотим&nbsp;возвести&nbsp;число</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-SysVar">result</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">1</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;сразу&nbsp;присваиваем&nbsp;результату&nbsp;единицу</span><span class="Monokai-Operator"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;теперь&nbsp;с&nbsp;помощью&nbsp;цикла&nbsp;умножаем&nbsp;результат&nbsp;на&nbsp;указанное&nbsp;число</span><span class="Monokai-Operator"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;столько&nbsp;раз,&nbsp;каково&nbsp;значение&nbsp;степени.</span><span class="Monokai-Operator"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;т.е.&nbsp;само&nbsp;значение&nbsp;степени&nbsp;у&nbsp;нас&nbsp;будет&nbsp;счётчиком&nbsp;цикла</span><span class="Monokai-Markup"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:for</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Koperator">if</span>&nbsp;<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">1</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">&gt;</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">:</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-SysVar">result</span><span class="Monokai-Operator">=</span><span class="Monokai-SysVar">result</span><span class="Monokai-Operator">*</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">1</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">-=</span><span class="Monokai-Numeric">1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">jump</span>&nbsp;<span class="Monokai-String">'for'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Koperator">end</span><br/>
<span class="Monokai-Operator">}</span><br/>
</div>
<p>
Нам осталось только протестировать работу функции, чтобы проверить результаты:
</p>
<div class="Monokai-Code">
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-Func">dyneval</span><span class="Monokai-Operator">(</span>$pow<span class="Monokai-Operator">,</span><span class="Monokai-Numeric">3</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">4</span><span class="Monokai-Operator">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;выведет&nbsp;число&nbsp;81</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-Func">dyneval</span><span class="Monokai-Operator">(</span>$pow<span class="Monokai-Operator">,</span><span class="Monokai-Numeric">4</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">3</span><span class="Monokai-Operator">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;выведет&nbsp;число&nbsp;64</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-Func">dyneval</span><span class="Monokai-Operator">(</span>$pow<span class="Monokai-Operator">,</span><span class="Monokai-Numeric">9</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">9</span><span class="Monokai-Operator">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;выведет&nbsp;число&nbsp;387420489</span><br/>
</div>
<p>
И снова обращаю ваше внимание, что называю содержимое переменной <span class="em_BLCK">$pow</span> функцией исключительно для удобства. На самом деле функцией здесь является <span class="em_BLCK">dyneval</span>, именно она принимает все аргументы, в том числе и код, записанный в переменную <span class="em_BLCK">$pow</span> (именно поэтому в круглые скобки мы заключаем и значение переменной <span class="em_BLCK">$pow</span> и все последующие аргументы), а затем выполняет этот код, передавая на него все оставшиеся значения аргументов. Эти значения мы затем можем использовать в коде, благодаря тому, что они автоматически записываются в массив <span class="em_BLCK">args</span> в ячейки, начиная с нулевой. И именно <span class="em_BLCK">dyneval</span> забирает из переменной <span class="em_BLCK">result</span> значение и возвращает его нам.
</p>
<p>
И точно так же, как это происходило на локациях, можно увидеть, что в коде, который мы передаём оператору <span class="em_BLCK">dynamic</span>, или функции <span class="em_BLCK">dyneval</span>, создаётся свой собственный уникальный массив <span class="em_BLCK">args</span> и своя собственная уникальная переменная <span class="em_BLCK">result</span>, которые уничтожаются сразу после выполнения кода.
</p>
<div class="Monokai-Code">
<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">123</span><br/>
<span class="Monokai-SysVar">$result</span><span class="Monokai-Operator">=</span><span class="Monokai-String">'Первый'</span><br/>
$code<span class="Monokai-Operator">=</span><span class="Monokai-String">"if&nbsp;args[0]=2:&nbsp;$result='Второй'&nbsp;else&nbsp;$result='Никакой'"</span><br/>
<br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-Func">$dyneval</span><span class="Monokai-Operator">(</span>$code<span class="Monokai-Operator">,</span><span class="Monokai-Numeric">2</span><span class="Monokai-Operator">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;выведет&nbsp;на&nbsp;экран&nbsp;строку&nbsp;`Второй`&nbsp;</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;выведет&nbsp;на&nbsp;экран&nbsp;число&nbsp;123</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-SysVar">$result</span>&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;выведет&nbsp;на&nbsp;экран&nbsp;строку&nbsp;`Первый`&nbsp;</span><br/>
</div>
<p>
В программировании такие переменные и массивы, как <span class="em_BLCK">args</span> и <span class="em_BLCK">result</span> называются локальными. То есть они действительны только для определённого блока кода, а после выполнения этого блока кода уничтожаются.
</p>
<p>
В нашем случае отдельным блоком кода можно считать локацию или код, который мы передаём оператору <span class="em_BLCK">dynamic</span> или функции <span class="em_BLCK">dyneval</span>. А ещё код, который выполняется при нажатии на гиперссылку.
</p>
<div class="Monokai-Code">
<span class="Monokai-SysVar">usehtml</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">1</span><br/>
<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">137</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"&lt;a&nbsp;href='exec:args[0]=37&nbsp;&amp;&nbsp;*pl&nbsp;args[0]&nbsp;&amp;&nbsp;!&nbsp;в&nbsp;гиперссылке&nbsp;собственные&nbsp;args'&gt;Нажми,&nbsp;чтобы&nbsp;вывести&nbsp;37&lt;/a&gt;"</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"&lt;a&nbsp;href='exec:*pl&nbsp;args[0]&nbsp;&amp;&nbsp;!&nbsp;в&nbsp;гиперссылке&nbsp;собственные&nbsp;args'&gt;Нажми,&nbsp;чтобы&nbsp;вывести&nbsp;0&lt;/a&gt;"</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span>&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;на&nbsp;экран&nbsp;выведется&nbsp;137</span><br/>
</div>
<p>
Отдельными блоками кода можно считать так же код действия. Однако для этих блоков кода не создаются свои собственные <span class="em_BLCK">args</span>. В них транслируются значения <span class="em_BLCK">args</span> из того уже запущенного блока кода, который их вызывает. Для примера можно посмотреть, как изменяется значение <span class="em_BLCK">args</span> на локации с помощью действий.
</p>
<div class="Monokai-Code">
<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">111</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;выставляем&nbsp;значение&nbsp;args[0]&nbsp;на&nbsp;локации</span><br/>
<span class="Monokai-Koperator">act</span>&nbsp;<span class="Monokai-String">"Действие&nbsp;1"</span><span class="Monokai-Operator">:</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"Старое&nbsp;значение&nbsp;args[0]:&nbsp;"</span><span class="Monokai-Operator">+</span><span class="Monokai-Func">$str</span><span class="Monokai-Operator">(</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">222</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;изменяем&nbsp;значение&nbsp;args[0]&nbsp;не&nbsp;только&nbsp;в&nbsp;действии,&nbsp;а&nbsp;сразу&nbsp;на&nbsp;локации</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"Новое&nbsp;значение&nbsp;args[0]:&nbsp;"</span><span class="Monokai-Operator">+</span><span class="Monokai-Func">$str</span><span class="Monokai-Operator">(</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">)</span><br/>
<span class="Monokai-Koperator">end</span><br/>
<span class="Monokai-Koperator">act</span>&nbsp;<span class="Monokai-String">"Действие&nbsp;2"</span><span class="Monokai-Operator">:</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"Старое&nbsp;значение&nbsp;args[0]:&nbsp;"</span><span class="Monokai-Operator">+</span><span class="Monokai-Func">$str</span><span class="Monokai-Operator">(</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">333</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;изменяем&nbsp;значение&nbsp;args[0]&nbsp;не&nbsp;только&nbsp;в&nbsp;действии,&nbsp;а&nbsp;сразу&nbsp;на&nbsp;локации</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"Новое&nbsp;значение&nbsp;args[0]:&nbsp;"</span><span class="Monokai-Operator">+</span><span class="Monokai-Func">$str</span><span class="Monokai-Operator">(</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">)</span><br/>
<span class="Monokai-Koperator">end</span><br/>
</div>
<p>
В дальнейшем я буду говорить только про локации и действия, но следует помнить, что всё, что справедливо для кода локаций, справедливо так же и для кода, передаваемого оператору <span class="em_BLCK">dynamic</span> или функции <span class="em_BLCK">dyneval</span>, а так же для кода в гиперссылке. И ровно так же то, что справедливо для действий, справедливо для циклов в QSP версии 5.8.0.
</p>
<p>
Поскольку на каждой локации создаётся свой собственный, локальный массив <span class="em_BLCK">args</span>, этот массив можно использовать для замены любых необходимых локальных переменных.
</p>
<p>
В качестве примера приведу код локации "#chk.obj.word#" из моей библиотечки <a href="https://github.com/AleksVersus/easy.math" style="text-decoration:none;" class="emFOLD">easy.math</a>, которая ищет в списке предметов предмет, содержащий в названии указанное слово. Функция принимает в качестве аргумента это самое слово, а затем возвращает позицию предмета в списке предметов:
</p>
<div class="Monokai-Code">
<span class="Monokai-Operator"></span><span class="Monokai-Comment">!&nbsp;#&nbsp;#chk.obj.word#</span><br/>
<span class="Monokai-SysVar">$args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">9</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">=</span><span class="Monokai-SysVar">$args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">9</span><span class="Monokai-Operator">]</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;инициализируем&nbsp;девятый&nbsp;элемент&nbsp;массива,&nbsp;чтоб&nbsp;не&nbsp;затереть&nbsp;аргументы</span><br/>
<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-String">'i'</span><span class="Monokai-Operator">]</span>&nbsp;<span class="Monokai-Operator">=</span>&nbsp;<span class="Monokai-Numeric">1</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;используем&nbsp;одну&nbsp;из&nbsp;ячеек&nbsp;массива&nbsp;args&nbsp;как&nbsp;локальную&nbsp;переменную</span><span class="Monokai-Markup"><br/>
:loop</span><br/>
<span class="Monokai-Koperator">if</span>&nbsp;<span class="Monokai-Func">no</span>&nbsp;<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-String">'i'</span><span class="Monokai-Operator">]</span>&nbsp;<span class="Monokai-Operator">&gt;</span>&nbsp;<span class="Monokai-Func">countobj</span><span class="Monokai-Operator">:</span><span class="Monokai-Operator"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="Monokai-Comment">!@&nbsp;цикл&nbsp;выполняется&nbsp;пока&nbsp;счётчик&nbsp;не&nbsp;превысит&nbsp;число&nbsp;предметов</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Koperator">if</span>&nbsp;<span class="Monokai-Func">instr</span><span class="Monokai-Operator">(</span><span class="Monokai-Func">$getobj</span><span class="Monokai-Operator">(</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-String">'i'</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">)</span><span class="Monokai-Operator">,</span><span class="Monokai-SysVar">$args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">)</span><span class="Monokai-Operator">&lt;</span><span class="Monokai-Operator">&gt;</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">:</span><span class="Monokai-Operator"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="Monokai-Comment">!@&nbsp;как&nbsp;только&nbsp;в&nbsp;названии&nbsp;очередного&nbsp;предмета</span><span class="Monokai-Operator"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="Monokai-Comment">!@&nbsp;встречается&nbsp;рассматриваемое&nbsp;слово</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-SysVar">result</span>&nbsp;<span class="Monokai-Operator">=</span>&nbsp;<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-String">'i'</span><span class="Monokai-Operator">]</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!@&nbsp;возвращаем&nbsp;позицию</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">exit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!@&nbsp;закрываем&nbsp;функцию</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Koperator">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-String">'i'</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">+=</span><span class="Monokai-Numeric">1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">jump</span>&nbsp;<span class="Monokai-String">'loop'</span><br/>
<span class="Monokai-Koperator">end</span><br/>
</div>
<p>
Вот пример работы данной функции:
</p>
<div class="Monokai-Code">
<span class="Monokai-Operator">addobj</span>&nbsp;<span class="Monokai-String">"Красный&nbsp;помидор"</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;первый&nbsp;предмет</span><br/>
<span class="Monokai-Operator">addobj</span>&nbsp;<span class="Monokai-String">"Рыжий&nbsp;апельсин"</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;второй&nbsp;предмет</span><br/>
<span class="Monokai-Operator">addobj</span>&nbsp;<span class="Monokai-String">"Зелёное&nbsp;яблоко"</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;третий&nbsp;предмет</span><br/>
<span class="Monokai-Operator">addobj</span>&nbsp;<span class="Monokai-String">"Синий&nbsp;крокодил"</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;четвёртый&nbsp;предмет</span><span class="Monokai-Operator"><br/>
</span><span class="Monokai-Comment">!&nbsp;ищем&nbsp;предмет,&nbsp;название&nbsp;которого&nbsp;содержит&nbsp;слово&nbsp;`Зелён`</span><br/>
pos<span class="Monokai-Operator">=</span><span class="Monokai-Func">func</span><span class="Monokai-Operator">(</span><span class="Monokai-String">'#chk.obj.word#'</span><span class="Monokai-Operator">,</span><span class="Monokai-String">'Зелён'</span><span class="Monokai-Operator">)</span><span class="Monokai-Operator"><br/>
</span><span class="Monokai-Comment">!&nbsp;можно&nbsp;вывести&nbsp;и&nbsp;позицию&nbsp;и&nbsp;название</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"Мы&nbsp;нашли&nbsp;предмет&nbsp;под&nbsp;номером&nbsp;&lt;&lt;pos&gt;&gt;.&nbsp;Это&nbsp;"</span><span class="Monokai-Operator">+</span><span class="Monokai-Func">$getobj</span><span class="Monokai-Operator">(</span>pos<span class="Monokai-Operator">)</span><span class="Monokai-Operator">+</span><span class="Monokai-String">"."</span><br/>
</div>
<p>
Используя массив <span class="em_BLCK">args</span> не только для получения переданных на локацию аргументов, но и в качестве локальных переменных, вы избавляетесь от необходимости следить, не забыли ли вы удалить какие-то промежуточные данные, которые вам требовались для вычислений исключительно на одной локации, исключительно в отдельном блоке кода. Плеер сам уничтожит массив <span class="em_BLCK">args</span>, когда код будет выполнен.
</p>
<p>
Если вы до сих пор пишете игру для плеера версии 5.7.0, вы просто вынуждены использовать массив <span class="em_BLCK">args</span> вместо локальных переменных, либо вы вынуждены уничтожать переменные и массивы, используемые для временного хранения данных, вручную с помощью <span class="em_BLCK">killvar</span>. Всё изменилось с появлением плееров версии 5.8.0!
</p>
<h6 id="bezdna-smotrit-v-tebia-lokal_nye-peremennye-i-neiavnyj-vyzov-pol_zovatel_skih-funktsij">Бездна смотрит в тебя. Локальные переменные и неявный вызов пользовательских функций</h6><h6 id="lokal_nye-peremennye">Локальные переменные</h6><p>
В плеерах версии 5.8.0 и выше появилась возможность объявить любую переменную локальной, т.е. значения данной переменной будут действительны только для отдельного блока кода, а после выполнения этого блока кода все переменные, объявленные для него локальными, будут уничтожены. Для примера возьмём две локации: локацию "start" и локацию "foo":
</p>
<div class="Monokai-Code">
<span class="Monokai-Operator"></span><span class="Monokai-Comment">!&nbsp;этот&nbsp;код&nbsp;последовательно&nbsp;выведет&nbsp;на&nbsp;экран&nbsp;числа&nbsp;12,&nbsp;549&nbsp;и&nbsp;99,&nbsp;549</span><span class="Monokai-StartLoc"><br/>
#&nbsp;start</span><br/>
x<span class="Monokai-Operator">=</span><span class="Monokai-Numeric">99</span><br/>
z<span class="Monokai-Operator">=</span><span class="Monokai-Numeric">4608</span><br/>
<span class="Monokai-Operator">gosub</span>&nbsp;<span class="Monokai-String">'foo'</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;x&nbsp;<span class="Monokai-Operator">&amp;</span>&nbsp;<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;z&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;на&nbsp;экран&nbsp;выведутся&nbsp;числа&nbsp;99&nbsp;и&nbsp;549</span><span class="Monokai-EndLoc"><br/>
---&nbsp;start&nbsp;---</span><span class="Monokai-StartLoc"><br/>
<br/>
#&nbsp;foo</span><br/>
<span class="Monokai-Operator">local</span>&nbsp;x&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;объявляем&nbsp;переменную&nbsp;x&nbsp;локальной&nbsp;для&nbsp;данной&nbsp;локации</span><br/>
x<span class="Monokai-Operator">=</span><span class="Monokai-Numeric">12</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;изменяем&nbsp;значение&nbsp;переменной&nbsp;x</span><br/>
z<span class="Monokai-Operator">=</span><span class="Monokai-Numeric">549</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;x&nbsp;<span class="Monokai-Operator">&amp;</span>&nbsp;<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;z&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;на&nbsp;экран&nbsp;выведутся&nbsp;числа&nbsp;12&nbsp;и&nbsp;549</span><span class="Monokai-EndLoc"><br/>
---&nbsp;foo&nbsp;---</span><br/>
</div>
<p>
Если запустите этот код, то увидите, что значение, присвоенное переменной <span class="em_BLCK">x</span>, на локации "start" до вызова локации "foo", сохраняется и после вызова локации "foo", так как на локации "foo" мы объявили собственную уникальную переменную <span class="em_BLCK">x</span>. А вот переменную <span class="em_BLCK">z</span> мы не объявляли локальной на локации "foo", а значит, если мы меняем её значение на локации "foo", то оно меняется для всех локаций. Что мы и видим.
</p>
<p>
По своему поведению локальные переменные несколько отличаются от <span class="em_BLCK">args</span> и <span class="em_BLCK">result</span>. Дело в том, что <span class="em_BLCK">args</span> и <span class="em_BLCK">result</span> объявляются на каждой локации автоматически, и мы можем быть уверены, что всегда будем работать на каждой отдельной локации с уникальными (локальными) <span class="em_BLCK">args</span> и <span class="em_BLCK">result</span>. Но что будет если на локации 'foo' мы объявим локальную переменную, а затем вызовем из локации 'foo' локацию 'proc', на которой не будем эту переменную объявлять локальной? Какие значения примет переменная на каждой из этих локаций?
</p>
<div class="Monokai-Code">
<span class="Monokai-StartLoc">#&nbsp;start</span><br/>
x<span class="Monokai-Operator">=</span><span class="Monokai-Numeric">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;объявляем&nbsp;переменную</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"start.&nbsp;x&nbsp;до&nbsp;вызова&nbsp;foo:&nbsp;&lt;&lt;x&gt;&gt;"</span><br/>
<span class="Monokai-Operator">gosub</span>&nbsp;<span class="Monokai-String">'foo'</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"start.&nbsp;x&nbsp;после&nbsp;вызова&nbsp;foo:&nbsp;&lt;&lt;x&gt;&gt;"</span><span class="Monokai-EndLoc"><br/>
---&nbsp;start&nbsp;---</span><span class="Monokai-StartLoc"><br/>
<br/>
#&nbsp;foo</span><br/>
<span class="Monokai-Operator">local</span>&nbsp;x<span class="Monokai-Operator">=</span><span class="Monokai-Numeric">333</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"foo.&nbsp;x&nbsp;до&nbsp;вызова&nbsp;proc:&nbsp;&lt;&lt;x&gt;&gt;"</span><br/>
<span class="Monokai-Operator">gosub</span>&nbsp;<span class="Monokai-String">'proc'</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"foo.&nbsp;x&nbsp;после&nbsp;вызова&nbsp;proc:&nbsp;&lt;&lt;x&gt;&gt;"</span><span class="Monokai-EndLoc"><br/>
---&nbsp;foo&nbsp;---</span><span class="Monokai-StartLoc"><br/>
<br/>
#&nbsp;proc</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"proc.&nbsp;x&nbsp;до&nbsp;изменения:&nbsp;&lt;&lt;x&gt;&gt;"</span><br/>
x<span class="Monokai-Operator">=</span><span class="Monokai-Numeric">9091</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"proc.&nbsp;x&nbsp;после&nbsp;изменения:&nbsp;&lt;&lt;x&gt;&gt;"</span><span class="Monokai-EndLoc"><br/>
---&nbsp;proc&nbsp;---</span><br/>
</div>
<p>
Что мы увидим при выполнении этого кода? Давайте посмотрим.
</p>
<ol>
<li>На локации "start" мы объявили переменную <span class="em_BLCK">x</span> со значением <span class="em_BLCK">100</span> и вывели это значение в строке. То есть на экране мы увидим строку с числом <span class="em_BLCK">100</span>.</li>
<li>Затем мы вызвали локацию "foo", на которой объявили локальную переменную <span class="em_BLCK">x</span> со значением <span class="em_BLCK">333</span> и вывели это значение в строке. То есть на экране мы увидели строку с числом <span class="em_BLCK">333</span>.</li>
<li>Затем мы вызвали локацию "proc", и здесь не объявляли переменную <span class="em_BLCK">x</span> локальной, но вывели её значение в строке. И вот тут мы обнаруживаем отличие в поведении локальных переменных от <span class="em_BLCK">args</span> и <span class="em_BLCK">proc</span>. Значение, которое мы увидим в строке будет равно тоже <span class="em_BLCK">333</span>. То есть в переменную <span class="em_BLCK">x</span> на локации "proc" транслируется значение этой переменной из локации "foo", а вернее транслируется сама переменная. Таким образом и локация "proc" и локация "foo" работают по сути с одной и той же переменной. Именно поэтому...</li>
<li>... когда мы изменяем значение <span class="em_BLCK">x</span> на локации "proc" и ожидаемо видим в выводимой строке число <span class="em_BLCK">9091</span>, мы изменяем значение <span class="em_BLCK">x</span> и для локации "foo" в том числе. И поэтому...</li>
<li>... когда плеер возвращается к выполнению кода на локации "foo", переменная <span class="em_BLCK">x</span> уже изменена, и мы видим в выводимой строке всё то же число <span class="em_BLCK">9091</span>.</li>
<li>Когда плеер заканчивает выполнение кода локации "foo" и возвращается к выполнению кода на локации "start", локальная переменная <span class="em_BLCK">x</span>, созданная на локации "foo", автоматически уничтожается, и плеер в дальнейшем продолжает работать с переменной <span class="em_BLCK">x</span>, созданной на локации "start". А значит на экране в выводимой строке мы увидим число <span class="em_BLCK">100</span>.</li>
</ol>
<div class="Monokai-Code">
start.&nbsp;x&nbsp;до&nbsp;вызова&nbsp;foo:&nbsp;100
<br/>foo.&nbsp;x&nbsp;до&nbsp;вызова&nbsp;proc:&nbsp;333
<br/>proc.&nbsp;x&nbsp;до&nbsp;изменения:&nbsp;333
<br/>proc.&nbsp;x&nbsp;после&nbsp;изменения:&nbsp;9091
<br/>foo.&nbsp;x&nbsp;после&nbsp;вызова&nbsp;proc:&nbsp;9091
<br/>start.&nbsp;x&nbsp;после&nbsp;вызова&nbsp;foo:&nbsp;100
</div>
<p>
Не трудно заметить, что локальные переменные ведут себя на локациях, как <span class="em_BLCK">args</span> в действиях. Всё потому что <span class="em_BLCK">args</span> автоматически объявляется на локациях, но не в действиях, а локальные переменные необходимо объявлять вручную везде, если вам нужно, чтобы они работали как локальные.
</p>
<p>
Мы можем вручную объявить <span class="em_BLCK">args</span> локальным в действии, и тогда действие уже не будет работать со значениями <span class="em_BLCK">args</span> действующими на текущей локации:
</p>
<div class="Monokai-Code">
<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">111</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;выставляем&nbsp;значение&nbsp;args[0]&nbsp;на&nbsp;локации</span><br/>
<span class="Monokai-Koperator">act</span>&nbsp;<span class="Monokai-String">"Действие&nbsp;1"</span><span class="Monokai-Operator">:</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"Старое&nbsp;значение&nbsp;args[0]:&nbsp;"</span><span class="Monokai-Operator">+</span><span class="Monokai-Func">$str</span><span class="Monokai-Operator">(</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">222</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;изменяем&nbsp;значение&nbsp;args[0]&nbsp;не&nbsp;только&nbsp;в&nbsp;действии,&nbsp;а&nbsp;сразу&nbsp;на&nbsp;локации</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"Новое&nbsp;значение&nbsp;args[0]:&nbsp;"</span><span class="Monokai-Operator">+</span><span class="Monokai-Func">$str</span><span class="Monokai-Operator">(</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">)</span><br/>
<span class="Monokai-Koperator">end</span><br/>
<span class="Monokai-Koperator">act</span>&nbsp;<span class="Monokai-String">"Действие&nbsp;2"</span><span class="Monokai-Operator">:</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"Старое&nbsp;значение&nbsp;args[0]:&nbsp;"</span><span class="Monokai-Operator">+</span><span class="Monokai-Func">$str</span><span class="Monokai-Operator">(</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">333</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;изменяем&nbsp;значение&nbsp;args[0]&nbsp;не&nbsp;только&nbsp;в&nbsp;действии,&nbsp;а&nbsp;сразу&nbsp;на&nbsp;локации</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"Новое&nbsp;значение&nbsp;args[0]:&nbsp;"</span><span class="Monokai-Operator">+</span><span class="Monokai-Func">$str</span><span class="Monokai-Operator">(</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">)</span><br/>
<span class="Monokai-Koperator">end</span><br/>
<span class="Monokai-Koperator">act</span>&nbsp;<span class="Monokai-String">"Действие&nbsp;3"</span><span class="Monokai-Operator">:</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">local</span>&nbsp;<span class="Monokai-SysVar">args</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;объявляем&nbsp;args&nbsp;локальным</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"Старое&nbsp;значение&nbsp;args[0]:&nbsp;"</span><span class="Monokai-Operator">+</span><span class="Monokai-Func">$str</span><span class="Monokai-Operator">(</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">999</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;изменяем&nbsp;значение&nbsp;args[0]&nbsp;только&nbsp;в&nbsp;действии,но&nbsp;не&nbsp;на&nbsp;локации</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"Новое&nbsp;значение&nbsp;args[0]:&nbsp;"</span><span class="Monokai-Operator">+</span><span class="Monokai-Func">$str</span><span class="Monokai-Operator">(</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">)</span><br/>
<span class="Monokai-Koperator">end</span><br/>
</div>
<p>
И точно так же, если мы вручную не объявим на локации локальную переменную, мы будем работать с той переменной, которая была объявлена последней до вызова этой локации. Если мы вообще не объявляли локальную переменную, значит будем работать с переменной общей для всей игры — с глобальной переменной.
</p>
<p>
Имея в наличии такой удобный инструмент, как локальные переменные, мы оказываемся избавлены от необходимости использовать <span class="em_BLCK">args</span> для замены этих самых локальных переменных, и можем использовать его только по прямому назначению, то есть получать из этого массива переданные на локацию аргументы. Посмотрите, насколько чище и понятнее при этом выглядит код:
</p>
<div class="Monokai-Code">
<span class="Monokai-Operator"></span><span class="Monokai-Comment">!&nbsp;#&nbsp;#chk.obj.word#</span><br/>
<span class="Monokai-Operator">local</span>&nbsp;$word<span class="Monokai-Operator">=</span><span class="Monokai-SysVar">$args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span>&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;в&nbsp;локальную&nbsp;переменную&nbsp;$word&nbsp;записываем&nbsp;слово,&nbsp;по&nbsp;которому&nbsp;производим&nbsp;поиск</span><br/>
<span class="Monokai-Operator">local</span>&nbsp;i&nbsp;<span class="Monokai-Operator">=</span>&nbsp;<span class="Monokai-Numeric">1</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;используем&nbsp;локальную&nbsp;переменную&nbsp;i&nbsp;в&nbsp;качестве&nbsp;счётчика&nbsp;цикла</span><br/>
<span class="Monokai-Koperator">loop</span>&nbsp;<span class="Monokai-Koperator">while</span>&nbsp;<span class="Monokai-Func">no</span>&nbsp;i&nbsp;<span class="Monokai-Operator">&gt;</span>&nbsp;<span class="Monokai-Func">countobj</span>&nbsp;<span class="Monokai-Koperator">step</span>&nbsp;i<span class="Monokai-Operator">+=</span><span class="Monokai-Numeric">1</span><span class="Monokai-Operator">:</span><span class="Monokai-Operator"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="Monokai-Comment">!@&nbsp;цикл&nbsp;выполняется&nbsp;пока&nbsp;счётчик&nbsp;не&nbsp;превысит&nbsp;число&nbsp;предметов</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Koperator">if</span>&nbsp;<span class="Monokai-Func">instr</span><span class="Monokai-Operator">(</span><span class="Monokai-Func">$getobj</span><span class="Monokai-Operator">(</span>i<span class="Monokai-Operator">)</span><span class="Monokai-Operator">,</span>$word<span class="Monokai-Operator">)</span><span class="Monokai-Operator">&lt;</span><span class="Monokai-Operator">&gt;</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">:</span><span class="Monokai-Operator"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="Monokai-Comment">!@&nbsp;как&nbsp;только&nbsp;в&nbsp;названии&nbsp;очередного&nbsp;предмета</span><span class="Monokai-Operator"><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="Monokai-Comment">!@&nbsp;встречается&nbsp;рассматриваемое&nbsp;слово</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-SysVar">result</span>&nbsp;<span class="Monokai-Operator">=</span>&nbsp;i&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!@&nbsp;возвращаем&nbsp;позицию</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">exit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!@&nbsp;закрываем&nbsp;функцию</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Koperator">end</span><br/>
<span class="Monokai-Koperator">end</span><br/>
</div>
<h6 id="neiavnyj-vyzov-funktsij">Неявный вызов функций</h6><p>
Как мы уже говорили ранее, сами по себе локации в действительности не являются функциями или процедурами. Мы используем оператор <span class="em_BLCK">gosub</span> или специальную функцию <span class="em_BLCK">func</span>, чтобы выполнить код той или иной локации. Функциями мы называли эти локации для удобства. И точно так же для удобства в QSP версии 5.8.0 была введена особая синтаксическая конструкция, которая позволяет не писать оператор <span class="em_BLCK">gosub</span> и функцию <span class="em_BLCK">func</span>.
</p>
<p>
Фактически мы теперь всегда вызываем все локации с помощью функции <span class="em_BLCK">func</span>, но имеем возможность не указывать само ключевое слово <span class="em_BLCK">func</span>. И такая запись данной функции называется <span class="em_BLCK">неявным вызовом</span>.
</p>
<p>
Неявный вызов делается так: мы пишем символ <span class="em_BLCK">@</span> и сразу после него без пробелов указываем название локации, которую хотим использовать как функцию. Если нам нужно передать на локацию аргументы, мы перечисляем эти аргументы внутри круглых скобок сразу после названия локации:
</p>
<div class="Monokai-Code">
<span class="Monokai-StartLoc">#&nbsp;start</span><span class="Monokai-Operator"><br/>
</span><span class="Monokai-Comment">!&nbsp;возводим&nbsp;числа&nbsp;в&nbsp;степень</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-UnFunc">@pow</span><span class="Monokai-Operator">(</span><span class="Monokai-Numeric">3</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">4</span><span class="Monokai-Operator">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;выведет&nbsp;число&nbsp;81</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-UnFunc">@pow</span><span class="Monokai-Operator">(</span><span class="Monokai-Numeric">4</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">3</span><span class="Monokai-Operator">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;выведет&nbsp;число&nbsp;64</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-UnFunc">@pow</span><span class="Monokai-Operator">(</span><span class="Monokai-Numeric">9</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">9</span><span class="Monokai-Operator">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-Operator">&amp;&nbsp;</span><span class="Monokai-Comment">!&nbsp;выведет&nbsp;число&nbsp;387420489</span><span class="Monokai-EndLoc"><br/>
---&nbsp;start&nbsp;---</span><span class="Monokai-StartLoc"><br/>
<br/>
#&nbsp;pow</span><span class="Monokai-Operator"><br/>
</span><span class="Monokai-Comment">!&nbsp;функция&nbsp;возведения&nbsp;числа&nbsp;в&nbsp;степень.</span><span class="Monokai-Operator"><br/>
</span><span class="Monokai-Comment">!&nbsp;Мы&nbsp;писали&nbsp;её&nbsp;для&nbsp;dyneval,&nbsp;а&nbsp;теперь&nbsp;оформляем&nbsp;в&nbsp;отдельной&nbsp;локации</span><br/>
<span class="Monokai-SysVar">result</span><span class="Monokai-Operator">=</span><span class="Monokai-Numeric">1</span><br/>
<span class="Monokai-Koperator">loop</span>&nbsp;<span class="Monokai-Koperator">while</span>&nbsp;<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">1</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">&gt;</span><span class="Monokai-Numeric">0</span>&nbsp;<span class="Monokai-Koperator">step</span>&nbsp;<span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">1</span><span class="Monokai-Operator">]</span><span class="Monokai-Operator">-=</span><span class="Monokai-Numeric">1</span><span class="Monokai-Operator">:</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Monokai-SysVar">result</span><span class="Monokai-Operator">=</span><span class="Monokai-SysVar">result</span><span class="Monokai-Operator">*</span><span class="Monokai-SysVar">args</span><span class="Monokai-Operator">[</span><span class="Monokai-Numeric">0</span><span class="Monokai-Operator">]</span><br/>
<span class="Monokai-Koperator">end</span><span class="Monokai-EndLoc"><br/>
---&nbsp;pow&nbsp;---</span><br/>
</div>
<p>
Таким образом наш код становится ещё более наглядным и читаемым, и мы легко отделяем визуально передаваемые на локацию аргументы от названия самой локации.
</p>
<p>
В остальном всё работет, как прежде.
</p>
<p>
Если на локации мы присваиваем значение переменной <span class="em_BLCK">result</span>, значит функция вернёт нам это значение.
</p>
<p>
Если на локации переменной <span class="em_BLCK">result</span> не присваивается никакое значение, функция ничего не возвращает, и тогда её поведение ничем не отличается от поведения <span class="em_BLCK">gosub</span>.
</p>
<div class="Monokai-Code">
<span class="Monokai-StartLoc">#&nbsp;start</span><br/>
<span class="Monokai-UnFunc">@pl_stat</span><span class="Monokai-Operator">(</span><span class="Monokai-String">'Леголас'</span><span class="Monokai-Operator">,</span><span class="Monokai-Numeric">137</span><span class="Monokai-Operator">,</span><span class="Monokai-String">'Лук&nbsp;и&nbsp;стрелы'</span><span class="Monokai-Operator">)</span><span class="Monokai-EndLoc"><br/>
---&nbsp;start&nbsp;---</span><span class="Monokai-StartLoc"><br/>
<br/>
#&nbsp;pl_stat</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"Вас&nbsp;зовут&nbsp;&lt;&lt;$args[0]&gt;&gt;."</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"Вам&nbsp;&lt;&lt;args[1]&gt;&gt;&nbsp;лет."</span><br/>
<span class="Monokai-Operator">*</span><span class="Monokai-Operator">pl</span>&nbsp;<span class="Monokai-String">"Вы&nbsp;используете&nbsp;&lt;&lt;$args[2]&gt;&gt;."</span><span class="Monokai-EndLoc"><br/>
---&nbsp;pl_stat&nbsp;---</span><br/>
</div>
<h6 id="zakliuchenie">Заключение</h6><p>
В данной статье мы попытались максимально подробно объяснить, что такое операторы, функции, как мы можем писать собственные функции и процедуры в QSP, что такое аргументы и зачем нужен массив <span class="em_BLCK">args</span>. Вы узнали, что такое локальные переменные, и как массив <span class="em_BLCK">args</span> заменяет локальные переменные в плеерах версии 5.7.0, и почему это больше не требуется в плеерах версии 5.8.0 и выше.
</p>
<p>
Многие моменты остались за рамками данной статьи. Например, что за значения появляются в массиве <span class="em_BLCK">args</span> на локациях-обработчиках пунктов пользовательского меню, или какие значения можно найти в массиве <span class="em_BLCK">args</span> на локации <span class="em_BLCK">onNewLoc</span>, но на все эти вопросы, мы надеемся, вы найдёте ответы в большом <a href="https://aleksversus.github.io/howdo_faq" style="text-decoration:none;" class="emFOLD">справочнике по самым часто задаваемым вопросам из темы "Как сделать?" на форуме qsp.org</a>.
</p>
<p>
Онлайн-версию справочника, а так же полный текст данной статьи вы можете найти <a href="https://aleksversus.github.io/howdo_faq/" style="text-decoration:none;" class="emFOLD">вот по этой ссылке</a>.
</p>
<p>
Если прочтение статьи не прибавило ясности, попробуйте ознакомиться с материалом следующих видеороликов:
</p>
<p>
<a href="https://youtu.be/701GnjpRGU0" style="text-decoration:none;" class="emFOLD">Уроки по QSP. Номер 11. Операторы, функции и аргументы</a>
</p>
<p>
<a href="https://youtu.be/TGUhW-2l1gM" style="text-decoration:none;" class="emFOLD">Уроки по QSP. Номер 21. Пользовательские служебные локации. Часть 1</a>
</p>
<p>
<a href="https://youtu.be/701GnjpRGU0" style="text-decoration:none;" class="emFOLD">Уроки по QSP. Номер 21. Пользовательские служебные локации. Часть 2</a>
</p>
<p>
<a href="https://www.youtube.com/watch?v=aEdgMuqTlH8&list=PLcAHO4WsUl2RLdiV5Lfi4d_yyHpl7zTJA&index=31&t=4517s" style="text-decoration:none;" class="emFOLD">Что нового в QSP 5.8.0. Объявление локальных переменных</a>
</p>
<p>
<a href="https://www.youtube.com/watch?v=aEdgMuqTlH8&t=3080s" style="text-decoration:none;" class="emFOLD">Что нового в QSP 5.8.0. Неявный вызов функций</a>
</p>
<div style="display:flex;justify-content:space-between;"><div><a href="https://aleksversus.github.io/howdo_faq/articles/classic.config_0005.html" class="emHREFTT">&lt; Назад, к странице 6</a></div><div><a href="https://aleksversus.github.io/howdo_faq/articles/stylization_manifest_0007.html" class="emHREFTT">Вперёд, к странице 8 &gt;</a></div></div>
<!-- body end -->
            <div class="em_Epigraph">
                <div class="em_subText">
                    <p>Aleks Versus'HowDo-F.A.Q.'2021-<span id="date_stamp_faq">2022</span></p>
                    <p>Aleks Versus'Game Adventure Making'Really Unimaginable Stories'2013-<span id="date_stamp_gamrus">2022</span></p>
                </div>
            </div>
            <div class="em_btn">
                <div>
                    <a href="https://aleksversus.github.io/howdo_faq/" class="emHREFTT">Главная</a>
                </div>
                <div>
                    <a href="#" class="emHREFTT" id="section_content_open">Содержание</a>
                </div>
            </div>
        </div>
        <div class="stub">
            &nbsp;
        </div>
    </div>
    <div id="soderzhanije_outer">
        <div class="soderzhanije">
<header-header></header-header>
        </div>
    </div>
    <script type="text/javascript" src="../res/js/text_replace.js"></script>
    <script type="text/javascript" src="../res/js/soderzhanie.js" ></script>
</body>
</html>
