<!doctype html>
<html lang="ru" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-articles/transition_570_at_59x/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Переход с QSP 5.7.0 на 5.9.x | Справочник | F.A.Q.</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://aleksversus.github.io/howdo_faq/fav/green.ico"><meta data-rh="true" name="twitter:image" content="https://aleksversus.github.io/howdo_faq/fav/green.ico"><meta data-rh="true" property="og:url" content="https://aleksversus.github.io/howdo_faq/docs/articles/transition_570_at_59x/"><meta data-rh="true" property="og:locale" content="ru"><meta data-rh="true" name="docusaurus_locale" content="ru"><meta data-rh="true" name="docsearch:language" content="ru"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Переход с QSP 5.7.0 на 5.9.x | Справочник | F.A.Q."><meta data-rh="true" name="description" content="Многие авторы, начинавшие разработку игр для плееров версии 5.7.0, боятся переводить проекты на более свежие версии из-за обилия изменений. Байт активно обновляет основную библиотеку QSP уже пять лет, и количество введённых изменений действительно может пугать. Однако на самом деле всё не так страшно."><meta data-rh="true" property="og:description" content="Многие авторы, начинавшие разработку игр для плееров версии 5.7.0, боятся переводить проекты на более свежие версии из-за обилия изменений. Байт активно обновляет основную библиотеку QSP уже пять лет, и количество введённых изменений действительно может пугать. Однако на самом деле всё не так страшно."><link data-rh="true" rel="icon" href="/howdo_faq/fav/green.ico"><link data-rh="true" rel="canonical" href="https://aleksversus.github.io/howdo_faq/docs/articles/transition_570_at_59x/"><link data-rh="true" rel="alternate" href="https://aleksversus.github.io/howdo_faq/docs/articles/transition_570_at_59x/" hreflang="ru"><link data-rh="true" rel="alternate" href="https://aleksversus.github.io/howdo_faq/docs/articles/transition_570_at_59x/" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Переход с QSP 5.7.0 на 5.9.x","item":"https://aleksversus.github.io/howdo_faq/docs/articles/transition_570_at_59x/"}]}</script><link rel="stylesheet" href="/howdo_faq/assets/css/styles.5d9e0eab.css">
<script src="/howdo_faq/assets/js/runtime~main.fd048b9d.js" defer="defer"></script>
<script src="/howdo_faq/assets/js/main.8e764c67.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Перейти к основному содержимому"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Перейти к основному содержимому</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Переключить навигационную панель" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/howdo_faq/"><b class="navbar__title text--truncate">Главная</b></a><a class="navbar__item navbar__link" href="/howdo_faq/docs/howdo/intro">Как сделать? F.A.Q.</a><a class="navbar__item navbar__link" href="/howdo_faq/docs/news/news_content">Новости QSP</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/howdo_faq/docs/articles/type_casting">Статьи</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/howdo_faq/docs/informarch/intro">Информ-Архив</a><a href="https://wiki.qsp.org" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">QSP-wiki<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://github.com/AleksVersus/howdo_faq" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub/HowDo_F.A.Q<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Переключение между темным и светлым режимом (сейчас используется system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Прокрутка к началу" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/howdo_faq/docs/articles/type_casting"><span title="Преобразование типов в QSP" class="linkLabel_WmDU">Преобразование типов в QSP</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/howdo_faq/docs/articles/arrays_580/"><span title="Массивы уже не те" class="linkLabel_WmDU">Массивы уже не те</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/howdo_faq/docs/articles/qspider_0120/"><span title="qSpider версии 0.12.0" class="linkLabel_WmDU">qSpider версии 0.12.0</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/howdo_faq/docs/articles/config_classic_570"><span title="Структура конфигурационного файла классического плеера версии 5.7.0" class="linkLabel_WmDU">Структура конфигурационного файла классического плеера версии 5.7.0</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/howdo_faq/docs/articles/operators_funcs_args/"><span title="Операторы, функции, аргументы. GOSUB, FUNC, ARGS" class="linkLabel_WmDU">Операторы, функции, аргументы. GOSUB, FUNC, ARGS</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/howdo_faq/docs/articles/transition_570_at_59x/"><span title="Переход с QSP 5.7.0 на 5.9.x" class="linkLabel_WmDU">Переход с QSP 5.7.0 на 5.9.x</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/howdo_faq/docs/articles/transition_570_590"><span title="Переход с 5.7.0 на 5.9.x" class="linkLabel_WmDU">Переход с 5.7.0 на 5.9.x</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/howdo_faq/docs/articles/stylization_manifest"><span title="Манифест об организации кода в QSP" class="linkLabel_WmDU">Манифест об организации кода в QSP</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Навигационная цепочка текущей страницы"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Главная страница" class="breadcrumbs__link" href="/howdo_faq/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Переход с QSP 5.7.0 на 5.9.x</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Содержание этой страницы</button></div><div class="theme-doc-markdown markdown"><header><h1>Переход с QSP 5.7.0 на 5.9.x</h1></header>
<p>Многие авторы, начинавшие разработку игр для плееров версии 5.7.0, боятся переводить проекты на более свежие версии из-за обилия изменений. Байт активно обновляет основную библиотеку QSP уже пять лет, и количество введённых изменений действительно может пугать. Однако на самом деле всё не так страшно.</p>
<p>На самом деле список по-настоящему критических изменений весьма скр омен, и эта статья поможет вам как можно безболезненнее перевести проект на более новый и быстрый плеер.</p>
<p>Мы не будем приводить подробное описание всех нововведений, поскольку уже описывали их в нескольких статьях, а сосредоточимся на практических шагах, попутно раскрывая наиболее значимые изменения в работе плеера по сравнению с версией 5.7.0.</p>
<p>Все нововведения уже отражены в онлайн-справке: <a href="https://wiki.qsps.org" target="_blank" rel="noopener noreferrer" class="">wiki.qsp.org</a></p>
<p>Вот список статей, которые помогут более детально познакомиться со всеми изменениями: </p>
<ul>
<li class=""><a href="https://vk.com/@qsplayer-novovvedeniya-v-qsp-580" target="_blank" rel="noopener noreferrer" class="">https://vk.com/@qsplayer-novovvedeniya-v-qsp-580</a>,</li>
<li class=""><a href="https://vk.com/@qsplayer-novovvedeniya-v-qsp-590" target="_blank" rel="noopener noreferrer" class="">https://vk.com/@qsplayer-novovvedeniya-v-qsp-590</a>,</li>
<li class=""><a href="https://vk.com/@qsplayer-chto-novogo-v-qsp-591" target="_blank" rel="noopener noreferrer" class="">https://vk.com/@qsplayer-chto-novogo-v-qsp-591</a>,</li>
<li class=""><a href="https://vk.com/@qsplayer-novovvedeniya-v-qsp-592-594" target="_blank" rel="noopener noreferrer" class="">https://vk.com/@qsplayer-novovvedeniya-v-qsp-592-594</a>.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="инструменты">Инструменты<a href="#инструменты" class="hash-link" aria-label="Прямая ссылка на Инструменты" title="Прямая ссылка на Инструменты" translate="no">​</a></h2>
<p>Прежде всего для правки игры вам потребуются подходящие инструменты:</p>
<ol>
<li class=""><strong>Утилита TXT2GAM</strong>. Это утилита, которая позволяет конвертировать игру в формат текстового файла и обратно.<!-- -->
<ul>
<li class="">Скачать её вы можете как с <a href="https://qsp.org/index.php?option=com_content&amp;task=view&amp;id=52&amp;Itemid=56" target="_blank" rel="noopener noreferrer" class="">официального сайта</a>, так и напрямую <a href="https://github.com/QSPFoundation/txt2gam/releases" target="_blank" rel="noopener noreferrer" class="">со страницы релизов</a> на гитхабе.</li>
<li class="">Если не знаете, как пользоваться утилитой, рекомендуем прочесть <a href="https://wiki.qsp.org/help:txt2gam" target="_blank" rel="noopener noreferrer" class="">краткое руководство</a>.</li>
</ul>
</li>
<li class=""><strong>Анализатор QSP-кода</strong>. Это утилита, которая быстро сканирует вашу игру в формате текстового файла и предоставляет список возможных ошибок, списки всех имён переменных, локаций, действий, предметов, и прочее.<!-- -->
<ul>
<li class="">Можно скачать по ссылке из <a href="https://qsp.org/index.php?option=com_agora&amp;task=topic&amp;id=365&amp;Itemid=57" target="_blank" rel="noopener noreferrer" class="">темы на форуме</a>, посвящённой Анализатору.</li>
<li class="">Можно скачать из архива на меге <a href="https://mega.nz/folder/jXwXlSRJ#TF7P-soOJOWIC8MrBA-L1A" target="_blank" rel="noopener noreferrer" class="">&quot;QSP/Программы&quot;</a>.   ← Здесь смотрите папку &quot;QSP-Analyser&quot;. Для первого раза лучше всего выбрать последнюю версию без модификаций.</li>
<li class="">Краткая информация по утилите доступна и <a href="https://qsp.org/index.php?option=com_agora&amp;task=topic&amp;id=365&amp;Itemid=57" target="_blank" rel="noopener noreferrer" class="">на форуме</a>, и в <a href="https://aleksversus.github.io/howdo_faq/docs/informarch/general/code_analyser" target="_blank" rel="noopener noreferrer" class="">архиве статей</a>.</li>
</ul>
</li>
<li class="">Чтобы просматривать игру в формате текстовых файлов подойдёт любой текстовый редактор, однако мы рекомендуем использовать Sublime Text или VS Code, так как эти редакторы поддерживают полноценную подсветку синтаксиса QSP.<!-- -->
<ul>
<li class="">Для Sublime Text разработан <a href="https://github.com/QSPFoundation/sublime_text_qsp_package" target="_blank" rel="noopener noreferrer" class="">пакет</a>, включающий плагин для работы с qsps-файлами и подсветку синтаксиса QSP.</li>
<li class="">Для VS Code существует <a href="https://github.com/QSPFoundation/Qsp.FSharp.VsCode" target="_blank" rel="noopener noreferrer" class="">специальное расширение</a>.</li>
</ul>
</li>
</ol>
<p>Если вы умеете пользоваться системами контроля версий типа GIT, рекомендуем с их помощью фиксировать каждое масштабное изменение сделанное в игре.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="первый-этап-переноса-критичные-изменения">Первый этап переноса. Критичные изменения<a href="#первый-этап-переноса-критичные-изменения" class="hash-link" aria-label="Прямая ссылка на Первый этап переноса. Критичные изменения" title="Прямая ссылка на Первый этап переноса. Критичные изменения" translate="no">​</a></h2>
<p>Версия библиотеки QSP 5.8.0 получила несколько критически значимых изменений, которые, к сожалению, сломали обратную совместимость плееров. То есть теперь игра, написанная для плеера 5.7.0, будет некорректно работать на плеерах версии 5.8.0 и выше.</p>
<p>Но поправить такую игру достаточно легко.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>[<strong>Прежде всего!</strong>]</div><div class="admonitionContent_BuS1"><p>Сделайте полную копию вашего проекта на тот случай, если что-то пойдёт не так.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="анализ-кода-игры-для-qsp-570">Анализ кода игры для QSP 5.7.0<a href="#анализ-кода-игры-для-qsp-570" class="hash-link" aria-label="Прямая ссылка на Анализ кода игры для QSP 5.7.0" title="Прямая ссылка на Ан ализ кода игры для QSP 5.7.0" translate="no">​</a></h3>
<ol>
<li class="">Сначала вам нужно сконвертировать игру в формат &quot;qsps&quot;. Это делается с помощью утилиты txt2gam, или, если утилита подключена к Quest Generator, с помощью пункта меню &quot;Экспорт → Текстовый файл формата TXT2GAM&quot; в QGen.
Формат &quot;qsps&quot; и &quot;TXT2GAM&quot; — это одно и то же.</li>
<li class="">Далее нужно запустить Анализатор и &quot;скормить ему игру&quot;:<!-- -->
<ul>
<li class="">Запускаете утилиту и нажимаете кнопку с тремя точками в правом верхнем углу.</li>
<li class="">Находите и выбираете текстовый файл с вашей игрой.</li>
<li class="">Утилита автоматически запустит чтение файла и на вкладке &quot;Анализ&quot; в самом нижнем поле вы увидите список ошибок и предупреждений.</li>
<li class="">В той же вкладке нажмите кнопку &quot;Переменные&quot;. В случае успешного чтения файла в трёх полях с полосами прокрутки отобразятся списки используемых в игре переменных.</li>
</ul>
</li>
</ol>
<p>Это всё, что понадобится нам от утилиты &quot;Анализатор&quot;. Не закрывайте окно, вам понадобится информация из него.</p>
<p><img decoding="async" loading="lazy" src="/howdo_faq/assets/images/analyzer_20251226230843-e3402f0bd004f834626eaa334462d76e.png" width="668" height="657" class="img_ev3q"></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="разнотипные-значения-в-массивах">Разнотипные значения в массивах<a href="#разнотипные-значения-в-массивах" class="hash-link" aria-label="Прямая ссылка на Разнотипные значения в массивах" title="Прямая ссылка на Разнотипные значения в массивах" translate="no">​</a></h3>
<p>Одним из самых масштабных изменений, произошедших в QSP, стало то, что больше нельзя хранить в одном и том же массиве под одним и тем же индексом и числовое, и текстовое значение. Очень подробно это изменение описано в статье &quot;<a href="https://vk.com/@qsplayer-massivy-uzhe-ne-te" target="_blank" rel="noopener noreferrer" class="">Массивы уже не те</a>&quot; .</p>
<p>Если вы использовали старое поведение массивов, как фичу, например хранили названия и здоровье юнитов под одним индексом в одном и том же массиве, то в плеерах версии 5.8.0 и выше это сломает работу игры.</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">! $unit - название, unit - здоровье</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$unit</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">0</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;пехотинец&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token user-variable">unit</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">0</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">300</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$unit</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">1</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;гвардеец&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token user-variable">unit</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">1</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">670</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$unit</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">2</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;лучник&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token user-variable">unit</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">2</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1500</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$unit</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">3</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;артиллерист&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token user-variable">unit</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">3</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><br></span></code></pre></div></div>
<p>В примере выше числовые значения затрут текстовы е, а в плеерах версии 5.7.0 оба значения хранятся одновременно.</p>
<p>Решение данной проблемы очень простое. Как раз, чтобы починить игру, сломавшуюся из-за подобного использования массивов, мы и конвертировали QSP-файл в текстовый формат и &quot;скармливали&quot; этот файл Анализатору.</p>
<p>Нужно сделать следующее:</p>
<ol>
<li class="">Скопировать списки текстовых и числовых переменных из соответствующих окошек Анализатора и сравнить.<!-- -->
<ul>
<li class="">Можно, например, вставить эти списки в экселевскую табличку, отсортировать по алфавиту и сопоставить вручную.</li>
</ul>
</li>
<li class="">Если в обоих списках присутствуют одноимённые массивы, например <code>$unit</code> и <code>unit</code>, нужно переименовать текстовые массивы во всей игре. Для приведённого примера <code>$unit</code> можно переименовать в <code>$unit_name</code>.</li>
<li class="">Массивы <code>$args</code>/<code>args</code> и <code>$result</code>/<code>result</code> переименовывать не нужно, т.к. они являются специальными массивами. Однако, во всех локациях, где используются <code>$args</code>/<code>args</code>, самой первой строчкой обязательно проводите инициализацию (например, <code>args[9] = args[9]</code>), если используете текстовые индексы для элементов массива <code>$args</code>/<code>args</code>.</li>
<li class="">Так же будьте аккуратны с переименованием массивов, которые не используют одновременного хранения и числовых и текстовых значений под одним индексом, но хранят значения и того и другого типов под разными индексами.</li>
</ol>
<p>Когда у вас не останется одноимённых текстовых и числовых массивов (за исключением выше обозначенных случаев), ваша игра, в плане хранения данных в массивах, станет совместима и с плеерами версии 5.7.0 и с плеерами версий 5.8.0 и выше.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="изменения-в-работе-функций-instr-arrcomp-arrpos">Изменения в работе функций INSTR, ARRCOMP, ARRPOS<a href="#изменения-в-работе-функций-instr-arrcomp-arrpos" class="hash-link" aria-label="Прямая ссылка на Изменения в работе функций INSTR, ARRCOMP, ARRPOS" title="Прямая ссылка на Изменения в работе функций INSTR, ARRCOMP, ARRPOS" translate="no">​</a></h3>
<p>Необязательные аргументы функций <strong>INSTR</strong>, <strong>ARRCOMP</strong> и <strong>ARRPOS</strong> в плеерах 5.8.0 и выше переставлены в конец. В плеерах версии 5.7.0. и ниже эти аргументы шли в начале.</p>
<p>Например, в плеере 5.7.0 поиск подстроки в строке мог выглядеть так:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin">instr</span><span class="token sign-punctuation">(</span><span class="token number" style="color:#36acaa">7</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;В корзине 23 красных и 47 синих яблок.&quot;</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;красн&quot;</span><span class="token sign-punctuation">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! 14</span><br></span></code></pre></div></div>
<p>Если вы полностью переходите на новые версии плеера, и совместимость с версией 5.7.0 вас не волнует, вам просто нужно отыскать все вхождения <code>instr</code>, <code>arrcomp</code> и <code>arrpos</code> в вашей игре и переставить необязательный аргумент в конец:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin">instr</span><span class="token sign-punctuation">(</span><span class="token string" style="color:#e3116c">&quot;В корзине 23 красных и 47 синих яблок.&quot;</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;красн&quot;</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token sign-punctuation">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! 14</span><br></span></code></pre></div></div>
<p>Если же вам нужно сохранить совместимость с плеерами версии 5.7.0, то сделайте следующее:</p>
<ol>
<li class="">Проверьте значения необязательных аргументов. Если для <code>instr</code> эти значения везде равны <code>1</code>, а для <code>arrpos</code> и <code>arrcomp</code> — <code>0</code>, достаточно просто опустить эти значения, и игра в плане работы этих функций станет совместима и с 5.7.0 и с 5.8.0 и выше.</li>
<li class="">Если значения необязательных аргументов отличаются от указанных в пункте выше, можно написать функции-обёртки для <code>instr</code>, <code>arrcomp</code> и <code>arrpos</code> и заменить все встроенные функции QSP в игре на свои. Пример для функции <code>instr</code> ниже.</li>
</ol>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token start-location"># test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">! будет работать во всех плеерах</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin">func</span><span class="token sign-punctuation">(</span><span class="token string" style="color:#e3116c">&quot;myInstr&quot;</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;В корзине 23 красных и 47 синих яблок.&quot;</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;красн&quot;</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token sign-punctuation">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! 14</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token end-location">-- test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token start-location"># myInstr</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token sys-variable">$args</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">0</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token sys-variable">$args</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">0</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! строка, по которой производим поиск</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token sys-variable">$args</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">1</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token sys-variable">$args</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">1</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! подстрока, которую ищем</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token sys-variable">args</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">2</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">iif</span><span class="token sign-punctuation">(</span><span class="token sys-variable">args</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">2</span><span class="token sign-punctuation">]</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">0</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token sys-variable">args</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">2</span><span class="token sign-punctuation">]</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token sign-punctuation">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! с какого элемента начинать поиск</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token builtin">$QSPVER</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;5.8.0&#x27;</span><span class="token sign-punctuation">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token sys-variable">result</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">instr</span><span class="token sign-punctuation">(</span><span class="token sys-variable">$args</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">0</span><span class="token sign-punctuation">]</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token sys-variable">$args</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">1</span><span class="token sign-punctuation">]</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token sys-variable">args</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">2</span><span class="token sign-punctuation">]</span><span class="token sign-punctuation">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token sign-punctuation">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token sys-variable">result</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">instr</span><span class="token sign-punctuation">(</span><span class="token sys-variable">args</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">2</span><span class="token sign-punctuation">]</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token sys-variable">$args</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">0</span><span class="token sign-punctuation">]</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token sys-variable">$args</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">1</span><span class="token sign-punctuation">]</span><span class="token sign-punctuation">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token end-location">-- myInstr</span><br></span></code></pre></div></div>
<p>Как видите из примера, в нашей функции мы всё равно переставили необязательный аргумент в конец, а все строки с оригинальным <code>instr</code> придётся заменить на нашу функцию, однако такое решение обеспечит игре совместимость и с плеерами версии 5.7.0 и с более новыми плеерами.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>[Совет.]</div><div class="admonitionContent_BuS1"><p>Поиск и замену данных функций удобнее всего делать в текстовом редакторе типа Sublime Text или VS Code, потому что там вы можете использовать регулярные выражения, как для поиска, так и для замены текста. Это избавит от ручной обработки каждого вхождения, и вы сможете в полуавтоматическом режиме заменить все сомнительные функции в вашей игре на исправленные в считанные минуты.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="disablesubex-не-работает">DISABLESUBEX не работает<a href="#disablesubex-не-работает" class="hash-link" aria-label="Прямая ссылка на DISABLESUBEX не работает" title="Прямая ссылка на DISABLESUBEX не работает" translate="no">​</a></h3>
<p>Системная переменная, которая раньше отключала распознавание подвыражений, больше не работает.</p>
<p>Если раньше вы писали такой код:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token sys-variable">disablesubex</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&#x27;&lt;&lt;disablesubex&gt;&gt;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token sys-variable">disablesubex</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><br></span></code></pre></div></div>
<p>На экран без изменений выводилась строка &quot;<code>&lt;&lt;disablesubex&gt;&gt;</code>&quot;. То есть подвыражение не раскрывалось.</p>
<p>Теперь же переменная <code>DISABLESUBEX</code> больше не отключает раскрытие подвыражений, и поэтому на экране вы увидите &quot;<code>1</code>&quot;.</p>
<p>Чтобы вывести подвыражение на экран необработанным, правильнее всего использовать конкатенацию для разделения угловых скобок:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">&#x27;&lt;&#x27;</span><span class="token operator" style="color:#393A34">+</span><span class="token string" style="color:#e3116c">&#x27;&lt;disablesubex&gt;&gt;&#x27;</span><br></span></code></pre></div></div>
<p>Ещё вы можете использовать фигурные скобки:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token sign-punctuation">{</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token sys-variable">disablesubex</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token sign-punctuation">}</span><br></span></code></pre></div></div>
<p>Выбирайте тот вариант, который вам более удобен.</p>
<p>Эта правка сохранит совместимость с плеерами версии 5.7.0.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="addqst--inclib-killqst--freelib">ADDQST → INCLIB, KILLQST → FREELIB<a href="#addqst--inclib-killqst--freelib" class="hash-link" aria-label="Прямая ссылка на ADDQST → INCLIB, KILLQST → FREELIB" title="Прямая ссылка на ADDQST → INCLIB, KILLQST → FREELIB" translate="no">​</a></h3>
<p>В новых версиях плееров операторы <code>ADDQST</code> и <code>KILLQST</code> заменены на <code>INCLIB</code> и <code>FREELIB</code>.</p>
<p>Здесь всё очень просто.</p>
<p>Нужно переименовать эти операторы, если не требуется сохранить совместимость с 5.7.0.</p>
<p>Если же сохранять совместимость требуется, достаточно проверять версию плеера перед вызовом оператора:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token builtin">$QSPVER</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;5.8.0&#x27;</span><span class="token sign-punctuation">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">INCLIB</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;my_lib.qsp&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token sign-punctuation">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">ADDQST</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;my_lib.qsp&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre></div></div>
<p>Работать всё будет одинаково, т.к. это те же самые операторы, просто переименованные.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="изменения-в-работе-логических-операторов-и-функций">Изменения в работе логических операторов и функций<a href="#изменения-в-работе-логических-операторов-и-функций" class="hash-link" aria-label="Прямая ссылка на Изменения в работе логических операторов и функций" title="Прямая ссылка на Изменения в работе логических операторов и функци й" translate="no">​</a></h3>
<p>В QSP нет булевых значений (<em><code>True</code></em> и <em><code>False</code></em>), а вместо них в плеерах версии 5.7.0. использовались числа <strong><code>0</code></strong> и <strong><code>-1</code></strong>.</p>
<p>Здесь <strong><code>0</code></strong> означало <em>Ложь</em> (<em><code>False</code></em>), а <strong><code>-1</code></strong> означало <em>Правду</em> (<em><code>True</code></em>). Соответственно и все логические операции возвращали нам эти значения:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">! 5.7.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token sign-punctuation">(</span><span class="token number" style="color:#36acaa">3</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">3</span><span class="token sign-punctuation">)</span><span class="token plain">	</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! -1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token sign-punctuation">(</span><span class="token number" style="color:#36acaa">3</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">or</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">3</span><span class="token sign-punctuation">)</span><span class="token plain">	</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! -1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">no</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">			</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! -1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token sign-punctuation">(</span><span class="token number" style="color:#36acaa">3</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">3</span><span class="token sign-punctuation">)</span><span class="token plain">	</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token sign-punctuation">(</span><span class="token number" style="color:#36acaa">3</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">or</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">3</span><span class="token sign-punctuation">)</span><span class="token plain">	</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">no</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">			</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! 0</span><br></span></code></pre></div></div>
<p>При этом операторы <code>AND</code>, <code>OR</code>, <code>NO</code> были битовыми, т.е. они не просто сверяли истинность или ложность значений, а вычисляли их битовый результат:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">! 5.7.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token sign-punctuation">(</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token sign-punctuation">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token sign-punctuation">(</span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">or</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token sign-punctuation">)</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! 6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">no</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token plain">      </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! -8</span><br></span></code></pre></div></div>
<p>В плеерах начиная с версии 5.8.0 операции сравнения, логические операторы и функции полноправно можно назвать логическими.</p>
<p><code>AND</code>, <code>OR</code> и <code>NO</code> теперь всегда возвращают числовые значения <strong><code>0</code></strong> (эквивалент <em><code>False</code></em>) или <strong><code>1</code></strong> (эквивалент <em><code>True</code></em>). То же самое и с операциями сравнения.</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">! &gt;= 5.8.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token sign-punctuation">(</span><span class="token number" style="color:#36acaa">3</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">3</span><span class="token sign-punctuation">)</span><span class="token plain">	</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token sign-punctuation">(</span><span class="token number" style="color:#36acaa">3</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">or</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">3</span><span class="token sign-punctuation">)</span><span class="token plain">	</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">no</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">			</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token sign-punctuation">(</span><span class="token number" style="color:#36acaa">3</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">3</span><span class="token sign-punctuation">)</span><span class="token plain">	</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token sign-punctuation">(</span><span class="token number" style="color:#36acaa">3</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">or</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">3</span><span class="token sign-punctuation">)</span><span class="token plain">	</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">no</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">			</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token sign-punctuation">(</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token sign-punctuation">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token sign-punctuation">(</span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">or</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token sign-punctuation">)</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">no</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token plain">      </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! 0</span><br></span></code></pre></div></div>
<p>Обратите внимание. И в плеерах старых версий и в плеерах новых версий <strong>ЛЮБОЕ</strong> число отличное от нуля воспринимается как <em><code>True</code></em>. Только <strong><code>0</code></strong> является эквивалентом <em><code>False</code></em>. Поэтому когда логический оператор получает любое отличное от нуля число в качестве операнда, он работает с ним, как если бы это была единица. Именно поэтому <strong><code>no 7</code></strong> возвращает <strong><code>0</code></strong>, что на самом деле более правильно, чем в 5.7.0.</p>
<p>Логические функции <code>ISNUM</code>, <code>LOC</code>, <code>ISPLAY</code> и другие тоже раньше возвращали <strong><code>-1</code></strong> как эквивалент <em><code>True</code></em>, и <strong><code>0</code></strong>, как эквивалент <em><code>False</code></em>. Начиная с версии 5.8.0 они возвращают <strong><code>1</code></strong> и <strong><code>0</code></strong> соответственно, как и операции сравнения.</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin">isnum</span><span class="token sign-punctuation">(</span><span class="token string" style="color:#e3116c">&#x27;123&#x27;</span><span class="token sign-punctuation">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin">isnum</span><span class="token sign-punctuation">(</span><span class="token string" style="color:#e3116c">&#x27;12d&#x27;</span><span class="token sign-punctuation">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! 0</span><br></span></code></pre></div></div>
<p>Операция <code>OBJ</code>, которая в плеерах версии 5.7.0 возвращала <strong><code>-1</code></strong> при наличии предмета в окне предметов, претерпела изменения.</p>
<p>В плеерах, начиная с версии 5.8.0, она, как и прочие логические функции стала возвращать <strong><code>1</code></strong> или <strong><code>0</code></strong>. Однако, начиная с плееров версии 5.9.4 она возвращает ЧИСЛО предметов с указанным названием в инвентаре.</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">addobj</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Отвёртка&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">addobj</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Отвёртка&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">addobj</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Отвёртка&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token builtin">OBJ</span><span class="token sign-punctuation">(</span><span class="token string" style="color:#e3116c">&#x27;Отвёртка&#x27;</span><span class="token sign-punctuation">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! в 5.7.0 ===&gt; -1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! в 5.8.0 ===&gt; 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! в 5.9.0 ===&gt; 3</span><br></span></code></pre></div></div>
<p>Как видите, в QSP произошло очень много изменений в логических операторах и функциях, и всё это может повлиять на работоспособность игры.</p>
<p>К сожалению, так же быстро и просто пофиксить всё это, как например массивы, не получится, однако ничего принципиально сложного в исправлении не требуется.</p>
<p>Если вы использовали побитовые операции в своей игре именно для вычислений каких-то значений, а не просто для проверки условий, вам придётся или остаться на 5.7.0, или написать собственные локации-функции, имитирующие побитовые операции.</p>
<p>Если вы просто использовали <code>OR</code>, <code>AND</code>, <code>NO</code> для проверки условий, ничего в таких условиях исправлять не нужно, всё продолжит работать точно так же, как работало раньше.</p>
<p>Чтобы сохранить совместимость с 5.7.0, но при этом иметь совместимость и с более новыми плеерами, уберите явное сравнение с <strong><code>-1</code></strong> для логических функций.
Пример:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">! совместимо только с плеерами версии 5.7.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token label">:input_age</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$age</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">$input</span><span class="token sign-punctuation">(</span><span class="token string" style="color:#e3116c">&#x27;Сколько вам лет?&#x27;</span><span class="token sign-punctuation">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token builtin">isnum</span><span class="token sign-punctuation">(</span><span class="token user-variable">$age</span><span class="token sign-punctuation">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token sign-punctuation">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token user-variable">hero_age</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">val</span><span class="token sign-punctuation">(</span><span class="token user-variable">$age</span><span class="token sign-punctuation">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token sign-punctuation">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">jump</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;input_age&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre></div></div>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">! совместимо с плеерами любых версий</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token label">:input_age</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$age</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">$input</span><span class="token sign-punctuation">(</span><span class="token string" style="color:#e3116c">&#x27;Сколько вам лет?&#x27;</span><span class="token sign-punctuation">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token builtin">isnum</span><span class="token sign-punctuation">(</span><span class="token user-variable">$age</span><span class="token sign-punctuation">)</span><span class="token sign-punctuation">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token user-variable">hero_age</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">val</span><span class="token sign-punctuation">(</span><span class="token user-variable">$age</span><span class="token sign-punctuation">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token sign-punctuation">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">jump</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;input_age&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre></div></div>
<p>Так же, следует учесть, что в плеерах версии 5.7.0 (и ниже) у функций <strong><code>LOC</code></strong> и <strong><code>OBJ</code></strong> приоритет был ниже, чем у операций сравнения. Это могло быть неочевидным для выражений такого рода:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token sign-punctuation">(</span><span class="token builtin">obj</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Отвёртка&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">obj</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Верёвка&#x27;</span><span class="token sign-punctuation">)</span><br></span></code></pre></div></div>
<p>Кажется, что данное выражение должно выполняться так: проверяется наличие предмета “<em>Отвёртка</em>”, проверяется наличие предмета “<em>Верёвка</em>”, и лишь потом значения сравниваются. Однако в 5.7.0 у операции сравнения приоритет выше, чем у <strong>OBJ</strong>. Поэтому сначала выполняется операция сравнения, и лишь потом функция <strong>OBJ</strong>. Таким образом в плеерах версии 5.7.0 данное выражение всегда возвращает <strong>0</strong>.</p>
<p>Начиная с плееров версии 5.8.0 приоритет для <code>LOC</code> и <code>OBJ</code> стал таким же, как и для других функций, типа <code>isnum</code> и <code>isplay</code>, из-за чего некоторые сложные условия могут теперь работать неправильно. Чтобы исправить это и сохранить совместимость со всеми версиями плееров, просто расставьте скобки во всех условиях с такими функциями:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token sign-punctuation">(</span><span class="token builtin">obj</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Отвёртка&#x27;</span><span class="token sign-punctuation">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token sign-punctuation">(</span><span class="token builtin">obj</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Верёвка&#x27;</span><span class="token sign-punctuation">)</span><span class="token sign-punctuation">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	...</span><br></span></code></pre></div></div>
<p>Это будет прочитано одинаково, как в плеере версии 5.7.0, так и в плеерах версий 5.8.0 и выше.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="аргумент-по-умолчанию-для-функции-rand">Аргумент по умолчанию для функции RAND<a href="#аргумент-по-умолчанию-для-функции-rand" class="hash-link" aria-label="Прямая ссылка на Аргумент по умолчанию для функции RAND" title="Прямая ссылка на Аргумент по умолчанию для функции RAND" translate="no">​</a></h3>
<p>В плеерах версии 5.7.0 и ниже второй параметр функции <strong><code>RAND</code></strong> по умолчанию был <strong><code>0</code></strong>. Например, если вы указывали число <strong><code>100</code></strong> в качестве аргумента функции <strong><code>RAND</code></strong>, то эта функция возвращала случайное число от <strong><code>0</code></strong> до <strong><code>100</code></strong>. В плеерах версии 5.8.0 и выше, а так же в <em>Quest Navigator</em>, второ й параметр по умолчанию равен <strong><code>1</code></strong>. То есть если вы укажете лишь одно число, например <strong><code>100</code></strong>, функция <strong><code>RAND</code></strong> вернёт случайное значение от <strong><code>1</code></strong> до <strong><code>100</code></strong>.</p>
<p>Для предупреждения возможных багов в более новых версиях плееров и для сохранения совместимости с плеерами версии 5.7.0 необходимо явно указать второй аргумент:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">! вместо:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin">RAND</span><span class="token sign-punctuation">(</span><span class="token number" style="color:#36acaa">100</span><span class="token sign-punctuation">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">! пишем:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin">RAND</span><span class="token sign-punctuation">(</span><span class="token number" style="color:#36acaa">0</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token sign-punctuation">)</span><br></span></code></pre></div></div>
<p>В текстовых редакторах типа VS Code и Sublime Text это легко делается с помощью регулярных выражений.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="изменения-в-работенеявного-оператора">Изменения в работе неявного оператора<a href="#изменения-в-работенеявного-оператора" class="hash-link" aria-label="Прямая ссылка на Изменения в работе неявного оператора" title="Прямая ссылка на Изменения в работе неявного оператора" translate="no">​</a></h3>
<p>Неявный оператор — это оператор, который мы не указываем. В 5.7.0 он делал примерно то же, что делал и оператор <strong><code>*pl</code></strong>. То есть выводил на экран значение, добавляя после этого значения перевод строки:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">! работает в плеерах любых версий  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">456</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;text&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">! эквивалентно:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">456</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! здесь для вывода используется неявный оператор  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&quot;text&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! и здесь для вывода используется неявный оператор</span><br></span></code></pre></div></div>
<p>Если мы вызывали какую-то функцию, но она не возвращала никакого результата, неявный оператор, как и оператор <strong><code>*pl</code></strong>, выводил на экран пустую строку и добавлял к ней перевод строки:</p>
<p><img decoding="async" loading="lazy" src="/howdo_faq/assets/images/istmt20251227174341-44a6f97d895322311544144e496294a7.jpg" width="709" height="321" class="img_ev3q"></p>
<p>Однако начиная с плееров версии 5.8.0, если функция не возвращает никакого значения, неявный оператор будет просто игнорировать такую функцию.</p>
<p><img decoding="async" loading="lazy" src="/howdo_faq/assets/images/istmt20251227174838-a5ce8bbfcbd2084db0deec6e86d7aa1c.jpg" width="761" height="303" class="img_ev3q"></p>
<p>Чтобы исправить это и сохранить совместимость с плеерами версии 5.7.0, достаточно вместо неявного оператора везде написать явный оператор <strong><code>*pl</code></strong>.</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Строка текста&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token builtin">func</span><span class="token sign-punctuation">(</span><span class="token string" style="color:#e3116c">&#x27;foo.3&#x27;</span><span class="token sign-punctuation">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Строка текста&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="изменения-в-чтении-длинных-строк-кода-разбитых-на-несколько">Изменения в чтении длинных строк кода, разбитых на несколько<a href="#изменения-в-чтении-длинных-строк-кода-разбитых-на-несколько" class="hash-link" aria-label="Прямая ссылка на Изменения в чтении длинных строк кода, разбитых на несколько" title="Прямая ссылка на Изменения в чтении длинных строк кода, разбитых на несколько" translate="no">​</a></h3>
<p>Для того, чтобы разбивать длинные строки на несколько (для удобства чтения) в QSP используется сочетание символов &quot;<code> _</code>&quot; (пробел и символ нижнего подчёркивания). В плеерах версии 5.7.0 и ниже при разборе данной конструкции движок оставлял строки, как есть. Для примера возьмём такую конструкцию:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token user-variable">t</span><span class="token plain"> </span><span class="token user-variable">_</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token operator" style="color:#393A34">or</span><span class="token plain"> </span><span class="token user-variable">_</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token user-variable">t</span><span class="token sign-punctuation">:</span><br></span></code></pre></div></div>
<p>В плеерах версии 5.7.0 символы преформатирования будут исключены при интерпретации, а строка, разбитая с помощью &quot;<code> _</code>&quot;, будет объединена, как есть, то есть будет равнозначна строке:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token user-variable">tort</span><span class="token sign-punctuation">:</span><br></span></code></pre></div></div>
<p>В плеерах версии 5.8.0 и выше данная строка будет объединена с добавлением пробела вместо каждого сочетания &quot;<code> _</code>&quot;, то есть будет равнозначна строке:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token user-variable">t</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">or</span><span class="token plain"> </span><span class="token user-variable">t</span><span class="token sign-punctuation">:</span><br></span></code></pre></div></div>
<p>На самом деле унифицировать поведение для всех версий плееров очень легко, достаточно перед &quot;<code> _</code>&quot; поставить дополнительный пробел, т.е. в конце строки должно получиться &quot;<code>  _</code>&quot; (два пробела и символ подчёркивания).</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="небольшое-резюме-по-критическим-изменениям">Небольшое резюме по критическим изменениям<a href="#небольшое-резюме-по-критическим-изменениям" class="hash-link" aria-label="Прямая ссылка на Небольшое резюме по критическим изменениям" title="Прямая ссылка на Небольшое резюме по критическим изменениям" translate="no">​</a></h3>
<p>Как видите, все критические несовместимости при переходе на новые версии плееров легко фиксятся таким образом, чтобы работать и на старых версиях и на новых. Да, придётся потратить прилично времени, если у вас большая игра, но в целом з десь нет ничего сложного и заумного.</p>
<p>Мы старались предложить варианты с сохранением совместимости для тех, кто хочет продолжать писать игры на 5.7.0, но чтобы оставалась возможность запускать игры и на последних версиях QSP. Однако настоятельно рекомендуем подумать над тем, чтобы полностью перевести игру на плееры последних версий с потерей совместимости со старыми плеерами, ведь новые версии QSP обзавелись множеством новых фич, которые не только делают код более читаемым, но и облегчают разработку, и ускоряют различные процессы в играх.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="синтаксический-сахар-циклы-и-прочее">Синтаксический сахар, циклы и прочее<a href="#синтаксический-сахар-циклы-и-прочее" class="hash-link" aria-label="Прямая ссылка на Синтаксический сахар, циклы и прочее" title="Прямая ссылка на Синтаксический сахар, циклы и прочее" translate="no">​</a></h2>
<p>В этом разделе мы рассмотрим различные изменения синтаксиса, упрощения, новые циклы и многое другое, что упростит и сделает более читаемым ваш код.</p>
<p>Применение любого из этих нововведений сделает ваши игры несовместимыми со старыми версиями плееров, поэтому считайте, что для использования каждой новой фичи вам потребуется самая последняя версия QSP. На момент написания этой статьи это 5.9.5.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="множественное-присваивание">Множественное присваивание<a href="#множественное-присваивание" class="hash-link" aria-label="Прямая ссылка на Множественное присваивание" title="Прямая ссылка на Множественное присваивание" translate="no">​</a></h3>
<p>Множественное присваивание позволяет в одной строке, используя одну операцию присвоить значения сразу нескольким переменным.</p>
<p>Вместо:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token user-variable">mass</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">45</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token user-variable">daz</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">65</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token user-variable">zaz</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">79</span><br></span></code></pre></div></div>
<p>Теперь можно писать:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token user-variable">mass</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token user-variable">daz</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token user-variable">zaz</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">45</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">65</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">79</span><br></span></code></pre></div></div>
<p>Как видите, множественное присваивание делает код более читаемым.</p>
<p>Так же множественное присваивание позволяет поменять местами значения в двух переменных без использования третьей. Например, раньше было так:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token user-variable">temp</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token user-variable">new</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">new</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token user-variable">old</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">old</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token user-variable">temp</span><br></span></code></pre></div></div>
<p>Теперь это делается одной строчкой:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token user-variable">new</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token user-variable">old</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token user-variable">old</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token user-variable">new</span><br></span></code></pre></div></div>
<p>Множественное присваивание работает и с оператором <strong><code>SET</code></strong>:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> </span><span class="token user-variable">mass</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token user-variable">daz</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token user-variable">zaz</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">45</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">65</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">79</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="новый-тип-значения-кортеж">Новый тип значения &quot;<em>кортеж</em>&quot;<a href="#новый-тип-значения-кортеж" class="hash-link" aria-label="Прямая ссылка на новый-тип-значения-кортеж" title="Прямая ссылка на новый-тип-значения-кортеж" translate="no">​</a></h3>
<p>Кортеж - это такой тип значения, в котором можно хранить несколько значений другого типа. Например, вы можете упаковать в кортеж два числовых и одно строковое значение:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token user-variable">%pers</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">187</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">26</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Петя&#x27;</span><span class="token sign-punctuation">]</span><br></span></code></pre></div></div>
<p>Как видно из примера, для кортежей введён специальный префикс типа &quot;<strong>%</strong>&quot;. Кортежи — это новый полноценный тип данных (например кортеж %A), наравне со строками ($A), и числовым типом (A).</p>
<p>Поскольку кортежи — это отдельный тип данных, вы можете вкладывать одни кортежи в другие:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token user-variable">%unit</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token sign-punctuation">[</span><span class="token string" style="color:#e3116c">&#x27;лучник&#x27;</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">123</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">90</span><span class="token sign-punctuation">]</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">234</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">300</span><span class="token sign-punctuation">]</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;агрессивен&#x27;</span><span class="token sign-punctuation">]</span><br></span></code></pre></div></div>
<p>Вот ещё несколько примеров создания кортежей:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token user-variable">%q</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">4</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token sign-punctuation">]</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">%q</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token sign-punctuation">[</span><span class="token string" style="color:#e3116c">&#x27;sdfsd&#x27;</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token sign-punctuation">]</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">%q</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">34</span><span class="token sign-punctuation">]</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">%q</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token sign-punctuation">[</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! пустой кортеж  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">%q</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">56</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">32</span><span class="token sign-punctuation">,</span><span class="token string" style="color:#e3116c">&#x27;sdsd&#x27;</span><span class="token sign-punctuation">]</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token sign-punctuation">]</span><br></span></code></pre></div></div>
<p>Можно не только помещать данные в кортеж, но и извлекать их обратно. Если процесс размещения данных в кортеже называется <em>упаковка</em>, то извлечение данных из кортежа называется <em>распаковка</em>.</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">! упаковка:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">%q</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">56</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">32</span><span class="token sign-punctuation">,</span><span class="token string" style="color:#e3116c">&#x27;sdsd&#x27;</span><span class="token sign-punctuation">]</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token sign-punctuation">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">! распаковка:  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">a</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token user-variable">%b</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token user-variable">c</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token user-variable">%q</span><br></span></code></pre></div></div>
<p>Более подробно почитать о кортежах вы можете на нашей вики: <a href="https://wiki.qsp.org/help:tuples" target="_blank" rel="noopener noreferrer" class="">wiki.qsp.org/кортежи</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="многомерные-массивы">Многомерные массивы<a href="#многомерные-массивы" class="hash-link" aria-label="Прямая ссылка на Многомерные массивы" title="Прямая ссылка на Многомерные массивы" translate="no">​</a></h3>
<p>Чтобы организовать многомерный массив, в плеерах версии 5.7.0 (и более ранних) приходилось использовать текстовые индексы. Например:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">! работает в плеерах любых версий:  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$unit_coords</span><span class="token sign-punctuation">[</span><span class="token string" style="color:#e3116c">&quot;3,1&quot;</span><span class="token sign-punctuation">]</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Пехотинец&quot;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$unit_coords</span><span class="token sign-punctuation">[</span><span class="token string" style="color:#e3116c">&quot;2,7&quot;</span><span class="token sign-punctuation">]</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Артиллерист&quot;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$unit_coords</span><span class="token sign-punctuation">[</span><span class="token string" style="color:#e3116c">&quot;10,0&quot;</span><span class="token sign-punctuation">]</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Танк&quot;</span><br></span></code></pre></div></div>
<p>Но в н овых версиях плеера (начиная с 5.8.0 и выше) можно не использовать текстовые индексы, а указывать несколько нужных значений через запятую:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">! версия 5.8.0 и выше  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$unit_coords</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">3</span><span class="token sign-punctuation">,</span><span class="token number" style="color:#36acaa">1</span><span class="token sign-punctuation">]</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Пехотинец&quot;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$unit_coords</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">2</span><span class="token sign-punctuation">,</span><span class="token number" style="color:#36acaa">7</span><span class="token sign-punctuation">]</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Артиллерист&quot;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$unit_coords</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">10</span><span class="token sign-punctuation">,</span><span class="token number" style="color:#36acaa">0</span><span class="token sign-punctuation">]</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Танк&quot;</span><br></span></code></pre></div></div>
<p>Это намного упрощает работу с многомерными массивами, при этом вы точно так же можете работать и с текстовыми индексами.</p>
<p>Многомерный индекс на самом деле является кортежем, просто мы опускаем вторые квадратные скобки:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">! многомерный массив:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$map</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">1</span><span class="token sign-punctuation">,</span><span class="token number" style="color:#36acaa">2</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;space&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$map</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">1</span><span class="token sign-punctuation">,</span><span class="token number" style="color:#36acaa">3</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;space&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$map</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">5</span><span class="token sign-punctuation">,</span><span class="token number" style="color:#36acaa">7</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;tree&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$map</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">0</span><span class="token sign-punctuation">,</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;hero&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token user-variable">$map</span><span class="token sign-punctuation">[</span><span class="token user-variable">x</span><span class="token sign-punctuation">,</span><span class="token user-variable">y</span><span class="token sign-punctuation">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">! можно, но не рекомендуется,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">! писать так:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$map</span><span class="token sign-punctuation">[</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">1</span><span class="token sign-punctuation">,</span><span class="token number" style="color:#36acaa">2</span><span class="token sign-punctuation">]</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;space&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$map</span><span class="token sign-punctuation">[</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">1</span><span class="token sign-punctuation">,</span><span class="token number" style="color:#36acaa">3</span><span class="token sign-punctuation">]</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;space&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$map</span><span class="token sign-punctuation">[</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">5</span><span class="token sign-punctuation">,</span><span class="token number" style="color:#36acaa">7</span><span class="token sign-punctuation">]</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;tree&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$map</span><span class="token sign-punctuation">[</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">0</span><span class="token sign-punctuation">,</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token sign-punctuation">]</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;hero&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token user-variable">$map</span><span class="token sign-punctuation">[</span><span class="token sign-punctuation">[</span><span class="token user-variable">x</span><span class="token sign-punctuation">,</span><span class="token user-variable">y</span><span class="token sign-punctuation">]</span><span class="token sign-punctuation">]</span><br></span></code></pre></div></div>
<p>Само собой, поскольку многомерный индекс — это кортеж, его значение можно хранить в переменной:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token user-variable">%coords</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">0</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">19</span><span class="token sign-punctuation">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$map</span><span class="token sign-punctuation">[</span><span class="token user-variable">%coords</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;hero&#x27;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="локальные-переменные-оператор-local">Локальные переменные, оператор local<a href="#локальные-переменные-оператор-local" class="hash-link" aria-label="Прямая ссылка на Локальные переменные, оператор local" title="Прямая ссылка на Локальные переменные, оператор local" translate="no">​</a></h3>
<p>В плеерах версии 5.8.0 и выше появился новый оператор, который позволяет объявить указанные переменные локальными для отдельного блока кода (локации, действия, цикла, код в <strong><code>DYNAMIC</code></strong>/<strong><code>DYNEVAL</code></strong>). После того, как блок кода выполнен, значения переменных восстанавливаются к предыдущим:</p>
<p><img decoding="async" loading="lazy" src="https://sun9-37.userapi.com/s/v1/ig2/ErWJdg36OsQZ3XQujiOAM3z43KCiDLpAO1W5sxiaL-HPaLt4oocQudIlIh81IDx-IC0n4bc9llmfQH_op6wuIVoI.jpg?quality=96&amp;as=32x12,48x19,72x28,108x42,160x62,240x93,360x140,480x187,540x210,640x249,720x280,800x311&amp;from=bu&amp;cs=800x0" alt="5.8.0 (qSpider)" class="img_ev3q"></p>
<p>Можно объявить локальную переменную и сразу присвоить ей значение:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> </span><span class="token user-variable">i</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">45</span><br></span></code></pre></div></div>
<p>Можно объявить сразу несколько локальных переменных:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">! объявляем локальные переменные  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> </span><span class="token user-variable">i</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token user-variable">j</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token user-variable">k</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">! объявляем локальные переменные и присваиваем им значения  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> </span><span class="token user-variable">f</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token user-variable">d</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token user-variable">$g</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">123</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">45</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;string&#x27;</span><br></span></code></pre></div></div>
<p>Подробнее про локальные переменные написано в <a href="https://wiki.qsp.org/help:variables" target="_blank" rel="noopener noreferrer" class="">справке</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="приведение-всех-типов-данных-к-булевому-типу">Приведение всех типов данных к булевому типу<a href="#приведение-всех-типов-данных-к-булевому-типу" class="hash-link" aria-label="Прямая ссылка на Приведение всех типов данных к булевому типу" title="Прямая ссылка на Приведение всех типов данных к булевому типу" translate="no">​</a></h3>
<p>Теперь не только числовые значения могут использоваться, как условные <em><code>True</code></em> и <em><code>False</code></em>, но так же и строки, и кортежи.</p>
<ul>
<li class="">Любое число, отличное от нуля считается <em><code>True</code></em>, а ноль — <em><code>False</code></em>;</li>
<li class="">Любая непустая строка считается <em><code>True</code></em>, а пустая — <em><code>False</code></em>;</li>
<li class="">Любой непустой кортеж считается <em><code>True</code></em> (даже кортеж содержащий пустой кортеж, или пустую строку), а пустой — <em><code>False</code></em>;</li>
</ul>
<p>См. так же подраздел &quot;Правда или Ложь?&quot; в <a href="https://wiki.qsp.org/help:expressions" target="_blank" rel="noopener noreferrer" class="">справке</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="циклы">Циклы<a href="#циклы" class="hash-link" aria-label="Прямая ссылка на Циклы" title="Прямая ссылка на Циклы" translate="no">​</a></h3>
<p>Долгое время циклы в QSP приходилось делать костыльным способом с использованием меток. Сейчас же в QSP есть настоящие циклы, которые работают быстрее циклов на меток, и гораздо лучше читаются.</p>
<p>Циклам посвящена отдельная <a href="https://wiki.qsp.org/help:cycle" target="_blank" rel="noopener noreferrer" class="">статья в справке</a>, поэтому мы не будем останавливаться на знакомстве с синтаксисом, а просто посмотрим на то, как циклы писались раньше, и как они пишутся сейчас.</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">! заполнение массива значениями</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">! 5.7.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">i</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token label">:loop</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token user-variable">i</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token sign-punctuation">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token user-variable">mass</span><span class="token sign-punctuation">[</span><span class="token user-variable">i</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token user-variable">i</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token user-variable">i</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">jump</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;loop&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">! 5.8.0 и выше</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">loop</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> </span><span class="token user-variable">i</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token user-variable">i</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">step</span><span class="token plain"> </span><span class="token user-variable">i</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token sign-punctuation">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token user-variable">mass</span><span class="token sign-punctuation">[</span><span class="token user-variable">i</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token user-variable">i</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre></div></div>
<p>Обратите внимание, счётчик цикла объявлен как локальная переменная. Т.е. он будет существовать только внутри цикла. Больше не нужно следить за значениями счётчика, как это было раньше.</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">! Проверка ввода имени игроком</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">! 5.7.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token label">:name_enter</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$name</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">$input</span><span class="token sign-punctuation">(</span><span class="token string" style="color:#e3116c">&#x27;Как вас зовут?&#x27;</span><span class="token sign-punctuation">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token user-variable">$name</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token sign-punctuation">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">jump</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;name_enter&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">! 5.8.0 и выше</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">loop</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">no</span><span class="token plain"> </span><span class="token user-variable">$name</span><span class="token sign-punctuation">:</span><span class="token plain"> </span><span class="token user-variable">$name</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">$input</span><span class="token sign-punctuation">(</span><span class="token string" style="color:#e3116c">&#x27;Как вас зовут?&#x27;</span><span class="token sign-punctuation">)</span><br></span></code></pre></div></div>
<p>Подсчёт числа предметов с указанным названием в инвентаре:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token user-variable">$item</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Отвёртка&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">! 5.7.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">counter</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">i</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">countobj</span><span class="token sign-punctuation">(</span><span class="token sign-punctuation">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token label">:for</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token user-variable">i</span><span class="token sign-punctuation">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token builtin">$getobj</span><span class="token sign-punctuation">(</span><span class="token user-variable">i</span><span class="token sign-punctuation">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token user-variable">$item</span><span class="token sign-punctuation">:</span><span class="token plain"> </span><span class="token user-variable">counter</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token user-variable">i</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">jump</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;for&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">! 5.8.0 и выше</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">counter</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">loop</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> </span><span class="token user-variable">i</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">countobj</span><span class="token sign-punctuation">(</span><span class="token sign-punctuation">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token user-variable">i</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">step</span><span class="token plain"> </span><span class="token user-variable">i</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token sign-punctuation">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token builtin">$getobj</span><span class="token sign-punctuation">(</span><span class="token user-variable">i</span><span class="token sign-punctuation">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token user-variable">$item</span><span class="token sign-punctuation">:</span><span class="token plain"> </span><span class="token user-variable">counter</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="доступ-к-args-локаций-в-гиперссылках">Доступ к <code>ARGS</code> локаций в гиперссылках<a href="#доступ-к-args-локаций-в-гиперссылках" class="hash-link" aria-label="Прямая ссылка на доступ-к-args-локаций-в-гиперссылках" title="Прямая ссылка на доступ-к-args-локаций-в-гиперссылках" translate="no">​</a></h3>
<p>Массив <code>ARGS</code> — это специальный массив, который заново создаётся на каждой локации. То есть на каждой локации существует свой собственный массив <code>ARGS</code>, и значения в этом массиве не пересекаются со значениями массивов <code>ARGS</code>, созданных на других локациях. Более того собственный уникальный массив <code>ARGS</code> создаётся и в выполняемых с помощью <code>DYNAMIC</code>/<code>DYNEVAL</code> блоков кода.</p>
<p>Этот массив заполняется значениями из переданных в код аргументов, начиная с элемента под номером <code>0</code>.</p>
<p>Если с массивами <code>ARGS</code> в коде локаций, вызываемых по <code>GOSUB</code> и <code>FUNC</code>, а так же с массивами <code>ARGS</code> в коде, выполняемом с помощью <code>DYNAMIC</code> и <code>DYNEVAL</code> всё понятно — эти массивы существуют только пока выполняется код, а потом уничтожаются, то с массивами <code>ARGS</code> в коде локаций, на которые был осуществлён переход с помощью <code>GOTO</code> или <code>XGOTO</code> не всё так однозначно.</p>
<p>Дело в том, что технически такая локация продолжает выполняться и массив <code>ARGS</code> продолжает суще ствовать, пока игрок не покинет локацию.</p>
<p>Изначально доступ к этому массиву мы могли получить только внутри действий, теперь же массив <code>ARGS</code> стал доступен и из кода гиперссылок.</p>
<p>Это не только позволяет учитывать в гиперссылках, какие данные были переданы на локацию, но и использовать <code>ARGS</code> как &quot;сессионную&quot; локальную переменную, существующую только во время сессии пребывания на локации.</p>
<p>Так мы можем, например, помещать в <code>ARGS</code> многострочный код в виде текста, а потом выполнять его из ссылки с помощью <code>DYNAMIC</code>.</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token sys-variable">$args</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">21</span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token sign-punctuation">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">no</span><span class="token plain"> </span><span class="token user-variable">деньги</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">100</span><span class="token sign-punctuation">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">addobj</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Кружка имбирного эля&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token user-variable">кружка_эля</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token user-variable">деньги</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Я приобрёл кружку имбирного эля.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Мне не хватает денег на эль.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token sign-punctuation">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;a href=&#x27;exec:dynamic $args[21]&#x27;&gt;Купить кружку имбирного эля&lt;/a&gt;&quot;</span><br></span></code></pre></div></div>
<p>Подробнее об аргументах, передаваемых на локации при переходе, читайте в разделе <a href="https://wiki.qsp.org/help:goto" target="_blank" rel="noopener noreferrer" class="">&quot;Переходы&quot;</a> нашей справки.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="неявный-вызов-пользовательских-функций-и-процедур">Неявный вызов пользовательских функций и процедур<a href="#неявный-вызов-пользовательских-функций-и-процедур" class="hash-link" aria-label="Прямая ссылка на Неявный вызов пользовательских функций и процедур" title="Прямая ссылка на Неявный вызов пользовательских функций и процедур" translate="no">​</a></h3>
<p>Это синтаксический сахар над функцией <strong><code>FUNC</code></strong> и оператором <strong><code>GOSUB</code></strong>, который сильно упрощает написание и чтение кода.</p>
<p>Вот как раньше выглядел такой код:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">! код в формате QSPS/TXT2GAM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token start-location"># start</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">gosub</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;proceed&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token builtin">func</span><span class="token sign-punctuation">(</span><span class="token string" style="color:#e3116c">&#x27;foo.3&#x27;</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">23</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">45</span><span class="token sign-punctuation">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token end-location">-- start</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token start-location"># proceed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">act</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ДЕЙСТВИЕ&#x27;</span><span class="token sign-punctuation">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token builtin">func</span><span class="token sign-punctuation">(</span><span class="token string" style="color:#e3116c">&#x27;foo.3&#x27;</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token sign-punctuation">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token end-location">-- proceed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token start-location"># foo.3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token sys-variable">$result</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token sys-variable">args</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">0</span><span class="token sign-punctuation">]</span><span class="token operator" style="color:#393A34">*</span><span class="token sys-variable">args</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">1</span><span class="token sign-punctuation">]</span><span class="token operator" style="color:#393A34">/</span><span class="token sign-punctuation">(</span><span class="token sys-variable">args</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">0</span><span class="token sign-punctuation">]</span><span class="token operator" style="color:#393A34">+</span><span class="token sys-variable">args</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">1</span><span class="token sign-punctuation">]</span><span class="token sign-punctuation">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token end-location">-- foo.3</span><br></span></code></pre></div></div>
<p>Здесь мы явно прописывали и оператор <strong><code>GOSUB</code></strong> и функцию <strong><code>FUNC</code></strong>, что немного усложняло чтение кода.</p>
<p>Теперь мы не указываем оператор <strong><code>GOSUB</code></strong> явно, мы пишем <code>@@</code>, затем сразу без пробелов название локации, а потом ставим пробел и, если нужно, перечисляем аргументы через запятую. Для нашего п римера это выглядит так:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@@</span><span class="token user-variable">proceed</span><br></span></code></pre></div></div>
<p>Если бы нам нужно было передать, скажем, три аргумента, это бы выглядело так:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@@</span><span class="token user-variable">proceed</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;text&#x27;</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">23</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token user-variable">$var</span><br></span></code></pre></div></div>
<p>То же самое с <strong><code>FUNC</code></strong>, только запись немного отличается. Вместо <code>@@</code> мы пишем просто <code>@</code>, затем сразу без пробелов название локации, затем сразу без пробелов открываем скобки и перечисляем необходимые аргументы через запятую. Вот как это будет выглядеть в нашем примере:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">@foo.3</span><span class="token sign-punctuation">(</span><span class="token number" style="color:#36acaa">23</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">45</span><span class="token sign-punctuation">)</span><br></span></code></pre></div></div>
<p>Таким образом мы существенно сокращаем запись вызовов наших собственных функций и процедур.</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">! код в формате QSPS/TXT2GAM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token start-location"># start</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@@</span><span class="token user-variable">proceed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">@foo.3</span><span class="token sign-punctuation">(</span><span class="token number" style="color:#36acaa">23</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">45</span><span class="token sign-punctuation">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token end-location">-- start</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token start-location"># proceed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">act</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ДЕЙСТВИЕ&#x27;</span><span class="token sign-punctuation">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">*pl</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">@foo.3</span><span class="token sign-punctuation">(</span><span class="token number" style="color:#36acaa">12</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token sign-punctuation">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token end-location">-- proceed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token start-location"># foo.3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token sys-variable">$result</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token sys-variable">args</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">0</span><span class="token sign-punctuation">]</span><span class="token operator" style="color:#393A34">*</span><span class="token sys-variable">args</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">1</span><span class="token sign-punctuation">]</span><span class="token operator" style="color:#393A34">/</span><span class="token sign-punctuation">(</span><span class="token sys-variable">args</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">0</span><span class="token sign-punctuation">]</span><span class="token operator" style="color:#393A34">+</span><span class="token sys-variable">args</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">1</span><span class="token sign-punctuation">]</span><span class="token sign-punctuation">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token end-location">-- foo.3</span><br></span></code></pre></div></div>
<p>Подробнее об этом нововведении можно прочитать в разделе <a href="https://wiki.qsp.org/help:organizing" target="_blank" rel="noopener noreferrer" class="">&quot;Пользовательские функции и процедуры&quot;</a> нашей справки.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="больше-аргументов-для-локаций-и-функций">Больше аргументов для локаций и функций<a href="#больше-аргументов-для-локаций-и-функций" class="hash-link" aria-label="Прямая ссылка на Больше аргументов для локаций и функций" title="Прямая ссылка на Больше аргументов для локаций и функций" translate="no">​</a></h3>
<p>Теперь можно передавать до двадцати аргументов локациям и функциям.</p>
<p>Собственно, кроме встроенных функций <strong><code>MAX</code></strong> и <strong><code>MIN</code></strong>, ни одна другая функция или оператор не принимают такое количество аргументов.</p>
<p>Если же говорить о локациях, то при работе с ними мы используем операторы <strong><code>GOSUB</code></strong>, <strong><code>GOTO</code></strong>, <strong><code>XGOTO</code></strong> и другие, а так же функцию <strong><code>FUNC</code></strong>, и при передаче аргументов всегда нужно учитывать, что одним из аргументов является название локации. Для оператора <strong><code>DYNAMIC</code></strong> или функции <strong><code>DYNEVAL</code></strong> первым аргументом является текст выполняемого кода. То есть в данном случае мы можем передавать в код локации или динамика не более девятнадцати аргументов.</p>
<p>Помимо прочего, если мы создаём кортеж, мы не можем перечислить в квадратных скобках более двадцати значений. Если вам нужен более длинный кортеж, создавайте его частями, а части объединяйте с помощью операции <strong><code>&amp;</code></strong> (конкатенация):</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token user-variable">%tpl</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">1</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">13</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">14</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">17</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">18</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">19</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token sign-punctuation">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">%tpl</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token sign-punctuation">(</span><span class="token user-variable">%tpl</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">21</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">22</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">23</span><span class="token sign-punctuation">]</span><span class="token sign-punctuation">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="усовершенствование-killvar">Усовершенствование killvar<a href="#усовершенствование-killvar" class="hash-link" aria-label="Прямая ссылка на Усовершенствование killvar" title="Прямая ссылка на Усовершенствование killvar" translate="no">​</a></h3>
<p>Теперь <code>KILLVAR</code> может уничтожать элемент массива по строковому индексу или кортежу.</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">! удаление по числовому индексу</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">killvar</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;яблоко&#x27;</span><span class="token sign-punctuation">,</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">! удаление элемента по строковому индексу</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">killvar</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;$item_loc&#x27;</span><span class="token sign-punctuation">,</span><span class="token string" style="color:#e3116c">&#x27;палка&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">! удаление элемента по многомерному индексу</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">killvar</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;$space&#x27;</span><span class="token sign-punctuation">,</span><span class="token sign-punctuation">[</span><span class="token number" style="color:#36acaa">0</span><span class="token sign-punctuation">,</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token sign-punctuation">,</span><span class="token number" style="color:#36acaa">9</span><span class="token sign-punctuation">]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="комментарии-после-двоеточий-в-многострочных-опера торах">Комментарии после двоеточий в многострочных операторах<a href="#комментарии-после-двоеточий-в-многострочных-операторах" class="hash-link" aria-label="Прямая ссылка на Комментарии после двоеточий в многострочных операторах" title="Прямая ссылка на Комментарии после двоеточий в многострочных операторах" translate="no">​</a></h3>
<p>После двоеточия в многострочном условии, цикле или действии можно сразу записывать комментарий. В этом случае амперсанд не нужен, разделителем служит именно двоеточие:</p>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">act</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Взять яблоко&quot;</span><span class="token sign-punctuation">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">! многострочное действие</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">addobj</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Яблоко&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token user-variable">яблоко</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="улучшение-сообщений-об-ошибках">Улучшение сообщений об ошибках<a href="#улучшение-сообщений-об-ошибках" class="hash-link" aria-label="Прямая ссылка на Улучшение сообщений об ошибках" title="Прямая ссылка на Улучшение сообщений об ошибках" translate="no">​</a></h3>
<p>Сообщения об ошибках стали более информативны. Теперь они не только показывают номер строки с ошибкой, но и её содержимое.</p>
<p><img decoding="async" loading="lazy" src="/howdo_faq/assets/images/error_view_20251228235108-4678ddc00c805f666219ad1b1cf7191f.jpg" width="671" height="412" class="img_ev3q"></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="поддержка-многострочности-внутри-круглых-и-квадратных-скобок">Поддержка многострочности внутри круглых и квадратных скобок<a href="#поддержка-многострочности-внутри-круглых-и-квадратных-скобок" class="hash-link" aria-label="Прямая ссылка на Поддержка многострочности внутри круглых и квадратных скобок" title="Прямая ссылка на Поддержка многострочности внутри круглых и квадратных скобок" translate="no">​</a></h3>
<div class="language-qsp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-qsp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token user-variable">%test</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token sign-punctuation">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token sign-punctuation">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;key1&#x27;</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;value1&#x27;</span><span class="token plain"> </span><span class="token sign-punctuation">]</span><span class="token sign-punctuation">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token sign-punctuation">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;key2&#x27;</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;value2&#x27;</span><span class="token plain"> </span><span class="token sign-punctuation">]</span><span class="token sign-punctuation">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token sign-punctuation">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;key3&#x27;</span><span class="token sign-punctuation">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;value3&#x27;</span><span class="token plain"> </span><span class="token sign-punctuation">]</span><span class="token sign-punctuation">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token sign-punctuation">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin">max</span><span class="token sign-punctuation">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;val1&#x27;</span><span class="token sign-punctuation">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;val2&#x27;</span><span class="token sign-punctuation">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;val3&#x27;</span><span class="token sign-punctuation">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;val4&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token sign-punctuation">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">pl</span><span class="token plain"> </span><span class="token sign-punctuation">(</span><span class="token user-variable">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token sign-punctuation">(</span><span class="token user-variable">b</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token sign-punctuation">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token sign-punctuation">(</span><span class="token user-variable">c</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token sign-punctuation">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token sign-punctuation">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$arr</span><span class="token sign-punctuation">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;key1&#x27;</span><span class="token sign-punctuation">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;key2&#x27;</span><span class="token sign-punctuation">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token user-variable">$key3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token sign-punctuation">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;value&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">pl</span><span class="token plain"> </span><span class="token user-variable">$arr</span><span class="token sign-punctuation">[</span><span class="token string" style="color:#e3116c">&#x27;key1&#x27;</span><span class="token sign-punctuation">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;key2&#x27;</span><span class="token sign-punctuation">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token user-variable">$key3</span><span class="token sign-punctuation">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token sign-punctuation">(</span><span class="token user-variable">$color</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;жёлтый&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">or</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$color</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;красный&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">or</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token user-variable">$color</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;зелёный&quot;</span><span class="token sign-punctuation">)</span><span class="token sign-punctuation">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;По-прежнему однострочное условие.&quot;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="список-новых-операторов-и-функций-а-так-же-новые-возможности-старых">Список новых операторов и функций, а так же новые возможности старых<a href="#список-новых-операторов-и-функций-а-так-же-новые-возможности-старых" class="hash-link" aria-label="Прямая ссылка на Список новых операторов и функций, а так же новые возможности старых" title="Прямая ссылка на Список новых операторов и функций, а так же новые возможности старых" translate="no">​</a></h2>
<ul>
<li class=""><a href="https://dev.qsp.org/ru/docs/language/qsp-keywords/qsp-keywords-functions#arritem" target="_blank" rel="noopener noreferrer" class=""><code>ARRITEM</code></a> — возвращает значение элемента массива под указанным индексом.</li>
<li class=""><a href="https://dev.qsp.org/ru/docs/language/qsp-keywords/qsp-keywords-statements#scanstr" target="_blank" rel="noopener noreferrer" class=""><code>SCANSTR</code></a> — поиск в строке непересекающихся вхождений, соответствующих шаблону, и помещение этих вхождений в массив.</li>
<li class=""><a href="https://dev.qsp.org/ru/docs/language/qsp-keywords/qsp-keywords-statements#sortarr" target="_blank" rel="noopener noreferrer" class=""><code>SORTARR</code></a> — сортировка указанного массива.</li>
<li class=""><a href="https://dev.qsp.org/ru/docs/language/qsp-keywords/qsp-keywords-functions#curobjs" target="_blank" rel="noopener noreferrer" class=""><code>$CUROBJS</code></a> - данная функция возвращает список выведенных на экран предметов в виде QSP-кода.</li>
<li class=""><a href="https://dev.qsp.org/ru/docs/language/qsp-keywords/qsp-keywords-statements#setvar" target="_blank" rel="noopener noreferrer" class=""><code>SETVAR</code></a> — присваивает значение переменной или ячейке массива.</li>
<li class=""><a href="https://dev.qsp.org/ru/docs/language/qsp-keywords/qsp-keywords-functions#arrtype" target="_blank" rel="noopener noreferrer" class=""><code>ARRTYPE</code></a> — возвращает тип значения, хранящегося в переменной, или указанной ячейке массива.</li>
<li class=""><a href="https://dev.qsp.org/ru/docs/language/qsp-keywords/qsp-keywords-functions#arrpack" target="_blank" rel="noopener noreferrer" class=""><code>ARRPACK</code></a> — упаковывает массив в кортеж.</li>
<li class=""><a href="https://dev.qsp.org/ru/docs/language/qsp-keywords/qsp-keywords-statements#unpackarr" target="_blank" rel="noopener noreferrer" class=""><code>UNPACKARR</code></a> — распаковка кортежа в указанный массив.</li>
<li class=""><a href="https://dev.qsp.org/ru/docs/language/qsp-keywords/qsp-keywords-functions#rand" target="_blank" rel="noopener noreferrer" class=""><code>RAND</code></a> — возвращает случайное число между двумя указанными числами. <strong>Добавлен новый параметр: <em>Мода</em></strong>.</li>
<li class=""><a href="https://dev.qsp.org/ru/docs/language/qsp-keywords/qsp-keywords-functions#replace" target="_blank" rel="noopener noreferrer" class=""><code>REPLACE</code></a> — замена текста в строке. <strong>Добавлен новый параметр: <em>Число замен</em></strong>.</li>
<li class=""><a href="https://dev.qsp.org/ru/docs/language/qsp-keywords/qsp-keywords-statements#delobj" target="_blank" rel="noopener noreferrer" class=""><code>DELOBJ</code></a> — удаление предмета из инвентаря по названию (если такой предмет существует).  <strong>Добавлен новый параметр: <em>Число удаляемых предметов</em></strong>.</li>
<li class=""><code>MODOBJ</code>, <code>RESETOBJ</code> — управление отображением предметов на экране</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="заключение">Заключение<a href="#заключение" class="hash-link" aria-label="Прямая ссылка на Заключение" title="Прямая ссылка на Заключение" translate="no">​</a></h2>
<p>Как видите, несмотря на обилие произошедших за последние пять лет изменений, перенести свой проект на плеер самой последней версии не составит большого труда. Да, это потребует некоторой доли внимательности и понимания, чем занимался ваш код всё это время, но новые возможности того стоят.</p>
<p>Успехов вам в вашем творчестве, и релиза без багов!</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Страница документа"><a class="pagination-nav__link pagination-nav__link--prev" href="/howdo_faq/docs/articles/operators_funcs_args/"><div class="pagination-nav__sublabel">Предыдущая страница</div><div class="pagination-nav__label">Операторы, функции, аргументы. GOSUB, FUNC, ARGS</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/howdo_faq/docs/articles/transition_570_590"><div class="pagination-nav__sublabel">Следующая страница</div><div class="pagination-nav__label">Переход с 5.7.0 на 5.9.x</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#инструменты" class="table-of-contents__link toc-highlight">Инструменты</a></li><li><a href="#первый-этап-переноса-критичные-изменения" class="table-of-contents__link toc-highlight">Первый этап переноса. Критичные изменения</a><ul><li><a href="#анализ-кода-игры-для-qsp-570" class="table-of-contents__link toc-highlight">Анализ кода игры для QSP 5.7.0</a></li><li><a href="#разнотипные-значения-в-массивах" class="table-of-contents__link toc-highlight">Разнотипные значения в массивах</a></li><li><a href="#изменения-в-работе-функций-instr-arrcomp-arrpos" class="table-of-contents__link toc-highlight">Изменения в работе функций INSTR, ARRCOMP, ARRPOS</a></li><li><a href="#disablesubex-не-работает" class="table-of-contents__link toc-highlight">DISABLESUBEX не работает</a></li><li><a href="#addqst--inclib-killqst--freelib" class="table-of-contents__link toc-highlight">ADDQST → INCLIB, KILLQST → FREELIB</a></li><li><a href="#изменения-в-работе-логических-операторов-и-функций" class="table-of-contents__link toc-highlight">Изменения в работе логических операторов и функций</a></li><li><a href="#аргумент-по-умолчанию-для-функции-rand" class="table-of-contents__link toc-highlight">Аргумент по умолчанию для функции RAND</a></li><li><a href="#изменения-в-работенеявного-оператора" class="table-of-contents__link toc-highlight">Изменения в работе неявного оператора</a></li><li><a href="#изменения-в-чтении-длинных-строк-кода-разбитых-на-несколько" class="table-of-contents__link toc-highlight">Изменения в чтении длинных строк кода, разбитых на несколько</a></li><li><a href="#небольшое-резюме-по-критическим-изменениям" class="table-of-contents__link toc-highlight">Небольшое резюме по критическим изменениям</a></li></ul></li><li><a href="#синтаксический-сахар-циклы-и-прочее" class="table-of-contents__link toc-highlight">Синтаксический сахар, циклы и прочее</a><ul><li><a href="#множественное-присваивание" class="table-of-contents__link toc-highlight">Множественное присваивание</a></li><li><a href="#новый-тип-значения-кортеж" class="table-of-contents__link toc-highlight">Новый тип значения &quot;<em>кортеж</em>&quot;</a></li><li><a href="#многомерные-массивы" class="table-of-contents__link toc-highlight">Многомерные массивы</a></li><li><a href="#локальные-переменные-оператор-local" class="table-of-contents__link toc-highlight">Локальные переменные, оператор local</a></li><li><a href="#приведение-всех-типов-данных-к-булевому-типу" class="table-of-contents__link toc-highlight">Приведение всех типов данных к булевому типу</a></li><li><a href="#циклы" class="table-of-contents__link toc-highlight">Циклы</a></li><li><a href="#доступ-к-args-локаций-в-гиперссылках" class="table-of-contents__link toc-highlight">Доступ к <code>ARGS</code> локаций в гиперссылках</a></li><li><a href="#неявный-вызов-пользовательских-функций-и-процедур" class="table-of-contents__link toc-highlight">Неявный вызов пользовательских функций и процедур</a></li><li><a href="#больше-аргументов-для-локаций-и-функций" class="table-of-contents__link toc-highlight">Больше аргументов для локаций и функций</a></li><li><a href="#усовершенствование-killvar" class="table-of-contents__link toc-highlight">Усовершенствование killvar</a></li><li><a href="#комментарии-после-двоеточий-в-многострочных-операторах" class="table-of-contents__link toc-highlight">Комментарии после двоеточий в многострочных операторах</a></li><li><a href="#улучшение-сообщений-об-ошибках" class="table-of-contents__link toc-highlight">Улучшение сообщений об ошибках</a></li><li><a href="#поддержка-многострочности-внутри-круглых-и-квадратных-скобок" class="table-of-contents__link toc-highlight">Поддержка многострочности внутри круглых и квадратных скобок</a></li></ul></li><li><a href="#список-новых-операторов-и-функций-а-так-же-новые-возможности-старых" class="table-of-contents__link toc-highlight">Список новых операторов и функций, а так же новые возможности старых</a></li><li><a href="#заключение" class="table-of-contents__link toc-highlight">Заключение</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright"><aside class="footerBlock">
<div class="eBlock">
<div class="avsPageStamp">
    <p class="emptyP">Aleks Versus'HowDo-F.A.Q'2019-2026. Built with Docusaurus.<br></p>
    <p class="emptyP">Aleks Versus'Game Adventure Making'Really Unimaginable Stories'2019-2026</p>
</div></div>
</aside></div></div></div></footer></div>
</body>
</html>